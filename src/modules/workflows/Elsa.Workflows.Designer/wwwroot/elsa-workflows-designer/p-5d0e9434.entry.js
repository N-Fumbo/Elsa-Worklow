import{r as t,a as e,h as i,c as n,H as s}from"./p-a7a3baa1.js";import{l as r}from"./p-e71312f9.js";import{t as o,e as a,l as c}from"./p-3ff104be.js";import{R as l,C as u,a as h,m as d,o as f,aW as w}from"./p-dd7ad463.js";import{H as p}from"./p-ec4413cd.js";import"./p-fcfa9e22.js";import"./p-1de51046.js";import{I as m}from"./p-95042f88.js";import"./p-72dc819a.js";import"./p-144a434e.js";import"./p-4031f4ff.js";import"./p-37e9f5c1.js";const v=class{constructor(e){t(this,e),this.context={},this.renderer=()=>null}connectedCallback(){null!=this.subscribe&&(this.unsubscribe=this.subscribe(this.el,"context"))}disconnectedCallback(){null!=this.unsubscribe&&this.unsubscribe()}render(){return this.renderer(Object.assign({},this.context))}get el(){return e(this)}},g=()=>i("svg",{class:"tw-h-5 tw-w-5 tw-text-gray-400",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},i("path",{stroke:"none",d:"M0 0h24v24H0z"}),i("circle",{cx:"12",cy:"12",r:"9"}),i("line",{x1:"8",y1:"12",x2:"8",y2:"12.01"}),i("line",{x1:"12",y1:"12",x2:"12",y2:"12.01"}),i("line",{x1:"16",y1:"12",x2:"16",y2:"12.01"})),y=class{constructor(e){t(this,e),this.syntaxChanged=n(this,"syntaxChanged",7),this.expressionChanged=n(this,"expressionChanged",7),this.shouldRenderMonaco=()=>!!this.syntax&&"Literal"!=this.syntax&&!!this.supportedSyntaxes.find((t=>t===this.syntax)),this.renderContextMenuButton=()=>this.shouldRenderMonaco()?i("span",null,this.syntax):i(g,null),this.renderEditor=()=>{const t=this.syntax,e=d(t),n=this.expression,o=!!t&&"Literal"!=t&&!!this.supportedSyntaxes.find((e=>e===t)),s=o?"hidden":"tw-block";return i("div",null,i("div",{class:o?"tw-block":"hidden"},i("elsa-monaco-editor",{value:n,language:e,"editor-height":this.codeEditorHeight,"single-line":this.codeEditorSingleLineMode,onValueChanged:t=>this.onExpressionChangedDebounced(t.detail),ref:t=>this.monacoEditor=t})),i("div",{class:s},i("slot",null)),i(p,{text:this.hint}))},this.workflowDefinitionId=void 0,this.activityType=void 0,this.propertyName=void 0,this.label=void 0,this.hideLabel=void 0,this.hint=void 0,this.fieldName=void 0,this.syntax=void 0,this.expression=void 0,this.defaultSyntax=l.Literal,this.supportedSyntaxes=["JavaScript","Liquid"],this.isReadOnly=void 0,this.codeEditorHeight="16em",this.codeEditorSingleLineMode=!1,this.context=void 0,this.currentExpression=void 0,this.onExpressionChangedDebounced=r.debounce(this.onExpressionChanged,10)}onWindowClicked(t){const e=t.target;this.contextMenuWidget&&this.contextMenuWidget.contains(e)||this.closeContextMenu()}async componentWillLoad(){this.currentExpression=this.expression}async componentDidLoad(){const t=await u.get(h).getElsaClient(),e=this.workflowDefinitionId,i=this.activityType,n=this.propertyName,o=await t.scripting.javaScriptApi.getTypeDefinitions({workflowDefinitionId:e,activityTypeName:i,propertyName:n});await this.monacoEditor.addJavaScriptLib(o,"defaultLib:lib.es6.d.ts")}render(){return this.hideLabel&&!this.shouldRenderMonaco()?i("div",{class:"tw-p-4"},i("div",{class:"tw-flex"},i("div",{class:"tw-flex-1"},this.renderEditor()),this.renderContextMenuWidget())):i("div",{class:"tw-p-4"},i("div",{class:"tw-mb-1"},i("div",{class:"tw-flex"},i("div",{class:"tw-flex-1"},this.renderLabel()),this.renderContextMenuWidget())),this.renderEditor())}renderLabel(){const t=this.fieldName,e=this.label||t;return i("label",{htmlFor:t,class:"tw-block tw-text-sm tw-font-medium tw-text-gray-700"},e)}renderContextMenuWidget(){if(0==this.supportedSyntaxes.length)return;const t=this.syntax;return i("div",{class:"tw-relative",ref:t=>this.contextMenuWidget=t},i("button",{type:"button",class:"tw-border-0 focus:tw-outline-none tw-text-sm "+(t?"tw-text-blue-500":"tw-text-gray-300"),onClick:t=>this.onSettingsClick(t)},this.isReadOnly?"":this.renderContextMenuButton()),i("div",null,i("div",{ref:t=>this.contextMenu=t,"data-transition-enter":"tw-transition tw-ease-out tw-duration-100","data-transition-enter-start":"tw-transform tw-opacity-0 tw-scale-95","data-transition-enter-end":"tw-transform tw-opacity-100 tw-scale-100","data-transition-leave":"tw-transition tw-ease-in tw-duration-75","data-transition-leave-start":"tw-transform tw-opacity-100 tw-scale-100","data-transition-leave-end":"tw-transform tw-opacity-0 tw-scale-95",class:"hidden tw-origin-top-right tw-absolute tw-right-1 tw-mt-1 tw-w-56 tw-rounded-md tw-shadow-lg tw-bg-white tw-ring-1 tw-ring-black tw-ring-opacity-5 tw-divide-y tw-divide-gray-100 focus:tw-outline-none tw-z-10",role:"menu","aria-orientation":"vertical","aria-labelledby":"options-menu"},i("div",{class:"tw-py-1",role:"none"},i("a",{onClick:t=>this.selectSyntax(t,null),href:"#",class:"tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900 "+(t?"tw-text-gray-700":"tw-text-blue-700"),role:"menuitem"},"Default")),i("div",{class:"tw-py-1",role:"none"},this.supportedSyntaxes.map((e=>i("a",{onClick:t=>this.selectSyntax(t,e),href:"#",class:"tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900 "+(t==e?"tw-text-blue-700":"tw-text-gray-700"),role:"menuitem"},e)))))))}toggleContextMenu(){o(this.contextMenu)}openContextMenu(){a(this.contextMenu)}closeContextMenu(){this.contextMenu&&c(this.contextMenu)}selectDefaultEditor(t){t.preventDefault(),this.syntax=void 0,this.closeContextMenu()}async selectSyntax(t,e){t.preventDefault(),this.syntax=e,this.syntaxChanged.emit(e),this.expressionChanged.emit({expression:this.currentExpression,syntax:e}),this.closeContextMenu()}onSettingsClick(t){this.toggleContextMenu()}onExpressionChanged(t){const e=t.value;this.currentExpression=e,this.expressionChanged.emit({expression:e,syntax:this.syntax})}};function b(t,e,i,n){function o(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){t.done?i(t.value):o(t.value).then(r,a)}l((n=n.apply(t,e||[])).next())}))}function x(t,e){var i,n,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(t){return function(e){return l([t,e])}}function l(a){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(i=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,n=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((o=(o=r.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],n=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}m.injectProps(y,["workflowDefinitionId","activityType","propertyName"]);var k=new Error("request for lock canceled"),C=function(){function t(t,e){void 0===e&&(e=k),this._value=t,this._cancelError=e,this._weightedQueues=[],this._weightedWaiters=[]}return t.prototype.acquire=function(t){var e=this;if(void 0===t&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise((function(i,n){e._weightedQueues[t-1]||(e._weightedQueues[t-1]=[]),e._weightedQueues[t-1].push({resolve:i,reject:n}),e._dispatch()}))},t.prototype.runExclusive=function(t,e){return void 0===e&&(e=1),b(this,void 0,void 0,(function(){var i,n,o;return x(this,(function(s){switch(s.label){case 0:return[4,this.acquire(e)];case 1:i=s.sent(),n=i[0],o=i[1],s.label=2;case 2:return s.trys.push([2,,4,5]),[4,t(n)];case 3:return[2,s.sent()];case 4:return o(),[7];case 5:return[2]}}))}))},t.prototype.waitForUnlock=function(t){var e=this;if(void 0===t&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise((function(i){e._weightedWaiters[t-1]||(e._weightedWaiters[t-1]=[]),e._weightedWaiters[t-1].push(i),e._dispatch()}))},t.prototype.isLocked=function(){return this._value<=0},t.prototype.getValue=function(){return this._value},t.prototype.setValue=function(t){this._value=t,this._dispatch()},t.prototype.release=function(t){if(void 0===t&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));this._value+=t,this._dispatch()},t.prototype.cancel=function(){var t=this;this._weightedQueues.forEach((function(e){return e.forEach((function(e){return e.reject(t._cancelError)}))})),this._weightedQueues=[]},t.prototype._dispatch=function(){for(var t,e=this._value;e>0;e--){var i=null===(t=this._weightedQueues[e-1])||void 0===t?void 0:t.shift();if(i){var n=this._value,o=e;this._value-=e,e=this._value+1,i.resolve([n,this._newReleaser(o)])}}this._drainUnlockWaiters()},t.prototype._newReleaser=function(t){var e=this,i=!1;return function(){i||(i=!0,e.release(t))}},t.prototype._drainUnlockWaiters=function(){for(var t=this._value;t>0;t--)this._weightedWaiters[t-1]&&(this._weightedWaiters[t-1].forEach((function(t){return t()})),this._weightedWaiters[t-1]=[])},t}(),j=function(){function t(t){this._semaphore=new C(1,t)}return t.prototype.acquire=function(){return b(this,void 0,void 0,(function(){return x(this,(function(t){switch(t.label){case 0:return[4,this._semaphore.acquire()];case 1:return[2,t.sent()[1]]}}))}))},t.prototype.runExclusive=function(t){return this._semaphore.runExclusive((function(){return t()}))},t.prototype.isLocked=function(){return this._semaphore.isLocked()},t.prototype.waitForUnlock=function(){return this._semaphore.waitForUnlock()},t.prototype.release=function(){this._semaphore.isLocked()&&this._semaphore.release()},t.prototype.cancel=function(){return this._semaphore.cancel()},t}();const _=window,L=_.require;var S=[];let M;const $=new j;async function E(t){return await $.runExclusive((async()=>{if(M)return _.monaco;if(f(t))return new Promise(((t,e)=>{const i=Date.now(),n=()=>{_.monaco?t(_.monaco):Date.now()-i>3e3?e("Monaco editor not loaded."):requestAnimationFrame(n)};n()}));const e=document.location.origin,i=t.startsWith("http")?t:`${e}/${t}`;L.config({paths:{vs:`${i}/vs`}}),_.MonacoEnvironment={getWorkerUrl:()=>n};let n=URL.createObjectURL(new Blob([`\n\tself.MonacoEnvironment = {\n\t\tbaseUrl: '${i}'\n\t};\n\timportScripts('${i}/vs/base/worker/workerMain.js');\n`],{type:"text/javascript"}));return new Promise((t=>{L(["vs/editor/editor.main"],(()=>{M=!0,D(_.monaco),N(_.monaco),t(_.monaco)}))}))}))}function D(t){t.languages.register({id:"liquid"}),t.languages.registerCompletionItemProvider("liquid",{provideCompletionItems:()=>{const e=[],i=["assign","capture","endcapture","increment","decrement","if","else","elsif","endif","for","endfor","break","continue","limit","offset","range","reversed","cols","case","endcase","when","tw-block","endblock","true","false","in","unless","endunless","cycle","tablerow","endtablerow","contains","startswith","endswith","comment","endcomment","raw","endraw","editable","endentitylist","endentityview","endinclude","endmarker","entitylist","entityview","forloop","image","include","marker","outputcache","plugin","style","text","widget","abs","append","at_least","at_most","capitalize","ceil","compact","concat","date","default","divided_by","downcase","escape","escape_once","first","floor","join","last","lstrip","map","minus","modulo","newline_to_br","plus","prepend","remove","remove_first","replace","replace_first","reverse","round","rstrip","size","slice","sort","sort_natural","split","strip","strip_html","strip_newlines","times","truncate","truncatewords","uniq","upcase","url_decode","url_encode"];for(let n=0;n<i.length;n++)e.push({label:i[n],kind:t.languages.CompletionItemKind.Keyword});return{suggestions:e}}})}function N(t){t.languages.registerCompletionItemProvider("sql",{triggerCharacters:["@"],provideCompletionItems:(e,i)=>{e.getWordUntilPosition(i);const n=[];for(const e of S)n.push({label:`${e.variableName}: ${e.type}`,kind:t.languages.CompletionItemKind.Variable,insertText:e.variableName});return{suggestions:n}}})}const q=".monaco-editor-host{display:block;position:relative;min-height:12em}.monaco-editor-container{position:absolute;left:0;top:0;width:100%;height:100%;max-height:100% !important;margin:0;padding:0}",I=class{constructor(e){t(this,e),this.valueChanged=n(this,"valueChanged",7),this.editorHeight="5em",this.value=void 0,this.language=void 0,this.singleLineMode=!1,this.padding=void 0}async languageChangeHandler(t){if(!this.editor)return;const e=this.editor.getModel();(await this.getMonaco()).editor.setModelLanguage(e,this.language)}async setValue(t){this.editor&&this.editor.getModel().setValue(t||"")}async addJavaScriptLib(t,e){const i=await this.getMonaco();i.languages.typescript.javascriptDefaults.setExtraLibs([{filePath:"lib.es5.d.ts"},{content:t,filePath:e}]);const n=i.editor.getModel(e);n&&n.dispose(),i.editor.createModel(t,"typescript",i.Uri.parse(e));const o=t.matchAll(/declare const (\w+): (string|number)/g);S.splice(0,S.length);for(const t of o)S.push({variableName:t[1],type:t[2]})}async componentDidLoad(){const t=await this.getMonaco(),e=this.language;t.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!0,noSyntaxValidation:!1}),t.languages.typescript.javascriptDefaults.setCompilerOptions({target:t.languages.typescript.ScriptTarget.ES2020,lib:[],allowNonTsExtensions:!0}),t.languages.typescript.javascriptDefaults.setEagerModelSync(!0);const i={value:this.value,language:e,fontFamily:"Roboto Mono, monospace",renderLineHighlight:"none",minimap:{enabled:!1},automaticLayout:!0,lineNumbers:"on",theme:"vs",roundedSelection:!0,scrollBeyondLastLine:!1,readOnly:!1,overviewRulerLanes:0,overviewRulerBorder:!1,lineDecorationsWidth:0,hideCursorInOverviewRuler:!0,glyphMargin:!1};let n=i;this.singleLineMode&&(n=Object.assign(Object.assign({},i),{wordWrap:"off",lineNumbers:"off",lineNumbersMinChars:0,folding:!1,scrollBeyondLastColumn:0,scrollbar:{horizontal:"hidden",vertical:"hidden"},find:{addExtraSpaceOnTop:!1,autoFindInSelection:"never",seedSearchStringFromSelection:!1}})),this.editor=t.editor.create(this.container,n),this.editor.onDidChangeModelContent((i=>{const n=this.editor.getValue(),o=t.editor.getModelMarkers({owner:e});this.valueChanged.emit({value:n,markers:o})})),this.singleLineMode&&(this.editor.onKeyDown((e=>{e.keyCode==t.KeyCode.Enter&&0==this.editor.getContribution("editor.contrib.suggestController").model.state&&e.preventDefault()})),this.editor.onDidPaste((t=>{if(t.range.endLineNumber>1){let t="";const e=this.editor.getModel();let i=e.getLineCount();for(let n=0;n<i;n++)t+=e.getLineContent(n+1);e.setValue(t)}})))}async getMonaco(){if(this.monaco)return this.monaco;const t=w.monacoLibPath;return this.monaco=await E(t)}disconnectedCallback(){const t=this.editor;t&&t.dispose()}render(){const t=this.padding||"tw-pt-1.5 tw-pl-1";return i(s,{class:"monaco-editor-host tw-border focus:tw-ring-blue-500 focus:tw-border-blue-500 tw-block tw-w-full tw-min-w-0 tw-rounded-md sm:tw-text-sm tw-border-gray-300 tw-p-4",style:{"min-height":this.editorHeight}},i("div",{ref:t=>this.container=t,class:`monaco-editor-container ${t}`}))}static get watchers(){return{language:["languageChangeHandler"]}}};I.style=q;export{v as context_consumer,y as elsa_input_control_switch,I as elsa_monaco_editor};