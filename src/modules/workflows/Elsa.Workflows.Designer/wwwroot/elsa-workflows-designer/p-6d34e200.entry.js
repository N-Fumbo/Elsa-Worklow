import{h as t,r as e,c as s,H as n}from"./p-a7a3baa1.js";import{l as i}from"./p-e71312f9.js";import{W as l,K as o,O as a,aa as c,ab as r,a3 as h,C as w,a0 as d,Y as u,ac as f,f as g,L as p}from"./p-dd7ad463.js";import{D as m}from"./p-615b6ee0.js";import{B as y,P as x,O as b}from"./p-81a70c3a.js";import"./p-fcfa9e22.js";import"./p-1de51046.js";import{E as v,D as k}from"./p-435023bb.js";import"./p-72dc819a.js";import"./p-144a434e.js";import"./p-4031f4ff.js";const S=()=>t("svg",{class:"tw-mr-3 tw-h-5 tw-w-5 tw-text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},t("path",{stroke:"none",d:"M0 0h24v24H0z"}),t("rect",{x:"4",y:"4",width:"6",height:"6",rx:"1"}),t("rect",{x:"14",y:"4",width:"6",height:"6",rx:"1"}),t("rect",{x:"4",y:"14",width:"6",height:"6",rx:"1"}),t("rect",{x:"14",y:"14",width:"6",height:"6",rx:"1"})),C=()=>t("svg",{class:"tw-mr-3 tw-h-5 tw-w-5 tw-text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},t("circle",{cx:"12",cy:"12",r:"10"}),t("polygon",{points:"10 8 16 12 10 16 10 8"})),I=({onSearch:e})=>{const s=i.debounce(e,200);return t("div",{class:"tw-relative tw-z-10 tw-flex-shrink-0 tw-flex tw-h-16 tw-bg-white tw-border-b tw-border-gray-200"},t("div",{class:"tw-flex-1 tw-px-4 tw-flex tw-justify-between sm:tw-px-6 lg:tw-px-8"},t("div",{class:"tw-flex-1 tw-flex"},t("form",{class:"tw-w-full tw-flex md:tw-ml-0",onSubmit:t=>{t.preventDefault();const s=t.target,n=new FormData(s).get("searchTerm").toString();e(n)}},t("label",{htmlFor:"search_field",class:"tw-sr-only"},"Search"),t("div",{class:"tw-relative tw-w-full tw-text-gray-400 focus-within:tw-text-gray-600"},t("div",{class:"tw-absolute tw-inset-y-0 tw-left-0 tw-flex tw-items-center tw-pointer-events-none"},t("svg",{class:"tw-h-5 tw-w-5",fill:"currentColor",viewBox:"0 0 20 20"},t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"}))),t("input",{name:"searchTerm",onKeyUp:t=>{const e=t.target.value;s(e)},class:"tw-block tw-w-full tw-h-full tw-pl-8 tw-pr-3 tw-py-2 tw-rounded-md tw-text-gray-900 tw-placeholder-cool-gray-500 focus:tw-placeholder-cool-gray-400 sm:tw-text-sm tw-border-0 focus:tw-outline-none focus:tw-ring-0",placeholder:"Search",type:"search"}))))))},j=({pageSizeFilter:e,workflowFilter:s,statusFilter:n,subStatusFilter:i,orderByFilter:l,resetFilter:o,onBulkDelete:a,onBulkCancel:r})=>t("div",{class:"tw-p-8 tw-flex tw-content-end tw-justify-right tw-bg-white tw-space-x-4"},t("div",{class:"tw-flex-shrink-0"},t(B,{onBulkDelete:a,onBulkCancel:r})),t("div",{class:"tw-flex-1"},"Â "),t("button",{onClick:o,type:"button",class:"tw-text-sm tw-text-blue-600 active:tw-text-blue-700 tw-px-3 active:ring tw-ring-blue-500 tw-rounded"},"Reset"),t(D,Object.assign({},e)),t(F,Object.assign({},s)),t(O,Object.assign({},n)),t(z,Object.assign({},i)),t(A,Object.assign({},l))),B=({onBulkDelete:e,onBulkCancel:s})=>t("elsa-dropdown-button",{text:"Bulk Actions",items:[{text:"Delete",name:"Delete"},{text:"Cancel",name:"Cancel"}],icon:t(y,null),origin:m.TopLeft,theme:"Secondary",onItemSelected:t=>{const n=t.detail;switch(n.name){case"Delete":e();break;case"Cancel":s();break;default:n.handler()}}}),D=({selectedPageSize:e,onChange:s})=>{const n=`Page size: ${e}`,i=[5,10,15,20,30,50,100].map((t=>({text:""+t,isSelected:t==e,value:t})));return t("elsa-dropdown-button",{text:n,items:i,icon:t(x,null),origin:m.TopRight,theme:"Secondary",onItemSelected:t=>s(parseInt(t.detail.value))})},F=({workflows:e,selectedWorkflowDefinitionId:s,onChange:n})=>{const i=e.find((t=>t.definitionId==s)),l=t=>{var e;return(null===(e=null==t?void 0:t.name)||void 0===e?void 0:e.length)>0?t.name:"Untitled"},o=s?l(i):"All workflows";let a=e.map((t=>({text:l(t),value:t.definitionId,isSelected:t.definitionId==s})));return a=[{text:"All",value:null,isSelected:!s},...a],t("elsa-dropdown-button",{text:o,items:a,icon:t(S,null),origin:m.TopRight,theme:"Secondary",onItemSelected:t=>n(t.detail.value)})},O=({selectedStatus:e,onChange:s})=>{const n=e||"Status",i=[null,l.Running,l.Finished].map((t=>({text:null!=t?t:"All",isSelected:t==e,value:t})));return t("elsa-dropdown-button",{text:n,items:i,icon:t(C,null),origin:m.TopRight,theme:"Secondary",onItemSelected:t=>s(t.detail.value)})},z=({selectedStatus:e,onChange:s})=>{const n=e||"Sub status",i=[null,o.Executing,o.Suspended,o.Finished,o.Faulted,o.Cancelled].map((t=>({text:null!=t?t:"All",isSelected:t==e,value:t})));return t("elsa-dropdown-button",{text:n,items:i,icon:t(C,null),origin:m.TopRight,theme:"Secondary",onItemSelected:t=>s(t.detail.value)})},A=({selectedOrderBy:e,onChange:s})=>{const n=e?`Ordered by: ${e}`:"Order by",i=[a.Finished,a.Updated,a.Created].map((t=>({text:t,value:t,isSelected:t==e})));return t("elsa-dropdown-button",{text:n,items:i,icon:t(b,null),theme:"Secondary",origin:m.TopRight,onItemSelected:t=>s(t.detail.value)})},W="LS/wfInstanceBrowser";function P(){var t=localStorage.getItem(W);if(t)return JSON.parse(t)}function T(t){localStorage.setItem(W,JSON.stringify(t))}const _={},L={};function M(t){var e;return null!==(e=L[t])&&void 0!==e?e:_[o.Suspended]}function N(t,e,s){const n=e.items.map((t=>t.id));return t?s.concat(n.filter((t=>!s.includes(t)))):s.filter((t=>!n.includes(t)))}_[l.Running]="bg-rose-600",_[l.Finished]="tw-bg-green-600",L[o.Executing]="bg-rose-600",L[o.Suspended]="tw-bg-blue-600",L[o.Finished]="tw-bg-green-600",L[o.Faulted]="tw-bg-red-600",L[o.Compensating]="bg-orange-600",L[o.Cancelled]="bg-gray-900";const U=class{constructor(t){e(this,t),this.workflowInstanceSelected=s(this,"workflowInstanceSelected",7),this.publishedOrLatestWorkflows=[],this.onDeleteManyClick=async()=>{0!=this.selectedWorkflowInstanceIds.length&&this.modalDialogService.show((()=>c.Warning("Are you sure you want to delete selected workflow instances?")),{actions:[r.Delete((async()=>{await this.workflowInstancesApi.deleteMany({workflowInstanceIds:this.selectedWorkflowInstanceIds}),await this.loadWorkflowInstances()})),r.Cancel()],modalType:h.Confirmation})},this.onCancelManyClick=async()=>{0!=this.selectedWorkflowInstanceIds.length&&this.modalDialogService.show((()=>c.Warning("Are you sure you want to cancel selected workflow instances?")),{actions:[r.Yes((async()=>{await this.workflowInstancesApi.cancelMany({workflowInstanceIds:this.selectedWorkflowInstanceIds}),await this.loadWorkflowInstances()})),r.Cancel()],modalType:h.Confirmation})},this.resetPagination=()=>{this.currentPage=0,this.selectedWorkflowInstanceIds=[]},this.loadWorkflowDefinitions=async()=>{const t=await this.workflowDefinitionsApi.list({versionOptions:{allVersions:!0}});this.publishedOrLatestWorkflows=this.selectLatestWorkflows(t.items)},this.getSelectAllState=()=>{const{items:t}=this.workflowInstances,e=this.selectedWorkflowInstanceIds;return t.findIndex((t=>!e.includes(t.id)))<0},this.setSelectAllIndeterminateState=()=>{if(this.selectAllCheckbox){const t=this.workflowInstances.items.filter((t=>this.selectedWorkflowInstanceIds.includes(t.id)));this.selectAllCheckbox.indeterminate=0!=t.length&&t.length!=this.workflowInstances.items.length}},this.selectLatestWorkflows=t=>{const e=i.groupBy(t,"definitionId");return i.map(e,(t=>i.first(i.orderBy(t,"version","desc"))))},this.onSearch=async t=>{this.searchTerm=t,this.resetPagination(),await this.loadWorkflowInstances()},this.onPageSizeChanged=async t=>{this.currentPageSize=t,this.resetPagination(),await this.loadWorkflowInstances()},this.onWorkflowChanged=async t=>{this.selectedWorkflowDefinitionId=t,this.resetPagination(),await this.loadWorkflowInstances()},this.onWorkflowStatusChanged=async t=>{this.selectedStatus=t,this.resetPagination(),await this.loadWorkflowInstances()},this.onWorkflowSubStatusChanged=async t=>{this.selectedSubStatus=t,this.resetPagination(),await this.loadWorkflowInstances()},this.onOrderByChanged=async t=>{this.orderBy=t,await this.loadWorkflowInstances()},this.onWorkflowInstanceClick=async(t,e)=>{t.preventDefault(),this.workflowInstanceSelected.emit(e)},this.onPaginated=async t=>{this.currentPage=t.detail.page,await this.loadWorkflowInstances()},this.workflowDefinition=void 0,this.workflowInstances={items:[],totalCount:0},this.workflows=[],this.selectAllChecked=void 0,this.selectedWorkflowInstanceIds=[],this.searchTerm=void 0,this.currentPage=0,this.currentPageSize=U.DEFAULT_PAGE_SIZE,this.selectedWorkflowDefinitionId=void 0,this.selectedStatus=void 0,this.selectedSubStatus=void 0,this.orderBy=void 0,this.workflowInstancesApi=w.get(d),this.workflowDefinitionsApi=w.get(u),this.modalDialogService=w.get(f)}async componentWillLoad(){var t=P();t&&(this.currentPage=t.page,this.currentPageSize=t.pageSize,this.orderBy=t.orderBy,this.selectedWorkflowDefinitionId=t.definitionId,this.selectedStatus=t.status,this.selectedSubStatus=t.subStatus),null!=this.workflowDefinition&&(this.selectedWorkflowDefinitionId=this.workflowDefinition.definitionId),await this.loadWorkflowDefinitions(),await this.loadWorkflowInstances()}render(){const e=this.publishedOrLatestWorkflows,s=this.workflowInstances,i=s.totalCount,l={pageSizeFilter:{selectedPageSize:this.currentPageSize,onChange:this.onPageSizeChanged},orderByFilter:{selectedOrderBy:this.orderBy,onChange:this.onOrderByChanged},statusFilter:{selectedStatus:this.selectedStatus,onChange:this.onWorkflowStatusChanged},subStatusFilter:{selectedStatus:this.selectedSubStatus,onChange:this.onWorkflowSubStatusChanged},workflowFilter:{workflows:e,selectedWorkflowDefinitionId:this.selectedWorkflowDefinitionId,onChange:this.onWorkflowChanged},resetFilter:async()=>{this.resetPagination(),this.currentPageSize=U.DEFAULT_PAGE_SIZE,this.selectedStatus=void 0,this.selectedSubStatus=void 0,this.orderBy=void 0,this.selectedWorkflowDefinitionId=void 0,await this.loadWorkflowInstances()},onBulkDelete:this.onDeleteManyClick,onBulkCancel:this.onCancelManyClick};return t(n,{class:"tw-block"},t("div",{class:"tw-pt-4"},t("h2",{class:"tw-text-lg tw-font-medium tw-ml-4 tw-mb-2"},"Workflow Instances"),t(I,{onSearch:this.onSearch}),t(j,Object.assign({},l)),t("div",{class:"tw-align-middle tw-inline-block tw-min-w-full tw-border-b tw-border-gray-200"},t("table",{class:"default-table"},t("thead",null,t("tr",null,t("th",null,t("input",{type:"checkbox",value:"true",checked:this.getSelectAllState(),onChange:t=>this.onSelectAllCheckChange(t),ref:t=>this.selectAllCheckbox=t})),t("th",null,t("span",{class:"lg:tw-pl-2"},"ID")),t("th",null,"Correlation"),t("th",null,"Workflow"),t("th",{class:"tw-align-right"},"Version"),t("th",null,"Name"),t("th",null,"Status"),t("th",null,"Created"),t("th",null,"Finished"),t("th",null))),t("tbody",{class:"tw-bg-white tw-divide-y tw-divide-gray-100"},s.items.map((s=>{const n=M(s.subStatus),i=this.selectedWorkflowInstanceIds.findIndex((t=>t===s.id))>=0,l=e.find((t=>t.definitionId==s.definitionId)),o=l?l.name||"Untitled":"(Definition not found)";return t("tr",null,t("td",null,t("input",{type:"checkbox",value:s.id,checked:i,onChange:t=>this.onWorkflowInstanceCheckChange(t,s)})),t("td",null,t("div",{class:"tw-flex tw-items-center tw-space-x-3 lg:tw-pl-2"},t("a",{onClick:t=>this.onWorkflowInstanceClick(t,s),href:"#",class:"tw-truncate hover:tw-text-gray-600"},t("span",null,s.id)))),t("td",null,s.correlationId),t("td",null,o),t("td",{class:"tw-align-right"},s.version),t("td",null,s.name),t("td",null,t("div",{class:"tw-flex tw-items-center tw-space-x-3 lg:tw-pl-2"},t("div",{class:`tw-flex-shrink-0 tw-w-2.5 tw-h-2.5 tw-rounded-full ${n}`}),t("span",null,s.status))),t("td",null,g(s.createdAt,"-")),t("td",null,g(s.finishedAt,"-")),t("td",{class:"tw-pr-6"},t("elsa-context-menu",{menuItems:[{text:"Edit",handler:t=>this.onWorkflowInstanceClick(t,s),icon:t(v,null)},{text:"Delete",handler:t=>this.onDeleteClick(t,s),icon:t(k,null)}]})))})))),t("elsa-pager",{page:this.currentPage,pageSize:this.currentPageSize,totalCount:i,onPaginated:this.onPaginated}))))}async loadWorkflowInstances(){const t={searchTerm:this.searchTerm,definitionId:this.selectedWorkflowDefinitionId,status:this.selectedStatus,subStatus:this.selectedSubStatus,orderBy:this.orderBy,orderDirection:p.Descending,page:this.currentPage,pageSize:this.currentPageSize};T(t),this.workflowInstances=await this.workflowInstancesApi.list(t)}async onDeleteClick(t,e){await this.workflowInstancesApi.delete(e),await this.loadWorkflowInstances()}onSelectAllCheckChange(t){const e=t.target.checked;this.selectAllChecked=e,this.selectedWorkflowInstanceIds=N(e,this.workflowInstances,this.selectedWorkflowInstanceIds)}onWorkflowInstanceCheckChange(t,e){const s=t.target.checked;this.selectedWorkflowInstanceIds=s?[...this.selectedWorkflowInstanceIds,e.id]:this.selectedWorkflowInstanceIds.filter((t=>t!=e.id)),this.setSelectAllIndeterminateState()}};U.DEFAULT_PAGE_SIZE=15,U.MIN_PAGE_SIZE=5,U.MAX_PAGE_SIZE=100,U.START_PAGE=0;export{U as elsa_workflow_instance_browser};