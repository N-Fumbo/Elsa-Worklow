import{h as t,r as s,c as e,H as i}from"./p-a7a3baa1.js";import{E as n,D as l}from"./p-435023bb.js";import{l as o}from"./p-e71312f9.js";import{D as a}from"./p-615b6ee0.js";import{B as h,P as r,O as c}from"./p-81a70c3a.js";import{Z as w,aa as u,ab as d,a3 as f,C as p,Y as m,ac as b,A as y}from"./p-dd7ad463.js";import"./p-fcfa9e22.js";import"./p-1de51046.js";import"./p-72dc819a.js";import"./p-144a434e.js";import"./p-4031f4ff.js";const g=()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"tw-h-5 tw-w-5 tw-text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})),k=()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"tw-h-5 tw-w-5 tw-text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})),x=({onSearch:e})=>{const i=o.debounce(e,200);return t("div",{class:"tw-relative tw-z-10 tw-flex-shrink-0 tw-flex tw-h-16 tw-bg-white tw-border-b tw-border-gray-200"},t("div",{class:"tw-flex-1 tw-px-4 tw-flex tw-justify-between sm:tw-px-6 lg:tw-px-8"},t("div",{class:"tw-flex-1 tw-flex"},t("form",{class:"tw-w-full tw-flex md:tw-ml-0",onSubmit:t=>{t.preventDefault();const i=t.target,n=new FormData(i).get("searchTerm").toString();e(n)}},t("label",{htmlFor:"search_field",class:"tw-sr-only"},"Search"),t("div",{class:"tw-relative tw-w-full tw-text-gray-400 focus-within:tw-text-gray-600"},t("div",{class:"tw-absolute tw-inset-y-0 tw-left-0 tw-flex tw-items-center tw-pointer-events-none"},t("svg",{class:"tw-h-5 tw-w-5",fill:"currentColor",viewBox:"0 0 20 20"},t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"}))),t("input",{name:"searchTerm",onKeyUp:t=>{const e=t.target.value;i(e)},class:"tw-block tw-w-full tw-h-full tw-pl-8 tw-pr-3 tw-py-2 tw-rounded-md tw-text-gray-900 tw-placeholder-cool-gray-500 focus:tw-placeholder-cool-gray-400 sm:tw-text-sm tw-border-0 focus:tw-outline-none focus:tw-ring-0",placeholder:"Search",type:"search"}))))))},v=({pageSizeFilter:e,orderByFilter:i,onBulkDelete:n,onBulkPublish:s,onBulkUnpublish:l,labelFilter:o})=>t("div",{class:"tw-p-8 tw-flex tw-content-end tw-justify-right tw-bg-white tw-space-x-4"},t("div",{class:"tw-flex-shrink-0"},t(S,{onBulkDelete:n,onBulkPublish:s,onBulkUnpublish:l})),t("div",{class:"tw-flex-1"},"Â "),t(C,Object.assign({},e)),t(B,Object.assign({},i))),S=({onBulkDelete:e,onBulkPublish:i,onBulkUnpublish:n})=>t("elsa-dropdown-button",{text:"Bulk Actions",items:[{text:"Delete",name:"Delete"},{text:"Publish",name:"Publish"},{text:"Unpublish",name:"Unpublish"}],theme:"Secondary",icon:t(h,null),origin:a.TopLeft,onItemSelected:t=>{const s=t.detail;switch(s.name){case"Delete":e();break;case"Publish":i();break;case"Unpublish":n();break;default:s.handler()}}}),C=({selectedPageSize:e,onChange:i})=>{const n=`Page size: ${e}`,s=[5,10,15,20,30,50,100].map((t=>({text:""+t,isSelected:t==e,value:t})));return t("elsa-dropdown-button",{text:n,items:s,theme:"Secondary",icon:t(r,null),origin:a.TopRight,onItemSelected:t=>i(parseInt(t.detail.value))})},B=({selectedOrderBy:e,onChange:i})=>{const n=e?`Ordered by: ${e}`:"Order by",s=[w.Name,w.Created].map((t=>({text:t,value:t,isSelected:t==e})));return t("elsa-dropdown-button",{text:n,items:s,theme:"Secondary",icon:t(c,null),origin:a.TopRight,onItemSelected:t=>i(t.detail.value)})};function j(t,e,i){const n=e.items.filter((t=>!t.isReadonly)).map((t=>t.definitionId));return t?i.concat(n.filter((t=>!i.includes(t)))):i.filter((t=>!n.includes(t)))}const D="LS/wfDefinitionBrowser";function P(){var t=localStorage.getItem(D);if(t)return JSON.parse(t)}function z(t){localStorage.setItem(D,JSON.stringify(t))}const I=class{constructor(t){s(this,t),this.workflowDefinitionSelected=e(this,"workflowDefinitionSelected",7),this.workflowInstancesSelected=e(this,"workflowInstancesSelected",7),this.newWorkflowDefinitionSelected=e(this,"newWorkflowDefinitionSelected",7),this.onNewDefinitionClick=async()=>{this.newWorkflowDefinitionSelected.emit()},this.onSearch=async t=>{this.searchTerm=t,this.resetPagination(),await this.loadWorkflowDefinitions()},this.onDeleteManyClick=async()=>{0!=this.selectedWorkflowDefinitionIds.length&&this.modalDialogService.show((()=>u.Warning("Are you sure you want to delete selected workflow definitions?")),{actions:[d.Delete((async()=>{await this.api.deleteMany({definitionIds:this.selectedWorkflowDefinitionIds}),await this.loadWorkflowDefinitions(),await this.activityDescriptorManager.refresh()})),d.Cancel()],modalType:f.Confirmation})},this.onPublishManyClick=async()=>{0!=this.selectedWorkflowDefinitionIds.length&&this.modalDialogService.show((()=>u.Warning("Are you sure you want to publish selected workflow definitions?")),{actions:[d.Publish((async()=>{await this.api.publishMany({definitionIds:this.selectedWorkflowDefinitionIds}),await this.loadWorkflowDefinitions()})),d.Cancel()],modalType:f.Confirmation})},this.onUnpublishManyClick=async()=>{0!=this.selectedWorkflowDefinitionIds.length&&this.modalDialogService.show((()=>u.Warning("Are you sure you want to unpublish selected workflow definitions?")),{actions:[d.Unpublish((async()=>{await this.api.unpublishMany({definitionIds:this.selectedWorkflowDefinitionIds}),await this.loadWorkflowDefinitions()})),d.Cancel()],modalType:f.Confirmation})},this.onWorkflowDefinitionClick=async(t,e)=>{t.preventDefault(),this.workflowDefinitionSelected.emit(e)},this.onWorkflowInstancesClick=async(t,e)=>{t.preventDefault(),this.workflowInstancesSelected.emit(e)},this.onPaginated=async t=>{this.currentPage=t.detail.page,await this.loadWorkflowDefinitions()},this.onPageSizeChanged=async t=>{this.currentPageSize=t,this.resetPagination(),await this.loadWorkflowDefinitions()},this.onOrderByChanged=async t=>{this.orderBy=t,await this.loadWorkflowDefinitions()},this.onLabelChange=async t=>{this.labels=t.detail,await this.loadWorkflowDefinitions()},this.resetPagination=()=>{this.currentPage=0,this.selectedWorkflowDefinitionIds=[]},this.getSelectAllState=()=>{const{items:t}=this.workflowDefinitions,e=this.selectedWorkflowDefinitionIds;return t.findIndex((t=>!e.includes(t.definitionId)))<0},this.setSelectAllIndeterminateState=()=>{if(this.selectAllCheckbox){const t=this.workflowDefinitions.items.filter((t=>this.selectedWorkflowDefinitionIds.includes(t.definitionId)));this.selectAllCheckbox.indeterminate=0!=t.length&&t.length!=this.workflowDefinitions.items.length}},this.workflowDefinitions={items:[],totalCount:0},this.publishedWorkflowDefinitions={items:[],totalCount:0},this.selectedWorkflowDefinitionIds=[],this.currentPage=0,this.currentPageSize=I.DEFAULT_PAGE_SIZE,this.orderBy=void 0,this.labels=void 0,this.selectAllChecked=void 0,this.searchTerm=void 0,this.api=p.get(m),this.modalDialogService=p.get(b),this.activityDescriptorManager=p.get(y)}async componentWillLoad(){const t=P();t&&(this.currentPage=t.page,this.currentPageSize=t.pageSize,this.orderBy=t.orderBy),await this.loadWorkflowDefinitions()}async onPublishClick(t,e){await this.api.publish(e),await this.loadWorkflowDefinitions()}async onUnPublishClick(t,e){await this.api.retract(e),await this.loadWorkflowDefinitions()}async onDeleteClick(t,e){this.modalDialogService.show((()=>u.Warning("Are you sure you want to delete this workflow definition?")),{actions:[d.Delete((async()=>{await this.api.delete(e),await this.loadWorkflowDefinitions(),await this.activityDescriptorManager.refresh()})),d.Cancel()],modalType:f.Confirmation})}async loadWorkflowDefinitions(){const t="Json",e={searchTerm:this.searchTerm,materializerName:t,page:this.currentPage,pageSize:this.currentPageSize,versionOptions:{isLatest:!0},orderBy:this.orderBy,label:this.labels};z(e);const i=await this.api.list(e),n=i.items.filter((t=>!t.isPublished)).map((t=>t.definitionId));this.publishedWorkflowDefinitions=await this.api.list({materializerName:t,definitionIds:n,versionOptions:{isPublished:!0}}),this.workflowDefinitions=i}onWorkflowDefinitionCheckChange(t,e){const i=t.target.checked;this.selectedWorkflowDefinitionIds=i?[...this.selectedWorkflowDefinitionIds,e.definitionId]:this.selectedWorkflowDefinitionIds.filter((t=>t!=e.definitionId)),this.setSelectAllIndeterminateState()}onSelectAllCheckChange(t){const e=t.target.checked;this.selectAllChecked=e,this.selectedWorkflowDefinitionIds=j(e,this.workflowDefinitions,this.selectedWorkflowDefinitionIds)}render(){const e=this.workflowDefinitions,s=this.publishedWorkflowDefinitions.items,o=e.totalCount,a={pageSizeFilter:{selectedPageSize:this.currentPageSize,onChange:this.onPageSizeChanged},orderByFilter:{selectedOrderBy:this.orderBy,onChange:this.onOrderByChanged},labelFilter:{selectedLabels:this.labels,onSelectedLabelsChanged:this.onLabelChange,buttonClass:"tw-text-gray-500 hover:tw-text-gray-300",containerClass:"tw-mt-1.5"},onBulkDelete:this.onDeleteManyClick,onBulkPublish:this.onPublishManyClick,onBulkUnpublish:this.onUnpublishManyClick};return t(i,{class:"tw-block"},t("div",{class:"tw-pt-4"},t("h2",{class:"tw-text-lg tw-font-medium tw-ml-4 tw-mb-2"},"Workflow Definitions"),t(x,{onSearch:this.onSearch}),t(v,Object.assign({},a)),t("div",{class:"tw-align-middle tw-inline-block tw-min-w-full tw-border-b tw-border-gray-200"},t("table",{class:"default-table"},t("thead",null,t("tr",null,t("th",null,t("input",{type:"checkbox",value:"true",checked:this.getSelectAllState(),onChange:t=>this.onSelectAllCheckChange(t),ref:t=>this.selectAllCheckbox=t})),t("th",null,t("span",{class:"lg:tw-pl-2"},"Name")),t("th",null,"Instances"),t("th",{class:"tw-align-right"},"Latest Version"),t("th",{class:"tw-align-right"},"Published Version"),t("th",null))),t("tbody",null,e.items.map((e=>{const i=e.version,{isPublished:o}=e,a=o?e:s.find((t=>t.definitionId==e.definitionId)),r=a?a.version:"-",c=e.isReadonly,h=this.selectedWorkflowDefinitionIds.findIndex((t=>t===e.definitionId))>=0;let d=e.name;return d&&0!=d.trim().length||(d="Untitled"),t("tr",null,t("td",null,t("input",{disabled:c,type:"checkbox",value:e.definitionId,checked:h,onChange:t=>this.onWorkflowDefinitionCheckChange(t,e)})),t("td",null,t("div",{class:"tw-flex tw-items-center tw-space-x-3 lg:tw-pl-2"},t("a",{onClick:t=>this.onWorkflowDefinitionClick(t,e),href:"#",class:"tw-truncate hover:tw-text-gray-600"},t("span",null,d)))),t("td",null,t("div",{class:"tw-flex tw-items-center tw-space-x-3 lg:tw-pl-2"},t("a",{onClick:t=>this.onWorkflowInstancesClick(t,e),href:"#",class:"tw-truncate hover:tw-text-gray-600"},"Instances"))),t("td",{class:"tw-align-right"},i),t("td",{class:"tw-align-right"},r),t("td",{class:"tw-pr-6"},c?"":t("elsa-context-menu",{menuItems:[{text:"Edit",handler:t=>this.onWorkflowDefinitionClick(t,e),icon:t(n,null)},o?{text:"Unpublish",handler:t=>this.onUnPublishClick(t,e),icon:t(k,null)}:{text:"Publish",handler:t=>this.onPublishClick(t,e),icon:t(g,null)},{text:"Delete",handler:t=>this.onDeleteClick(t,e),icon:t(l,null)}]})))})))),t("elsa-pager",{page:this.currentPage,pageSize:this.currentPageSize,totalCount:o,onPaginated:this.onPaginated}))))}};I.DEFAULT_PAGE_SIZE=15,I.MIN_PAGE_SIZE=5,I.MAX_PAGE_SIZE=100,I.START_PAGE=0;export{I as elsa_workflow_definition_browser};