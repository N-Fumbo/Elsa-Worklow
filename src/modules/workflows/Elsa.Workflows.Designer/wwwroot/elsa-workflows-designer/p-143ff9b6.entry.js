import{r as t,c as n,h as r,a as e,H as i}from"./p-a7a3baa1.js";import"./p-fcfa9e22.js";import{l as a}from"./p-e71312f9.js";import{G as o,H as u,P as f}from"./p-f0e15ec1.js";import{C as s,w as c,ak as l,al as v,am as d,an as h,a8 as b,J as p,Q as m,ah as y,ao as w,ap as g,B as E,aq as A,x as _,ar as T}from"./p-dd7ad463.js";import{s as R}from"./p-1de51046.js";import{w as O,f as x,c as j}from"./p-e8341dd3.js";import{C as S}from"./p-c59e6626.js";import{a as N,b as I,c as M}from"./p-72dc819a.js";import{F as C}from"./p-d96f92e5.js";import{P as L}from"./p-d59dea2d.js";import"./p-144a434e.js";import"./p-4031f4ff.js";import"./p-37e9f5c1.js";class k extends u{get text(){return this.store.get("text")}set text(e){this.store.set("text",e)}get activity(){return this.store.get("activity")}set activity(e){this.store.set("activity",e)}get activityDescriptor(){return this.store.get("activityDescriptor")}set activityDescriptor(e){this.store.set("activityDescriptor",e)}init(){super.init(),this.updateSize()}setup(){const e=this;super.setup(),this.on("change:text",this.updateSize,this),this.on("change:activity",this.updateSize,this),this.html={render:()=>e.createHtml(),shouldComponentUpdate:e=>e.hasChanged("text")||e.hasChanged("activity")}}updateSize(){if(!this.activityDescriptor)return;const e=document.createElement("div");e.className="tw-inline-block tw-flex tw-items-center tw-pl-10 tw-pr-2 tw-py-2 tw-absolute",e.style.left="-1000px",e.style.top="-1000px",e.innerHTML=this.createHtml(),document.getElementsByTagName("elsa-studio")[0].append(e);const t=()=>{const r=e.getElementsByTagName("elsa-default-activity-template")[0].getBoundingClientRect();if(0==r.width||0==r.height)return void window.requestAnimationFrame(t);const n=e.firstElementChild.getBoundingClientRect(),i=n.width,o=n.height;this.prop({size:{width:i,height:o}}),e.remove()};t()}createHtml(){const e=this.activityDescriptor,t=this.activity,r=e.typeName,n={activity:t,activityDescriptor:e,displayType:"designer"};return s.get(c).createDriver(r).display(n)}}function U(e,t,r){const n=new o({container:e,interacting:t,embedding:{enabled:!1},grid:{type:"mesh",size:20,visible:!0,args:{color:"#e0e0e0"}},height:5e3,width:5e3,async:!1,autoResize:!0,keyboard:{enabled:!0,global:!1},clipboard:{enabled:!0,useLocalStorage:!0},selecting:{enabled:!0,showNodeSelectionBox:!0,rubberband:!0},scroller:{enabled:!0,pannable:!0,pageVisible:!1,pageBreak:!1,padding:0,modifiers:["ctrl","meta"]},connecting:{allowBlank:!1,allowMulti:!0,allowLoop:!0,allowNode:!0,allowEdge:!1,allowPort:!0,highlight:!0,router:{name:"manhattan",args:{startDirections:["top","right","left","bottom"],endDirections:["top","right","left","bottom"]}},connector:{name:"rounded",args:{radius:20}},snap:{radius:20},validateMagnet:({view:e,magnet:t})=>"in"!==e.cell.getPort(t.getAttribute("port")).type,validateConnection({sourceView:e,targetView:t,sourceMagnet:r,targetMagnet:n}){if(!r||!n)return!1;const i=e.cell.getPort(r.getAttribute("port")),o=t.cell.getPort(n.getAttribute("port"));return"in"!==i.type&&"in"===o.type&&(n.getAttribute("port"),!(o&&o.connected))},createEdge:()=>n.createEdge({shape:"elsa-edge",zIndex:-1})},onPortRendered(e){const t=e.contentSelectors,r=t&&t.foContent;if(r){const e=document.createElement("div");e.className="tw-rounded-full tw-border tw-border-2 tw-border-blue tw-h-8 tw-w-8",e.innerHTML="<p>done</p>",r.append(e)}},mousewheel:{enabled:!0,modifiers:["ctrl","meta"]},history:{enabled:!0,beforeAddCommand:(e,t)=>"tools"!=t.key&&["cell:added","cell:removed","cell:change:*"].indexOf(e)>=0}});return n.on("node:mousedown",(({node:e})=>{e.toFront()})),n.on("edge:mouseenter",(({edge:e})=>{e.addTools(["source-arrowhead","target-arrowhead",{name:"button-remove",args:{distance:-30}}])})),n.on("edge:mouseleave",(({edge:e})=>{e.removeTools()})),n.bindKey(["meta+c","ctrl+c"],(()=>{const e=n.getSelectedCells();return e.length&&n.copy(e),!1})),n.bindKey(["meta+x","ctrl+x"],(()=>{const e=n.getSelectedCells();return e.length&&n.cut(e),!1})),n.bindKey(["meta+v","ctrl+v"],(async()=>{var e,t;if(!n.isClipboardEmpty()){const i=[...r()],o=n.getCellsInClipboard(),a=o.filter((e=>"activity"==e.shape)),s=o.filter((e=>"elsa-edge"==e.shape)),c={},u=[];for(const e of a){const t=e.clone({keepId:!1}),r=Object.assign({},t.getData()),n=r.type,o=R.activityDescriptors.find((e=>e.typeName==n)),a=r.id,s=!!i.find((e=>e.id==a));if(s){const e=await l(i,o);c[a]=e,r.id=e}t.replaceData(r,{}),t.activity=r,t.isClone=!0,t.id=r.id,t.store.data.id=r.id;const f=t,d=f.getPosition();d.x+=64,d.y+=64,f.setPosition(d),i.push(r),u.push(t)}for(const r of s){const i=Object.assign({},r.getData());i.source={activity:null!==(e=c[i.source.activity])&&void 0!==e?e:i.source.activity,port:v(i.source.port)},i.target={activity:null!==(t=c[i.target.activity])&&void 0!==t?t:i.target.activity,port:v(i.target.port)};const o=h(i),a=n.createEdge(o);u.push(a)}n.addCell(u,{}),requestAnimationFrame((()=>{n.cleanSelection(),n.select(u)}))}return!1})),n.bindKey(["meta+z","ctrl+z"],(()=>(n.history.canUndo()&&n.history.undo(),!1))),n.bindKey(["meta+y","ctrl+y"],(()=>(n.history.canRedo()&&n.history.redo(),!1))),n.bindKey(["meta+a","ctrl+a"],(()=>{const e=n.getNodes();e&&n.select(e)})),n.bindKey("del",(()=>{const e=n.getSelectedCells();e.length&&n.removeCells(e)})),n.bindKey(["ctrl+1","meta+1"],(()=>{n.zoom()<1.5&&n.zoom(.1)})),n.bindKey(["ctrl+2","meta+2"],(()=>{n.zoom()>.5&&n.zoom(-.1)})),n.on("node:moving",(({node:e})=>{d(n,e)})),n}k.config({ports:{groups:{left:{position:"left",attrs:{circle:{r:5,magnet:!0,stroke:"#3c82f6",strokeWidth:2,fill:"#fff"},text:{fontSize:12,fill:"#888"}},label:{position:{name:"outside"}}},right:{position:"right",attrs:{circle:{r:5,magnet:!0,stroke:"#3c82f6",strokeWidth:2,fill:"#fff"},text:{fontSize:12,fill:"#888"}},label:{position:{name:"outside"}}},top:{position:"top",attrs:{circle:{r:5,magnet:!0,stroke:"#3c82f6",strokeWidth:2,fill:"#fff"},text:{fontSize:12,fill:"#888"}},label:{position:{name:"outside"}}},bottom:{position:"bottom",attrs:{circle:{r:5,magnet:!0,stroke:"#3c82f6",strokeWidth:2,fill:"#fff"},text:{fontSize:12,fill:"#888"}},label:{position:{name:"outside"}}}}}}),o.registerNode("activity",k,!0),o.registerConnector("elsa-connector",((e,t)=>{const r=Math.abs(t.y-e.y),n=Math.floor(r/3*2),i=e.x,o=e.y+0+n,a=t.x,s=t.y-0-n;return f.normalize(`M ${e.x} ${e.y}\n       L ${e.x} ${e.y+0}\n       C ${i} ${o} ${a} ${s} ${t.x} ${t.y-0}\n       L ${t.x} ${t.y}\n      `)}),!0),o.registerEdge("elsa-edge",{inherit:"edge",attrs:{line:{stroke:"#C2C8D5",strokeWidth:1,targetMarker:"classic",size:6}}},!0);var F=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},B=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let D=class{constructor(){this.portProviderRegistry=s.get(p)}createDesignerNode(e){const{activityDescriptor:t,activity:r,x:n,y:i}=e,o=this.createPorts(e);return{id:r.id,shape:"activity",activity:r,activityDescriptor:t,x:n,y:i,data:r,ports:o}}createPorts(e){const{activityDescriptor:t,activity:r}=e,n=this.portProviderRegistry.get(t.typeName),i={activityDescriptor:t,activity:r},o=[{name:"In",displayName:null,mode:m.Flow}];let a=n.getOutboundPorts(i).filter((e=>e.type==m.Flow));0==a.length&&(a=[{name:"Done",displayName:"Done",type:m.Flow}]),1==a.length&&(a[0].displayName=null);const s=o.map((e=>({id:y()+"_"+e.name,group:"left",attrs:e.displayName?{text:{text:e.displayName}}:null,type:"in",position:"left"}))),c=a.map((e=>({id:y()+"_"+e.name,group:"right",attrs:{text:{text:e.displayName}},type:"out",position:"right"})));return[...s,...c]}};D=F([b(),B("design:paramtypes",[])],D);var P=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};let G=class{constructor(){this.handlerMap=new Map,this.defaultHandlerFactory=()=>s.get(D)}add(e,t){this.handlerMap.set(e,t)}get(e){return this.handlerMap.get(e)}createHandler(e){var t;return(null!==(t=this.get(e))&&void 0!==t?t:this.defaultHandlerFactory)()}};G=P([b()],G);var V=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},X=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let z=class{constructor(){this.handlerRegistry=s.get(G)}createNode(e,t,r,n){return this.handlerRegistry.createHandler(e.typeName).createDesignerNode({activityDescriptor:e,activity:t,x:r,y:n})}createPorts(e,t){return this.handlerRegistry.createHandler(e.typeName).createPorts({activityDescriptor:e,activity:t})}};z=V([b(),X("design:paramtypes",[])],z);const H={ConnectionCreated:"connection-created"};class W{constructor(){this.nodes=[],this.edges=[],this.combos=[],this.comboEdges=[],this.hiddenNodes=[],this.hiddenEdges=[],this.hiddenCombos=[],this.vedges=[],this.positions=[],this.destroyed=!1,this.onLayoutEnd=()=>{}}layout(e){return this.init(e),this.execute(!0)}init(e){this.nodes=e.nodes||[],this.edges=e.edges||[],this.combos=e.combos||[],this.comboEdges=e.comboEdges||[],this.hiddenNodes=e.hiddenNodes||[],this.hiddenEdges=e.hiddenEdges||[],this.hiddenCombos=e.hiddenCombos||[],this.vedges=e.vedges||[]}execute(e){}executeWithWorker(){}getDefaultCfg(){return{}}updateCfg(e){e&&Object.assign(this,e)}getType(){return"base"}destroy(){this.nodes=null,this.edges=null,this.combos=null,this.positions=null,this.destroyed=!0}}const $=e=>"string"==typeof e,Y=Array.isArray,q=e=>"number"==typeof e,K=e=>null!==e&&"object"==typeof e,Q=e=>{if(null===e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array){const t=[];return e.forEach((e=>{t.push(e)})),t.map((e=>Q(e)))}if("object"==typeof e&&Object.keys(e).length){const t=Object.assign({},e);return Object.keys(t).forEach((e=>{t[e]=Q(t[e])})),t}return e},Z=(e,t)=>{const r=e[t];return K(r)?r.cell:r},J=(e,t,r)=>{let n;return n=r||(q(e)?()=>e:()=>t),n},tt=(e,t)=>{if("next"!==e&&"prev"!==e)return t},nt=e=>{e.prev.next=e.next,e.next.prev=e.prev,delete e.next,delete e.prev};class rt{constructor(){const e={};e.prev=e,e.next=e.prev,this.shortcut=e}dequeue(){const e=this.shortcut,t=e.prev;if(t&&t!==e)return nt(t),t}enqueue(e){const t=this.shortcut;e.prev&&e.next&&nt(e),e.next=t.next,t.next.prev=e,t.next=e,e.prev=t}toString(){const e=[],t=this.shortcut;let r=t.prev;for(;r!==t;)e.push(JSON.stringify(r,tt)),r=null==r?void 0:r.prev;return`[${e.join(", ")}]`}}var et;function it(e,t){var r=e.get(t)||0;e.set(t,r+1)}function at(e,t){var r=e.get(t);void 0!==r&&((r-=1)>0?e.set(t,r):e.delete(t))}function ot(e,t,r,n){var i=String(t),o=String(r);if(!e&&i>o){var a=i;i=o,o=a}return i+et.EDGE_KEY_DELIM+o+et.EDGE_KEY_DELIM+(void 0===n?et.DEFAULT_EDGE_NAME:n)}function ut(e,t,r,n){var i=String(t),o=String(r),a={v:t,w:r};if(!e&&i>o){var s=a.v;a.v=a.w,a.w=s}return void 0!==n&&(a.name=n),a}function ft(e,t){return ot(e,t.v,t.w,t.name)}function st(e){return"function"==typeof e}!function(e){e.DEFAULT_EDGE_NAME="\0",e.GRAPH_NODE="\0",e.EDGE_KEY_DELIM=""}(et||(et={}));var ct=function(e){return e.nodes().map((function(t){var r={id:t,value:e.node(t),parent:e.parent(t)};return void 0===r.value&&delete r.value,void 0===r.parent&&delete r.parent,r}))},lt=function(e){return e.edges().map((function(t){var r=e.edge(t),n={v:t.v,w:t.w,value:r,name:t.name};return void 0===n.name&&delete n.name,void 0===n.value&&delete n.value,n}))},vt=function(e){var t={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:ct(e),edges:lt(e),value:e.graph()};return void 0===t.value&&delete t.value,t},dt=function(e){var t=new Et(e.options);return void 0!==e.value&&t.setGraph(e.value),e.nodes.forEach((function(e){t.setNode(e.id,e.value),e.parent&&t.setParent(e.id,e.parent)})),e.edges.forEach((function(e){t.setEdge(e.v,e.w,e.value,e.name)})),t};function ht(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function bt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ht(Object(r),!0).forEach((function(t){pt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ht(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function pt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wt(e,t,r){return t&&yt(e.prototype,t),r&&yt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var gt={compound:!1,multigraph:!1,directed:!0},Et=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};mt(this,e),this.directed=!0,this.multigraph=!1,this.compound=!1,this.GRAPH_NODE=et.GRAPH_NODE,this.label=void 0,this.nodeCountNum=0,this.edgeCountNum=0,this.defaultNodeLabelFn=function(){},this.defaultEdgeLabelFn=function(){},this.parentMap=void 0,this.childrenMap=void 0,this.nodesLabelMap=new Map,this.inEdgesMap=new Map,this.outEdgesMap=new Map,this.predecessorsMap=new Map,this.successorsMap=new Map,this.edgesMap=new Map,this.edgesLabelsMap=new Map,this.isDirected=function(){return t.directed},this.isMultigraph=function(){return t.multigraph},this.isCompound=function(){return t.compound},this.setGraph=function(e){return t.label=e,t},this.graph=function(){return t.label},this.setDefaultNodeLabel=function(e){return st(e)?t.defaultNodeLabelFn=e:t.defaultNodeLabelFn=function(){return e},t},this.nodeCount=function(){return t.nodeCountNum},this.node=function(e){return t.nodesLabelMap.get(e)},this.nodes=function(){return Array.from(t.nodesLabelMap.keys())},this.sources=function(){return t.nodes().filter((function(e){var r;return!(null===(r=t.inEdgesMap.get(e))||void 0===r?void 0:r.size)}))},this.sinks=function(){return t.nodes().filter((function(e){var r;return!(null===(r=t.outEdgesMap.get(e))||void 0===r?void 0:r.size)}))},this.setNodes=function(e,r){return e.map((function(e){return t.setNode(e,r)})),t},this.hasNode=function(e){return t.nodesLabelMap.has(e)},this.checkCompound=function(){if(!t.isCompound())throw new Error("Cannot construct parent-children relations in a non-compound graph")},this.parent=function(e){if(t.isCompound()){var r,n=null===(r=t.parentMap)||void 0===r?void 0:r.get(e);if(n!==t.GRAPH_NODE)return n}},this.removeFromParentsChildList=function(e){var r=t.parentMap.get(e);t.childrenMap.get(r).delete(e)},this.setParent=function(e,r){var n,i;t.checkCompound();for(var o=void 0===r?t.GRAPH_NODE:r,a=t.parent(o);a;){if(e===a)throw new Error("Setting "+r+" as parent of "+e+" would create a cycle");a=t.parent(a)}r&&t.setNode(r),t.setNode(e),t.removeFromParentsChildList(e),null===(n=t.parentMap)||void 0===n||n.set(e,o);var s=t.childrenMap.get(o);return s.set(e,!0),null===(i=t.childrenMap)||void 0===i||i.set(o,s),t},this.children=function(e){var r=void 0===e?t.GRAPH_NODE:e;if(t.isCompound()){var n,i=null===(n=t.childrenMap)||void 0===n?void 0:n.get(r);return i?Array.from(i.keys()):void 0}return r===t.GRAPH_NODE?t.nodes():e&&t.hasNode(e)?[]:void 0},this.predecessors=function(e){var r=t.predecessorsMap.get(e);return r?Array.from(r.keys()):void 0},this.successors=function(e){var r=t.successorsMap.get(e);return r?Array.from(r.keys()):void 0},this.neighbors=function(e){var r;if(t.hasNode(e))return Array.from(new Set(null===(r=t.predecessors(e))||void 0===r?void 0:r.concat(t.successors(e))))},this.isLeaf=function(e){var r,n;return t.isDirected()?!(null===(n=t.successors(e))||void 0===n?void 0:n.length):!(null===(r=t.neighbors(e))||void 0===r?void 0:r.length)},this.filterNodes=function(r){var n=t.directed,i=t.multigraph,o=t.compound,a=new e({directed:n,multigraph:i,compound:o});return a.setGraph(t.graph()),t.nodes().forEach((function(e){r(e)&&a.setNode(e,t.node(e))})),t.edges().forEach((function(e){a.hasNode(e.v)&&a.hasNode(e.w)&&a.setEdgeObj(e,t.edge(e))})),o&&a.nodes().forEach((function(e){a.setParent(e,function(e){for(var r=t.parent(e);void 0!==r&&!a.hasNode(r);)r=t.parent(r);return r}(e))})),a},this.setDefaultEdgeLabel=function(e){return st(e)?t.defaultEdgeLabelFn=e:t.defaultEdgeLabelFn=function(){return e},t},this.edgeCount=function(){return t.edgeCountNum},this.setEdgeObj=function(e,r){return t.setEdge(e.v,e.w,r,e.name)},this.setPath=function(e,r){return e.reduce((function(e,n){return t.setEdge(e,n,r),n})),t},this.edgeFromArgs=function(e,r,n){return t.edge({v:e,w:r,name:n})},this.edge=function(e){return t.edgesLabelsMap.get(ft(t.isDirected(),e))},this.hasEdge=function(e,r,n){return t.edgesLabelsMap.has(ft(t.isDirected(),{v:e,w:r,name:n}))},this.removeEdgeObj=function(e){var r=e.v,n=e.w,i=e.name;return t.removeEdge(r,n,i)},this.edges=function(){return Array.from(t.edgesMap.values())},this.inEdges=function(e,r){var n=t.inEdgesMap.get(e);if(n)return Array.from(n.values()).filter((function(e){return!r||e.v===r}))},this.outEdges=function(e,r){var n=t.outEdgesMap.get(e);if(n)return Array.from(n.values()).filter((function(e){return!r||e.w===r}))},this.nodeEdges=function(e,r){var n;if(t.hasNode(e))return null===(n=t.inEdges(e,r))||void 0===n?void 0:n.concat(t.outEdges(e,r))},this.toJSON=function(){return vt(t)},this.nodeInDegree=function(e){var r=t.inEdgesMap.get(e);return r?r.size:0},this.nodeOutDegree=function(e){var r=t.outEdgesMap.get(e);return r?r.size:0},this.nodeDegree=function(e){return t.nodeInDegree(e)+t.nodeOutDegree(e)},this.source=function(e){return e.v},this.target=function(e){return e.w};var n=bt(bt({},gt),r);this.compound=n.compound,this.directed=n.directed,this.multigraph=n.multigraph,this.compound&&(this.parentMap=new Map,this.childrenMap=new Map)}return wt(e,[{key:"setNode",value:function(e,t){var r,n=this.nodesLabelMap,i=this.defaultNodeLabelFn,o=this.isCompound,a=this.parentMap,s=this.childrenMap,c=this.inEdgesMap,u=this.outEdgesMap,f=this.predecessorsMap,l=this.successorsMap;return n.has(e)?(void 0!==t&&n.set(e,t),this):(n.set(e,t||i(e)),o()&&(null==a||a.set(e,this.GRAPH_NODE),null==s||s.set(e,new Map),(null==s?void 0:s.has(this.GRAPH_NODE))||null==s||s.set(this.GRAPH_NODE,new Map),null==s||null===(r=s.get(this.GRAPH_NODE))||void 0===r||r.set(e,!0)),[c,u,f,l].forEach((function(t){return t.set(e,new Map)})),this.nodeCountNum+=1,this)}},{key:"removeNode",value:function(e){var t=this;if(this.hasNode(e)){var r,n,i,o=function(e){t.removeEdge(e.v,e.w,e.name)},a=this.inEdgesMap,s=this.outEdgesMap,c=this.predecessorsMap,u=this.successorsMap,f=this.nodesLabelMap;this.isCompound()&&(this.removeFromParentsChildList(e),null===(r=this.parentMap)||void 0===r||r.delete(e),null===(n=this.children(e))||void 0===n||n.forEach((function(e){return t.setParent(e)})),null===(i=this.childrenMap)||void 0===i||i.delete(e));var l=a.get(e),d=s.get(e);Array.from(l.values()).forEach((function(e){return o(e)})),Array.from(d.values()).forEach((function(e){return o(e)})),f.delete(e),a.delete(e),s.delete(e),c.delete(e),u.delete(e),this.nodeCountNum-=1}return this}},{key:"setEdge",value:function(e,t,r,n){var i,o,a=ut(this.isDirected(),e,t,n),s=ft(this.isDirected(),a),c=a.v,u=a.w;if(this.edgesLabelsMap.has(s))return this.edgesLabelsMap.set(s,r),this;if(void 0!==n&&!this.isMultigraph())throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(c),this.setNode(u),this.edgesLabelsMap.set(s,r||this.defaultEdgeLabelFn(c,u,n)),Object.freeze(a),this.edgesMap.set(s,a);var f=this.predecessorsMap.get(u),l=this.successorsMap.get(c);return it(f,c),it(l,u),null===(i=this.inEdgesMap.get(u))||void 0===i||i.set(s,a),null===(o=this.outEdgesMap.get(c))||void 0===o||o.set(s,a),this.edgeCountNum+=1,this}},{key:"removeEdge",value:function(e,t,r){var n=ot(this.isDirected(),e,t,r);if(this.edgesMap.get(n)){var i=ut(this.isDirected(),e,t,r),o=i.v,a=i.w;this.edgesLabelsMap.delete(n),this.edgesMap.delete(n);var s=this.predecessorsMap.get(a),c=this.successorsMap.get(o);at(s,o),at(c,a),this.inEdgesMap.get(a).delete(n),this.outEdgesMap.get(o).delete(n),this.edgeCountNum-=1}return this}}]),e}();function At(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _t(e,t,r){return t&&At(e.prototype,t),r&&At(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Et.fromJSON=dt;var Rt=_t((function e(){var t=this;Tt(this,e),this.arr=[],this.keyIndice=new Map,this.size=function(){return t.arr.length},this.keys=function(){return t.arr.map((function(e){return e.key}))},this.has=function(e){return t.keyIndice.has(e)},this.priority=function(e){var r=t.keyIndice.get(e);if(void 0!==r)return t.arr[r].priority},this.swap=function(e,r){var n=t.arr,i=t.keyIndice,o=[n[e],n[r]],a=o[0],s=o[1];n[e]=s,n[r]=a,i.set(a.key,r),i.set(s.key,e)},this.innerDecrease=function(e){for(var r,n=t.arr,i=n[e].priority,o=e;0!==o;){var a;if((null===(a=n[r=o>>1])||void 0===a?void 0:a.priority)<i)break;t.swap(o,r),o=r}},this.heapify=function(e){var r=t.arr,n=e<<1,i=n+1,o=e;n<r.length&&(o=r[n].priority<r[o].priority?n:o,i<r.length&&(o=r[i].priority<r[o].priority?i:o),o!==e&&(t.swap(e,o),t.heapify(o)))},this.min=function(){if(0===t.size())throw new Error("Queue underflow");return t.arr[0].key},this.add=function(e,r){var n=t.keyIndice,i=t.arr;if(!n.has(e)){var o=i.length;return n.set(e,o),i.push({key:e,priority:r}),t.innerDecrease(o),!0}return!1},this.removeMin=function(){t.swap(0,t.arr.length-1);var e=t.arr.pop();return t.keyIndice.delete(e.key),t.heapify(0),e.key},this.decrease=function(e,r){if(!t.has(e))throw new Error("There's no key named ".concat(e));var n=t.keyIndice.get(e);if(r>t.arr[n].priority)throw new Error("New priority is greater than current priority.Key: ".concat(e," Old: + ").concat(t.arr[n].priority," New: ").concat(r));t.arr[n].priority=r,t.innerDecrease(n)}})),Ot=function(e,t){var r,n=new Et,i=new Map,o=new Rt;function a(e){var n=e.v===r?e.w:e.v,a=o.priority(n);if(void 0!==a){var s=t(e);s<a&&(i.set(n,r),o.decrease(n,s))}}if(0===e.nodeCount())return n;e.nodes().forEach((function(e){o.add(e,Number.POSITIVE_INFINITY),n.setNode(e)})),o.decrease(e.nodes()[0],0);for(var s=!1;o.size()>0;){var c;if(r=o.removeMin(),i.has(r))n.setEdge(r,i.get(r));else{if(s)throw new Error("Input graph is not connected: "+e.graph());s=!0}null===(c=e.nodeEdges(r))||void 0===c||c.forEach(a)}return n},xt=function(e){var t=new Set,r=[];return e.nodes().forEach((function(n){for(var i=[],o=[n];o.length>0;){var a,s,c=o.pop();t.has(c)||(t.add(c),i.push(c),null===(a=e.successors(c))||void 0===a||a.forEach((function(e){return o.push(e)})),null===(s=e.predecessors(c))||void 0===s||s.forEach((function(e){return o.push(e)})))}i.length&&r.push(i)})),r},jt=function e(t,r,n,i,o,a){i.includes(r)||(i.push(r),n||a.push(r),o(r).forEach((function(r){return e(t,r,n,i,o,a)})),n&&a.push(r))},St=function(e,t,r){var n=Array.isArray(t)?t:[t],i=function(t){return e.isDirected()?e.successors(t):e.neighbors(t)},o=[],a=[];return n.forEach((function(t){if(!e.hasNode(t))throw new Error("Graph does not have node: "+t);jt(e,t,"post"===r,a,i,o)})),o};function Nt(e,t){return kt(e)||Lt(e,t)||Mt(e,t)||It()}function It(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Mt(e,t){if(e){if("string"==typeof e)return Ct(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ct(e,t):void 0}}function Ct(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Lt(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}}function kt(e){if(Array.isArray(e))return e}var Ut=function(){return 1},Ft=function(e,t,r,n){return Bt(e,t,r||Ut,n||function(t){return e.outEdges(t)})},Bt=function(e,t,r,n){var i,o,a=new Map,s=new Rt,c=function(e){var t=e.v!==i?e.v:e.w,n=a.get(t),c=r(e),u=o.distance+c;if(c<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+e+" Weight: "+c);u<n.distance&&(n.distance=u,n.predecessor=i,s.decrease(t,u))};for(e.nodes().forEach((function(e){var r=e===t?0:Number.POSITIVE_INFINITY;a.set(e,{distance:r}),s.add(e,r)}));s.size()>0&&(i=s.removeMin(),!(o=a.get(i))||o.distance!==Number.POSITIVE_INFINITY);)n(i).forEach(c);var u={};return Array.from(a.entries()).forEach((function(e){var t=Nt(e,2),r=t[0],n=t[1];return u[String(r)]=n,u})),u},Dt=function(e,t,r){var n={};return e.nodes().forEach((function(i){return n[String(i)]=Ft(e,i,t,r),n})),n},Pt=function(e){var t=0,r=[],n=new Map,i=[];function o(a){var s,c={onStack:!0,lowlink:t,index:t};if(n.set(a,c),t+=1,r.push(a),null===(s=e.successors(a))||void 0===s||s.forEach((function(e){var t;if(n.has(e)){if(null===(t=n.get(e))||void 0===t?void 0:t.onStack){var r=n.get(e);c.lowlink=Math.min(c.lowlink,r.index)}}else{o(e);var i=n.get(e);c.lowlink=Math.min(c.lowlink,i.lowlink)}})),c.lowlink===c.index){var u,f=[];do{u=r.pop(),n.get(u).onStack=!1,f.push(u)}while(a!==u);i.push(f)}}return e.nodes().forEach((function(e){n.has(e)||o(e)})),i},Gt=function(e){return Pt(e).filter((function(t){return t.length>1||1===t.length&&e.hasEdge(t[0],t[0])}))};function Vt(e){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vt(e)}function Xt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function zt(e,t,r){return t&&Xt(e.prototype,t),r&&Xt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ht(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Wt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tn(e,t)}function $t(e){var t=Zt();return function(){var r,n=nn(e);if(t){var i=nn(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Yt(this,r)}}function Yt(e,t){if(t&&("object"===Vt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return qt(e)}function qt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kt(e){var t="function"==typeof Map?new Map:void 0;return Kt=function(e){if(null===e||!Jt(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return Qt(e,arguments,nn(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),tn(r,e)},Kt(e)}function Qt(e,t,r){return Qt=Zt()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&tn(i,r.prototype),i},Qt.apply(null,arguments)}function Zt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Jt(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function tn(e,t){return tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},tn(e,t)}function nn(e){return nn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},nn(e)}var rn=function(e){Wt(r,Kt(Error));var t=$t(r);function r(){return Ht(this,r),t.apply(this,arguments)}return zt(r)}();function en(e){var t=new Set,r=new Set,n=[];if(e.sinks().forEach((function i(o){if(r.has(o))throw new rn;var a;t.has(o)||(r.add(o),t.add(o),null===(a=e.predecessors(o))||void 0===a||a.forEach(i),r.delete(o),n.push(o))})),t.size!==e.nodeCount())throw new rn;return n}var an=function e(t){try{en(t)}catch(e){if(e instanceof rn)return!1;throw e}return!0},on=function(e,t){return St(e,t,"post")},un=function(e,t){return St(e,t,"pre")},fn=function(){return 1};function sn(e,t,r){return cn(e,t||fn,r||function(t){return e.outEdges(t)})}function cn(e,t,r){var n={},i=e.nodes();return i.forEach((function(e){var o=String(e);n[o]={},n[o][o]={distance:0},i.forEach((function(t){e!==t&&(n[o][String(t)]={distance:Number.POSITIVE_INFINITY})})),r(e).forEach((function(r){var i=r.v===e?r.w:r.v,a=t(r);n[o][String(i)]={distance:a,predecessor:e}}))})),i.forEach((function(e){var t=String(e),r=n[t];i.forEach((function(e){var o=String(e),a=n[o];i.forEach((function(e){var n=String(e),i=a[t],o=r[n],s=a[n],c=i.distance+o.distance;c<s.distance&&(s.distance=c,s.predecessor=o.predecessor)}))}))})),n}const ln=Object.freeze({__proto__:null,components:xt,dfs:St,dijkstra:Ft,dijkstraAll:Dt,findCycles:Gt,tarjan:Pt,isAcyclic:an,postorder:on,preorder:un,prim:Ot,topsort:en,floydWarshall:sn});class vn extends rt{}class dn extends Et{}const hn=()=>1,bn=(e,t)=>{var r;if(e.nodeCount()<=1)return[];const n=yn(e,t||hn);return null===(r=pn(n.graph,n.buckets,n.zeroIdx).map((t=>e.outEdges(t.v,t.w))))||void 0===r?void 0:r.flat()},pn=(e,t,r)=>{let n=[];const i=t[t.length-1],o=t[0];let a;for(;e.nodeCount();){for(;a=o.dequeue();)mn(e,t,r,a);for(;a=i.dequeue();)mn(e,t,r,a);if(e.nodeCount())for(let i=t.length-2;i>0;--i)if(a=t[i].dequeue(),a){n=n.concat(mn(e,t,r,a,!0));break}}return n},mn=(e,t,r,n,i)=>{var o,a;const s=[];return null===(o=e.inEdges(n.v))||void 0===o||o.forEach((n=>{const o=e.edge(n),a=e.node(n.v);i&&s.push({v:n.v,w:n.w,in:0,out:0}),void 0===a.out&&(a.out=0),a.out-=o,wn(t,r,a)})),null===(a=e.outEdges(n.v))||void 0===a||a.forEach((n=>{const i=e.edge(n),o=n.w,a=e.node(o);void 0===a.in&&(a.in=0),a.in-=i,wn(t,r,a)})),e.removeNode(n.v),i?s:void 0},yn=(e,t)=>{const r=new dn;let n=0,i=0;e.nodes().forEach((e=>{r.setNode(e,{v:e,in:0,out:0})})),e.edges().forEach((e=>{const o=r.edge(e)||0,a=(null==t?void 0:t(e))||1,s=o+a;r.setEdge(e.v,e.w,s),i=Math.max(i,r.node(e.v).out+=a),n=Math.max(n,r.node(e.w).in+=a)}));const o=[],a=i+n+3;for(let e=0;e<a;e++)o.push(new vn);const s=n+1;return r.nodes().forEach((e=>{wn(o,s,r.node(e))})),{buckets:o,zeroIdx:s,graph:r}},wn=(e,t,r)=>{r.out?r.in?e[r.out-r.in+t].enqueue(r):e[e.length-1].enqueue(r):e[0].enqueue(r)},gn=e=>{const t="greedy"===e.graph().acyclicer?bn(e,(e=>t=>{var r;return(null===(r=e.edge(t))||void 0===r?void 0:r.weight)||1})(e)):En(e);null==t||t.forEach((t=>{const r=e.edge(t);e.removeEdgeObj(t),r.forwardName=t.name,r.reversed=!0,e.setEdge(t.w,t.v,r,`rev-${Math.random()}`)}))},En=e=>{const t=[],r={},n={},i=o=>{var a;n[o]||(n[o]=!0,r[o]=!0,null===(a=e.outEdges(o))||void 0===a||a.forEach((e=>{r[e.w]?t.push(e):i(e.w)})),delete r[o])};return e.nodes().forEach(i),t},An=e=>{e.edges().forEach((t=>{const r=e.edge(t);if(r.reversed){e.removeEdgeObj(t);const n=r.forwardName;delete r.reversed,delete r.forwardName,e.setEdge(t.w,t.v,r,n)}}))},_n={run:gn,undo:An};class Tn extends Et{}const Rn=(e,t)=>Number(e)-Number(t),On=(e,t,r,n)=>{let i;do{i=`${n}${Math.random()}`}while(e.hasNode(i));return r.dummy=t,e.setNode(i,r),i},xn=e=>{const t=(new Tn).setGraph(e.graph());return e.nodes().forEach((r=>{t.setNode(r,e.node(r))})),e.edges().forEach((r=>{const n=t.edgeFromArgs(r.v,r.w)||{weight:0,minlen:1},i=e.edge(r);t.setEdge(r.v,r.w,{weight:n.weight+i.weight,minlen:Math.max(n.minlen,i.minlen)})})),t},jn=e=>{const t=new Tn({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach((r=>{var n;(null===(n=e.children(r))||void 0===n?void 0:n.length)||t.setNode(r,e.node(r))})),e.edges().forEach((r=>{t.setEdgeObj(r,e.edge(r))})),t},Sn=(e,t)=>null==e?void 0:e.reduce(((e,r,n)=>(e[r]=t[n],e)),{}),Nn=(e,t)=>{const r=Number(e.x),n=Number(e.y),i=Number(t.x)-r,o=Number(t.y)-n;let a,s,c=Number(e.width)/2,u=Number(e.height)/2;return i||o?(Math.abs(o)*c>Math.abs(i)*u?(o<0&&(u=-u),a=u*i/o,s=u):(i<0&&(c=-c),a=c,s=c*o/i),{x:r+a,y:n+s}):{x:0,y:0}},In=e=>{const t=[],r=kn(e)+1;for(let e=0;e<r;e++)t.push([]);e.nodes().forEach((r=>{const n=e.node(r);if(!n)return;const i=n.rank;void 0!==i&&t[i]&&t[i].push(r)}));for(let n=0;n<r;n++)t[n]=t[n].sort(((t,r)=>{var n,i;return Rn(null===(n=e.node(t))||void 0===n?void 0:n.order,null===(i=e.node(r))||void 0===i?void 0:i.order)}));return t},Mn=e=>{const t=e.nodes().filter((t=>{var r;return void 0!==(null===(r=e.node(t))||void 0===r?void 0:r.rank)})).map((t=>e.node(t).rank)),r=Math.min(...t);e.nodes().forEach((t=>{const n=e.node(t);n.hasOwnProperty("rank")&&r!==1/0&&(n.rank-=r)}))},Cn=e=>{const t=e.nodes(),r=t.filter((t=>{var r;return void 0!==(null===(r=e.node(t))||void 0===r?void 0:r.rank)})).map((t=>e.node(t).rank)),n=Math.min(...r),i=[];t.forEach((t=>{var r;const o=((null===(r=e.node(t))||void 0===r?void 0:r.rank)||0)-n;i[o]||(i[o]=[]),i[o].push(t)}));let o=0;const a=e.graph().nodeRankFactor||0;for(let t=0;t<i.length;t++){const r=i[t];void 0===r?t%a!=0&&(o-=1):o&&(null==r||r.forEach((t=>{const r=e.node(t);r&&(r.rank=r.rank||0,r.rank+=o)})))}},Ln=(e,t,r,n)=>{const i={width:0,height:0};return q(r)&&q(n)&&(i.rank=r,i.order=n),On(e,"border",i,t)},kn=e=>{let t;return e.nodes().forEach((r=>{var n;const i=null===(n=e.node(r))||void 0===n?void 0:n.rank;void 0!==i&&(void 0===t||i>t)&&(t=i)})),t||(t=0),t},Un=(e,t)=>{const r={lhs:[],rhs:[]};return null==e||e.forEach((e=>{t(e)?r.lhs.push(e):r.rhs.push(e)})),r},Fn=(e,t)=>{const r=Date.now();try{return t()}finally{console.log(`${e} time: ${Date.now()-r}ms`)}},Bn=(e,t)=>t(),Dn=(e,t)=>e.reduce(((e,r)=>t(e)>t(r)?r:e)),Pn=e=>{e.graph().dummyChains=[],e.edges().forEach((t=>Gn(e,t)))},Gn=(e,t)=>{let r=t.v,n=e.node(r).rank;const i=t.w,o=e.node(i).rank,a=t.name,s=e.edge(t),c=s.labelRank;if(o===n+1)return;e.removeEdgeObj(t);const u=e.graph();let f,l,d;for(d=0,++n;n<o;++d,++n)s.points=[],l={edgeLabel:s,width:0,height:0,edgeObj:t,rank:n},f=On(e,"edge",l,"_d"),n===c&&(l.width=s.width,l.height=s.height,l.dummy="edge-label",l.labelpos=s.labelpos),e.setEdge(r,f,{weight:s.weight},a),0===d&&(u.dummyChains||(u.dummyChains=[]),u.dummyChains.push(f)),r=f;e.setEdge(r,i,{weight:s.weight},a)},Vn=e=>{var t;null===(t=e.graph().dummyChains)||void 0===t||t.forEach((t=>{let r=e.node(t);const n=r.edgeLabel;let i;r.edgeObj&&e.setEdgeObj(r.edgeObj,n);let o=t;for(;r.dummy;)i=e.successors(o)[0],e.removeNode(o),n.points.push({x:r.x,y:r.y}),"edge-label"===r.dummy&&(n.x=r.x,n.y=r.y,n.width=r.width,n.height=r.height),o=i,r=e.node(o)}))},Xn={run:Pn,undo:Vn},zn=e=>{var t;const r={},n=t=>{var i;const o=e.node(t);if(!o)return 0;if(r[t])return o.rank;let a;return r[t]=!0,null===(i=e.outEdges(t))||void 0===i||i.forEach((t=>{const r=n(t.w)-e.edge(t).minlen;r&&(void 0===a||r<a)&&(a=r)})),a||(a=0),o.rank=a,a};null===(t=e.sources())||void 0===t||t.forEach((e=>n(e)))},Hn=e=>{var t;const r={};let n;const i=t=>{var o;const a=e.node(t);if(!a)return 0;if(r[t])return a.rank;let s;return r[t]=!0,null===(o=e.outEdges(t))||void 0===o||o.forEach((t=>{const r=i(t.w)-e.edge(t).minlen;r&&(void 0===s||r<s)&&(s=r)})),s||(s=0),(void 0===n||s<n)&&(n=s),a.rank=s,s};null===(t=e.sources())||void 0===t||t.forEach((t=>{e.node(t)&&i(t)})),void 0===n&&(n=0);const o={},a=(t,r)=>{var n;const i=e.node(t),s=isNaN(i.layer)?r:i.layer;(void 0===i.rank||i.rank<s)&&(i.rank=s),o[t]||(o[t]=!0,null===(n=e.outEdges(t))||void 0===n||n.map((t=>{a(t.w,s+e.edge(t).minlen)})))};e.nodes().forEach((t=>{const r=e.node(t);r&&(isNaN(r.layer)?r.rank-=n:a(t,r.layer))}))},Wn=(e,t)=>e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen,$n=e=>{const t=new Tn({directed:!1}),r=e.nodes()[0],n=e.nodeCount();let i,o;for(t.setNode(r,{});Yn(t,e)<n;)i=Qn(t,e),o=t.hasNode(i.v)?Wn(e,i):-Wn(e,i),Zn(t,e,o);return t},Yn=(e,t)=>{const r=n=>{t.nodeEdges(n).forEach((i=>{const o=i.v,a=n===o?i.w:o;e.hasNode(a)||Wn(t,i)||(e.setNode(a,{}),e.setEdge(n,a,{}),r(a))}))};return e.nodes().forEach(r),e.nodeCount()},qn=e=>{const t=new Tn({directed:!1}),r=e.nodes()[0],n=e.nodes().filter((t=>!!e.node(t))).length;let i,o;for(t.setNode(r,{});Kn(t,e)<n;)i=Qn(t,e),o=t.hasNode(i.v)?Wn(e,i):-Wn(e,i),Zn(t,e,o);return t},Kn=(e,t)=>{const r=n=>{var i;null===(i=t.nodeEdges(n))||void 0===i||i.forEach((i=>{const o=i.v,a=n===o?i.w:o;e.hasNode(a)||void 0===t.node(a).layer&&Wn(t,i)||(e.setNode(a,{}),e.setEdge(n,a,{}),r(a))}))};return e.nodes().forEach(r),e.nodeCount()},Qn=(e,t)=>Dn(t.edges(),(r=>e.hasNode(r.v)!==e.hasNode(r.w)?Wn(t,r):1/0)),Zn=(e,t,r)=>{e.nodes().forEach((e=>{t.node(e).rank||(t.node(e).rank=0),t.node(e).rank+=r}))},{preorder:Jn,postorder:tr}=ln,nr=e=>{const t=xn(e);zn(t);const r=$n(t);let n,i;for(ar(r),rr(r,t);n=ur(r);)i=fr(r,t,n),sr(r,t,n,i)},rr=(e,t)=>{let r=tr(e,e.nodes());r=null==r?void 0:r.slice(0,(null==r?void 0:r.length)-1),null==r||r.forEach((r=>{er(e,t,r)}))},er=(e,t,r)=>{const n=e.node(r).parent;e.edgeFromArgs(r,n).cutvalue=ir(e,t,r)},ir=(e,t,r)=>{var n;const i=e.node(r).parent;let o=!0,a=t.edgeFromArgs(r,i),s=0;return a||(o=!1,a=t.edgeFromArgs(i,r)),s=a.weight,null===(n=t.nodeEdges(r))||void 0===n||n.forEach((n=>{const a=n.v===r,c=a?n.w:n.v;if(c!==i){const i=a===o,u=t.edge(n).weight;if(s+=i?u:-u,lr(e,r,c)){const t=e.edgeFromArgs(r,c).cutvalue;s+=i?-t:t}}})),s},ar=(e,t=e.nodes()[0])=>{or(e,{},1,t)},or=(e,t,r,n,i)=>{var o;const a=r;let s=r;const c=e.node(n);return t[n]=!0,null===(o=e.neighbors(n))||void 0===o||o.forEach((r=>{t[r]||(s=or(e,t,s,r,n))})),c.low=a,c.lim=s++,i?c.parent=i:delete c.parent,s},ur=e=>e.edges().find((t=>e.edge(t).cutvalue<0)),fr=(e,t,r)=>{let n=r.v,i=r.w;t.hasEdge(n,i)||(n=r.w,i=r.v);const o=e.node(n),a=e.node(i);let s=o,c=!1;o.lim>a.lim&&(s=a,c=!0);const u=t.edges().filter((t=>c===vr(e,e.node(t.v),s)&&c!==vr(e,e.node(t.w),s)));return Dn(u,(e=>Wn(t,e)))},sr=(e,t,r,n)=>{const i=r.v,o=r.w;e.removeEdge(i,o),e.setEdge(n.v,n.w,{}),ar(e),rr(e,t),cr(e,t)},cr=(e,t)=>{const r=e.nodes().find((e=>{var r;return!(null===(r=t.node(e))||void 0===r?void 0:r.parent)}));let n=Jn(e,r);n=null==n?void 0:n.slice(1),null==n||n.forEach((r=>{const n=e.node(r).parent;let i=t.edgeFromArgs(r,n),o=!1;i||(i=t.edgeFromArgs(n,r),o=!0),t.node(r).rank=t.node(n).rank+(o?i.minlen:-i.minlen)}))},lr=(e,t,r)=>e.hasEdge(t,r),vr=(e,t,r)=>r.low<=t.lim&&t.lim<=r.lim,dr=e=>{switch(e.graph().ranker){case"network-simplex":pr(e);break;case"tight-tree":default:br(e);break;case"longest-path":hr(e)}},hr=zn,br=e=>{Hn(e),qn(e)},pr=e=>{nr(e)},mr=e=>{var t;const r={};let n=0;const i=t=>{var o;const a=n;null===(o=e.children(t))||void 0===o||o.forEach(i),r[t]={low:a,lim:n++}};return null===(t=e.children())||void 0===t||t.forEach(i),r},yr=(e,t,r,n)=>{const i=[],o=[],a=Math.min(t[r].low,t[n].low),s=Math.max(t[r].lim,t[n].lim);let c,u;c=r;do{c=e.parent(c),i.push(c)}while(c&&(t[c].low>a||s>t[c].lim));for(u=c,c=n;c&&c!==u;)o.push(c),c=e.parent(c);return{lca:u,path:i.concat(o.reverse())}},wr=e=>{var t;const r=mr(e);null===(t=e.graph().dummyChains)||void 0===t||t.forEach((t=>{var n,i;let o=t,a=e.node(o);const s=a.edgeObj;if(!s)return;const c=yr(e,r,s.v,s.w),u=c.path,f=c.lca;let l=0,d=u[l],h=!0;for(;o!==s.w;){if(a=e.node(o),h){for(;d!==f&&(null===(n=e.node(d))||void 0===n?void 0:n.maxRank)<a.rank;)l++,d=u[l];d===f&&(h=!1)}if(!h){for(;l<u.length-1&&(null===(i=e.node(u[l+1]))||void 0===i?void 0:i.minRank)<=a.rank;)l++;d=u[l]}e.setParent(o,d),o=e.successors(o)[0]}}))},gr=e=>{var t;const r=On(e,"root",{},"_root"),n=Ar(e);let i=Math.max(...Object.values(n));Math.abs(i)===1/0&&(i=1);const o=i-1,a=2*o+1;e.graph().nestingRoot=r,e.edges().forEach((t=>{e.edge(t).minlen*=a}));const s=_r(e)+1;null===(t=e.children())||void 0===t||t.forEach((t=>{Er(e,r,a,s,o,n,t)})),e.graph().nodeRankFactor=a},Er=(e,t,r,n,i,o,a)=>{const s=e.children(a);if(!(null==s?void 0:s.length))return void(a!==t&&e.setEdge(t,a,{weight:0,minlen:r}));const c=Ln(e,"_bt"),u=Ln(e,"_bb"),f=e.node(a);e.setParent(c,a),f.borderTop=c,e.setParent(u,a),f.borderBottom=u,null==s||s.forEach((s=>{Er(e,t,r,n,i,o,s);const f=e.node(s),l=f.borderTop?f.borderTop:s,d=f.borderBottom?f.borderBottom:s,h=f.borderTop?n:2*n,p=l!==d?1:i-o[a]+1;e.setEdge(c,l,{minlen:p,weight:h,nestingEdge:!0}),e.setEdge(d,u,{minlen:p,weight:h,nestingEdge:!0})})),e.parent(a)||e.setEdge(t,c,{weight:0,minlen:i+o[a]})},Ar=e=>{var t;const r={},n=(t,i)=>{const o=e.children(t);null==o||o.forEach((e=>n(e,i+1))),r[t]=i};return null===(t=e.children())||void 0===t||t.forEach((e=>n(e,1))),r},_r=e=>{let t=0;return e.edges().forEach((r=>{t+=e.edge(r).weight})),t},Tr=e=>{const t=e.graph();t.nestingRoot&&e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach((t=>{e.edge(t).nestingEdge&&e.removeEdgeObj(t)}))},Rr={run:gr,cleanup:Tr},Or=e=>{var t;const r=t=>{const n=e.children(t),i=e.node(t);if((null==n?void 0:n.length)&&n.forEach((e=>r(e))),i.hasOwnProperty("minRank")){i.borderLeft=[],i.borderRight=[];for(let r=i.minRank,n=i.maxRank+1;r<n;r+=1)xr(e,"borderLeft","_bl",t,i,r),xr(e,"borderRight","_br",t,i,r)}};null===(t=e.children())||void 0===t||t.forEach((e=>r(e)))},xr=(e,t,r,n,i,o)=>{const a={rank:o,borderType:t,width:0,height:0},s=i[t][o-1],c=On(e,"border",a,r);i[t][o]=c,e.setParent(c,n),s&&e.setEdge(s,c,{weight:1})},jr=e=>{var t;const r=null===(t=e.graph().rankdir)||void 0===t?void 0:t.toLowerCase();"lr"!==r&&"rl"!==r||Nr(e)},Sr=e=>{var t;const r=null===(t=e.graph().rankdir)||void 0===t?void 0:t.toLowerCase();"bt"!==r&&"rl"!==r||Mr(e),"lr"!==r&&"rl"!==r||(Lr(e),Nr(e))},Nr=e=>{e.nodes().forEach((t=>{Ir(e.node(t))})),e.edges().forEach((t=>{Ir(e.edge(t))}))},Ir=e=>{const t=e.width;e.width=e.height,e.height=t},Mr=e=>{e.nodes().forEach((t=>{Cr(e.node(t))})),e.edges().forEach((t=>{var r;const n=e.edge(t);null===(r=n.points)||void 0===r||r.forEach((e=>Cr(e))),n.hasOwnProperty("y")&&Cr(n)}))},Cr=e=>{(null==e?void 0:e.y)&&(e.y=-e.y)},Lr=e=>{e.nodes().forEach((t=>{kr(e.node(t))})),e.edges().forEach((t=>{var r;const n=e.edge(t);null===(r=n.points)||void 0===r||r.forEach((e=>kr(e))),n.hasOwnProperty("x")&&kr(n)}))},kr=e=>{const t=e.x;e.x=e.y,e.y=t},Ur={adjust:jr,undo:Sr},Fr=e=>{const t={},r=e.nodes().filter((t=>{var r;return!(null===(r=e.children(t))||void 0===r?void 0:r.length)})),n=r.map((t=>e.node(t).rank)),i=Math.max(...n),o=[];for(let e=0;e<i+1;e++)o.push([]);const a=r=>{var n;if(t.hasOwnProperty(r))return;t[r]=!0;const i=e.node(r);isNaN(i.rank)||o[i.rank].push(r),null===(n=e.successors(r))||void 0===n||n.forEach((e=>a(e)))},s=r.sort(((t,r)=>e.node(t).rank-e.node(r).rank)),c=s.filter((t=>void 0!==e.node(t).fixorder)),u=c.sort(((t,r)=>e.node(t).fixorder-e.node(r).fixorder));return null==u||u.forEach((r=>{isNaN(e.node(r).rank)||o[e.node(r).rank].push(r),t[r]=!0})),null==s||s.forEach(a),o},Br=(e,t,r)=>{const n=Sn(r,r.map(((e,t)=>t))),i=t.map((t=>{var r;const i=null===(r=e.outEdges(t))||void 0===r?void 0:r.map((t=>({pos:n[t.w]||0,weight:e.edge(t).weight})));return null==i?void 0:i.sort(((e,t)=>e.pos-t.pos))})),o=i.flat().filter((e=>void 0!==e));let a=1;for(;a<r.length;)a<<=1;const s=2*a-1;a-=1;const c=Array(s).fill(0,0,s);let u=0;return null==o||o.forEach((e=>{if(e){let t=e.pos+a;c[t]+=e.weight;let r=0;for(;t>0;)t%2&&(r+=c[t+1]),t=t-1>>1,c[t]+=e.weight;u+=e.weight*r}})),u},Dr=(e,t)=>{let r=0;for(let n=1;n<(null==t?void 0:t.length);n+=1)r+=Br(e,t[n-1],t[n]);return r},Pr=(e,t,r)=>{const n=Gr(e),i=new Tn({compound:!0}).setGraph({root:n}).setDefaultNodeLabel((t=>e.node(t)));return e.nodes().forEach((o=>{var a;const s=e.node(o),c=e.parent(o);(s.rank===t||s.minRank<=t&&t<=s.maxRank)&&(i.setNode(o),i.setParent(o,c||n),null===(a=e[r](o))||void 0===a||a.forEach((t=>{const r=t.v===o?t.w:t.v,n=i.edgeFromArgs(r,o),a=void 0!==n?n.weight:0;i.setEdge(r,o,{weight:e.edge(t).weight+a})})),s.hasOwnProperty("minRank")&&i.setNode(o,{borderLeft:s.borderLeft[t],borderRight:s.borderRight[t]}))})),i},Gr=e=>{let t;for(;e.hasNode(t=`_root${Math.random()}`););return t},Vr=(e,t,r)=>{const n={};let i;null==r||r.forEach((r=>{let o,a,s=e.parent(r);for(;s;){if(o=e.parent(s),o?(a=n[o],n[o]=s):(a=i,i=s),a&&a!==s)return void t.setEdge(a,s);s=o}}))},Xr=(e,t)=>t.map((t=>{const r=e.inEdges(t);if(!(null==r?void 0:r.length))return{v:t};{const n={sum:0,weight:0};return null==r||r.forEach((t=>{const r=e.edge(t),i=e.node(t.v);n.sum+=r.weight*i.order,n.weight+=r.weight})),{v:t,barycenter:n.sum/n.weight,weight:n.weight}}})),zr=(e,t)=>{var r,n,i;const o={};null==e||e.forEach(((e,t)=>{o[e.v]={i:t,indegree:0,in:[],out:[],vs:[e.v]};const r=o[e.v];void 0!==e.barycenter&&(r.barycenter=e.barycenter,r.weight=e.weight)})),null===(r=t.edges())||void 0===r||r.forEach((e=>{const t=o[e.v],r=o[e.w];void 0!==t&&void 0!==r&&(r.indegree++,t.out.push(o[e.w]))}));const a=null===(i=(n=Object.values(o)).filter)||void 0===i?void 0:i.call(n,(e=>!e.indegree));return Hr(a)},Hr=e=>{var t,r;const n=[],i=e=>t=>{t.merged||(void 0===t.barycenter||void 0===e.barycenter||t.barycenter>=e.barycenter)&&Wr(e,t)},o=t=>r=>{r.in.push(t),0==--r.indegree&&e.push(r)};for(;null==e?void 0:e.length;){const a=e.pop();n.push(a),null===(t=a.in.reverse())||void 0===t||t.forEach((e=>i(a)(e))),null===(r=a.out)||void 0===r||r.forEach((e=>o(a)(e)))}const a=n.filter((e=>!e.merged)),s=["vs","i","barycenter","weight"];return a.map((e=>{const t={};return null==s||s.forEach((r=>{void 0!==e[r]&&(t[r]=e[r])})),t}))},Wr=(e,t)=>{var r;let n=0,i=0;e.weight&&(n+=e.barycenter*e.weight,i+=e.weight),t.weight&&(n+=t.barycenter*t.weight,i+=t.weight),e.vs=null===(r=t.vs)||void 0===r?void 0:r.concat(e.vs),e.barycenter=n/i,e.weight=i,e.i=Math.min(t.i,e.i),t.merged=!0},$r=(e,t,r,n)=>{const i=Un(e,(e=>{const t=e.hasOwnProperty("fixorder")&&!isNaN(e.fixorder);return n?!t&&e.hasOwnProperty("barycenter"):t||e.hasOwnProperty("barycenter")})),o=i.lhs,a=i.rhs.sort(((e,t)=>-e.i- -t.i)),s=[];let c=0,u=0,f=0;null==o||o.sort(qr(!!t,!!r)),f=Yr(s,a,f),null==o||o.forEach((e=>{var t;f+=null===(t=e.vs)||void 0===t?void 0:t.length,s.push(e.vs),c+=e.barycenter*e.weight,u+=e.weight,f=Yr(s,a,f)}));const l={vs:s.flat()};return u&&(l.barycenter=c/u,l.weight=u),l},Yr=(e,t,r)=>{let n,i=r;for(;t.length&&(n=t[t.length-1]).i<=i;)t.pop(),null==e||e.push(n.vs),i++;return i},qr=(e,t)=>(r,n)=>{if(void 0!==r.fixorder&&void 0!==n.fixorder)return r.fixorder-n.fixorder;if(r.barycenter<n.barycenter)return-1;if(r.barycenter>n.barycenter)return 1;if(t&&void 0!==r.order&&void 0!==n.order){if(r.order<n.order)return-1;if(r.order>n.order)return 1}return e?n.i-r.i:r.i-n.i},Kr=(e,t,r,n,i,o)=>{var a,s,c,u;let f=e.children(t);const l=e.node(t),d=l?l.borderLeft:void 0,h=l?l.borderRight:void 0,p={};d&&(f=null==f?void 0:f.filter((e=>e!==d&&e!==h)));const m=Xr(e,f||[]);null==m||m.forEach((t=>{var i;if(null===(i=e.children(t.v))||void 0===i?void 0:i.length){const i=Kr(e,t.v,r,n,o);p[t.v]=i,i.hasOwnProperty("barycenter")&&Zr(t,i)}}));const v=zr(m,r);Qr(v,p),null===(a=v.filter((e=>e.vs.length>0)))||void 0===a||a.forEach((t=>{const r=e.node(t.vs[0]);r&&(t.fixorder=r.fixorder,t.order=r.order)}));const g=$r(v,n,i,o);if(d&&(g.vs=[d,g.vs,h].flat(),null===(s=e.predecessors(d))||void 0===s?void 0:s.length)){const t=e.node((null===(c=e.predecessors(d))||void 0===c?void 0:c[0])||""),r=e.node((null===(u=e.predecessors(h))||void 0===u?void 0:u[0])||"");g.hasOwnProperty("barycenter")||(g.barycenter=0,g.weight=0),g.barycenter=(g.barycenter*g.weight+t.order+r.order)/(g.weight+2),g.weight+=2}return g},Qr=(e,t)=>{null==e||e.forEach((e=>{var r;const n=null===(r=e.vs)||void 0===r?void 0:r.map((e=>t[e]?t[e].vs:e));e.vs=n.flat()}))},Zr=(e,t)=>{void 0!==e.barycenter?(e.barycenter=(e.barycenter*e.weight+t.barycenter*t.weight)/(e.weight+t.weight),e.weight+=t.weight):(e.barycenter=t.barycenter,e.weight=t.weight)},Jr=(e,t)=>{const r=kn(e),n=[],i=[];for(let e=1;e<r+1;e++)n.push(e);for(let e=r-1;e>-1;e--)i.push(e);const o=te(e,n,"inEdges"),a=te(e,i,"outEdges");let s=Fr(e);re(e,s);let c,u=Number.POSITIVE_INFINITY;for(let r=0,n=0;n<4;++r,++n){ne(r%2?o:a,r%4>=2,!1,t),s=In(e);const i=Dr(e,s);i<u&&(n=0,c=Q(s),u=i)}s=Fr(e),re(e,s);for(let r=0,n=0;n<4;++r,++n){ne(r%2?o:a,r%4>=2,!0,t),s=In(e);const i=Dr(e,s);i<u&&(n=0,c=Q(s),u=i)}re(e,c)},te=(e,t,r)=>t.map((t=>Pr(e,t,r))),ne=(e,t,r,n)=>{const i=new Tn;null==e||e.forEach((e=>{var o;const a=e.graph().root,s=Kr(e,a,i,t,r,n);for(let t=0;t<(null===(o=s.vs)||void 0===o?void 0:o.length);t++){const r=e.node(s.vs[t]);r&&(r.order=t)}Vr(e,i,s.vs)}))},re=(e,t)=>{null==t||t.forEach((t=>{null==t||t.forEach(((t,r)=>{e.node(t).order=r}))}))};class ee extends Et{}const ie=(e,t)=>{const r={};return(null==t?void 0:t.length)&&t.reduce(((t,n)=>{let i=0,o=0;const a=t.length,s=null==n?void 0:n[(null==n?void 0:n.length)-1];return null==n||n.forEach(((t,c)=>{var u;const f=oe(e,t),l=f?e.node(f).order:a;(f||t===s)&&(null===(u=n.slice(o,c+1))||void 0===u||u.forEach((t=>{var n;null===(n=e.predecessors(t))||void 0===n||n.forEach((n=>{var o;const a=e.node(n),s=a.order;!(s<i||l<s)||a.dummy&&(null===(o=e.node(t))||void 0===o?void 0:o.dummy)||ue(r,n,t)}))})),o=c+1,i=l)})),n})),r},ae=(e,t)=>{const r={};function n(t,n,i,o,a){var s,c;let u;for(let f=n;f<i;f++)u=t[f],(null===(s=e.node(u))||void 0===s?void 0:s.dummy)&&(null===(c=e.predecessors(u))||void 0===c||c.forEach((t=>{const n=e.node(t);n.dummy&&(n.order<o||n.order>a)&&ue(r,t,u)})))}function i(e,t){const r=function(e){return JSON.stringify(e.slice(1))}(e);t.get(r)||(n(...e),t.set(r,!0))}return(null==t?void 0:t.length)&&t.reduce(((t,r)=>{let n,o=-1,a=0;const s=new Map;return null==r||r.forEach(((c,u)=>{var f;if("border"===(null===(f=e.node(c))||void 0===f?void 0:f.dummy)){const t=e.predecessors(c)||[];t.length&&(n=e.node(t[0]).order,i([r,a,u,o,n],s),a=u,o=n)}i([r,a,r.length,n,t.length],s)})),r})),r},oe=(e,t)=>{var r,n;if(null===(r=e.node(t))||void 0===r?void 0:r.dummy)return null===(n=e.predecessors(t))||void 0===n?void 0:n.find((t=>e.node(t).dummy))},ue=(e,t,r)=>{let n=t,i=r;if(n>i){const e=n;n=i,i=e}let o=e[n];o||(e[n]=o={}),o[i]=!0},fe=(e,t,r)=>{let n=t,i=r;return n>r&&(n=r,i=t),!!e[n]},se=(e,t,r,n)=>{const i={},o={},a={};return null==t||t.forEach((e=>{null==e||e.forEach(((e,t)=>{i[e]=e,o[e]=e,a[e]=t}))})),null==t||t.forEach((e=>{let t=-1;null==e||e.forEach((e=>{let s=n(e);if(s.length){s=s.sort(((e,t)=>a[e]-a[t]));const n=(s.length-1)/2;for(let c=Math.floor(n),u=Math.ceil(n);c<=u;++c){const n=s[c];o[e]===e&&t<a[n]&&!fe(r,e,n)&&(o[n]=e,o[e]=i[e]=i[n],t=a[n])}}}))})),{root:i,align:o}},ce=(e,t,r,n,i)=>{var o;const a={},s=le(e,t,r,i),c=i?"borderLeft":"borderRight",u=(e,t)=>{let r=s.nodes(),n=r.pop();const i={};for(;n;)i[n]?e(n):(i[n]=!0,r.push(n),r=r.concat(t(n))),n=r.pop()};return u((e=>{a[e]=(s.inEdges(e)||[]).reduce(((e,t)=>Math.max(e,(a[t.v]||0)+s.edge(t))),0)}),s.predecessors.bind(s)),u((t=>{const r=(s.outEdges(t)||[]).reduce(((e,t)=>Math.min(e,(a[t.w]||0)-s.edge(t))),Number.POSITIVE_INFINITY),n=e.node(t);r!==Number.POSITIVE_INFINITY&&n.borderType!==c&&(a[t]=Math.max(a[t],r))}),s.successors.bind(s)),null===(o=Object.values(n))||void 0===o||o.forEach((e=>{a[e]=a[r[e]]})),a},le=(e,t,r,n)=>{const i=new ee,o=e.graph(),a=be(o.nodesep,o.edgesep,n);return null==t||t.forEach((t=>{let n;null==t||t.forEach((t=>{const o=r[t];if(i.setNode(o),n){const s=r[n],c=i.edgeFromArgs(s,o);i.setEdge(s,o,Math.max(a(e,t,n),c||0))}n=t}))})),i},ve=(e,t)=>Dn(Object.values(t),(t=>{var r;let n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;return null===(r=Object.keys(t))||void 0===r||r.forEach((r=>{const o=t[r],a=pe(e,r)/2;n=Math.max(o+a,n),i=Math.min(o-a,i)})),n-i}));function de(e,t){const r=Object.values(t),n=Math.min(...r),i=Math.max(...r);["u","d"].forEach((r=>{["l","r"].forEach((o=>{const a=r+o,s=e[a];let c;if(s===t)return;const u=Object.values(s);c="l"===o?n-Math.min(...u):i-Math.max(...u),c&&(e[a]={},Object.keys(s).forEach((t=>{e[a][t]=s[t]+c})))}))}))}const he=(e,t)=>{const r={};return Object.keys(e.ul).forEach((n=>{if(t)r[n]=e[t.toLowerCase()][n];else{const t=Object.values(e).map((e=>e[n]));r[n]=(t[0]+t[1])/2}})),r},be=(e,t,r)=>(n,i,o)=>{const a=n.node(i),s=n.node(o);let c,u=0;if(u+=a.width/2,a.hasOwnProperty("labelpos"))switch((a.labelpos||"").toLowerCase()){case"l":c=-a.width/2;break;case"r":c=a.width/2}if(c&&(u+=r?c:-c),c=0,u+=(a.dummy?t:e)/2,u+=(s.dummy?t:e)/2,u+=s.width/2,s.labelpos)switch((s.labelpos||"").toLowerCase()){case"l":c=s.width/2;break;case"r":c=-s.width/2}return c&&(u+=r?c:-c),c=0,u},pe=(e,t)=>e.node(t).width||0,me=e=>{const t=In(e),r=e.graph().ranksep;let n=0;null==t||t.forEach((t=>{const i=t.map((t=>e.node(t).height)),o=Math.max(...i,0);null==t||t.forEach((t=>{e.node(t).y=n+o/2})),n+=o+r}))},ye=e=>{const t=In(e),r=Object.assign(ie(e,t),ae(e,t)),n={};let i=[];["u","d"].forEach((o=>{i="u"===o?t:Object.values(t).reverse(),["l","r"].forEach((t=>{"r"===t&&(i=i.map((e=>Object.values(e).reverse())));const a=("u"===o?e.predecessors:e.successors).bind(e),s=se(0,i,r,a),c=ce(e,i,s.root,s.align,"r"===t);"r"===t&&Object.keys(c).forEach((e=>c[e]=-c[e])),n[o+t]=c}))}));const o=ve(e,n);return o&&de(n,o),he(n,e.graph().align)},we=e=>{var t;const r=jn(e);me(r);const n=ye(r);null===(t=Object.keys(n))||void 0===t||t.forEach((e=>{r.node(e).x=n[e]}))},ge=(e,t)=>{const r=e.nodes().filter((t=>{var r;return!(null===(r=e.children(t))||void 0===r?void 0:r.length)})),n=r.map((t=>e.node(t).rank)),i=Math.max(...n),o=[];for(let e=0;e<i+1;e++)o[e]=[];null==t||t.forEach((t=>{const r=e.node(t);r&&!(null==r?void 0:r.dummy)&&(isNaN(r.rank)||(r.fixorder=o[r.rank].length,o[r.rank].push(t)))}))},Ee=(e,t)=>{const r=t&&t.debugTiming?Fn:Bn;r("layout",(()=>{t&&!t.keepNodeOrder&&t.prevGraph&&r("  inheritOrder",(()=>{_e(e,t.prevGraph)}));const n=r("  buildLayoutGraph",(()=>Ce(e)));t&&!1===t.edgeLabelSpace||r("  makeSpaceForEdgeLabels",(()=>{Le(n)}));try{r("  runLayout",(()=>{Ae(n,r,t)}))}catch(e){if("Not possible to find intersection inside of the rectangle"===e.message)return void console.error("The following error may be caused by improper layer setting, please make sure your manual layer setting does not violate the graph's structure:\n",e);throw e}r("  updateInputGraph",(()=>{Te(e,n)}))}))},Ae=(e,t,r)=>{t("    removeSelfEdges",(()=>{Xe(e)})),t("    acyclic",(()=>{_n.run(e)})),t("    nestingGraph.run",(()=>{Rr.run(e)})),t("    rank",(()=>{dr(jn(e))})),t("    injectEdgeLabelProxies",(()=>{ke(e)})),t("    removeEmptyRanks",(()=>{Cn(e)})),t("    nestingGraph.cleanup",(()=>{Rr.cleanup(e)})),t("    normalizeRanks",(()=>{Mn(e)})),t("    assignRankMinMax",(()=>{Ue(e)})),t("    removeEdgeLabelProxies",(()=>{Fe(e)})),t("    normalize.run",(()=>{Xn.run(e)})),t("    parentDummyChains",(()=>{wr(e)})),t("    addBorderSegments",(()=>{Or(e)})),r&&r.keepNodeOrder&&t("    initDataOrder",(()=>{ge(e,r.nodeOrder)})),t("    order",(()=>{Jr(e,null==r?void 0:r.keepNodeOrder)})),t("    insertSelfEdges",(()=>{ze(e)})),t("    adjustCoordinateSystem",(()=>{Ur.adjust(e)})),t("    position",(()=>{we(e)})),t("    positionSelfEdges",(()=>{He(e)})),t("    removeBorderNodes",(()=>{Ve(e)})),t("    normalize.undo",(()=>{Xn.undo(e)})),t("    fixupEdgeLabelCoords",(()=>{Pe(e)})),t("    undoCoordinateSystem",(()=>{Ur.undo(e)})),t("    translateGraph",(()=>{Be(e)})),t("    assignNodeIntersects",(()=>{De(e)})),t("    reversePoints",(()=>{Ge(e)})),t("    acyclic.undo",(()=>{_n.undo(e)}))},_e=(e,t)=>{e.nodes().forEach((r=>{const n=e.node(r),i=t.node(r);void 0!==i?(n.fixorder=i._order,delete i._order):delete n.fixorder}))},Te=(e,t)=>{e.nodes().forEach((r=>{var n;const i=e.node(r);if(i){const e=t.node(r);i.x=e.x,i.y=e.y,i._order=e.order,i._rank=e.rank,(null===(n=t.children(r))||void 0===n?void 0:n.length)&&(i.width=e.width,i.height=e.height)}})),e.edges().forEach((r=>{const n=e.edge(r),i=t.edge(r);n.points=i?i.points:[],i&&i.hasOwnProperty("x")&&(n.x=i.x,n.y=i.y)})),e.graph().width=t.graph().width,e.graph().height=t.graph().height},Re=["nodesep","edgesep","ranksep","marginx","marginy"],Oe={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},xe=["acyclicer","ranker","rankdir","align"],je=["width","height","layer","fixorder"],Se={width:0,height:0},Ne=["minlen","weight","width","height","labeloffset"],Ie={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},Me=["labelpos"],Ce=e=>{const t=new Tn({multigraph:!0,compound:!0}),r=$e(e.graph()),n={};return null==xe||xe.forEach((e=>{void 0!==r[e]&&(n[e]=r[e])})),t.setGraph(Object.assign({},Oe,We(r,Re),n)),e.nodes().forEach((r=>{const n=$e(e.node(r)),i=Object.assign(Object.assign({},Se),n),o=We(i,je);t.setNode(r,o),t.setParent(r,e.parent(r))})),e.edges().forEach((r=>{const n=$e(e.edge(r)),i={};null==Me||Me.forEach((e=>{void 0!==n[e]&&(i[e]=n[e])})),t.setEdgeObj(r,Object.assign({},Ie,We(n,Ne),i))})),t},Le=e=>{const t=e.graph();t.ranksep||(t.ranksep=0),t.ranksep/=2,e.nodes().forEach((t=>{const r=e.node(t);isNaN(r.layer)||r.layer||(r.layer=0)})),e.edges().forEach((r=>{var n;const i=e.edge(r);i.minlen*=2,"c"!==(null===(n=i.labelpos)||void 0===n?void 0:n.toLowerCase())&&("TB"===t.rankdir||"BT"===t.rankdir?i.width+=i.labeloffset:i.height+=i.labeloffset)}))},ke=e=>{e.edges().forEach((t=>{const r=e.edge(t);if(r.width&&r.height){const r=e.node(t.v),n={e:t,rank:(e.node(t.w).rank-r.rank)/2+r.rank};On(e,"edge-proxy",n,"_ep")}}))},Ue=e=>{let t=0;e.nodes().forEach((r=>{var n,i;const o=e.node(r);o.borderTop&&(o.minRank=null===(n=e.node(o.borderTop))||void 0===n?void 0:n.rank,o.maxRank=null===(i=e.node(o.borderBottom))||void 0===i?void 0:i.rank,t=Math.max(t,o.maxRank||-1/0))})),e.graph().maxRank=t},Fe=e=>{e.nodes().forEach((t=>{const r=e.node(t);"edge-proxy"===r.dummy&&(e.edge(r.e).labelRank=r.rank,e.removeNode(t))}))},Be=e=>{let t,r,n=0,i=0;const o=e.graph(),a=o.marginx||0,s=o.marginy||0,c=e=>{if(!e)return;const o=e.x,a=e.y,s=e.width,c=e.height;isNaN(o)||isNaN(s)||(void 0===t&&(t=o-s/2),t=Math.min(t,o-s/2),n=Math.max(n,o+s/2)),isNaN(a)||isNaN(c)||(void 0===r&&(r=a-c/2),r=Math.min(r,a-c/2),i=Math.max(i,a+c/2))};e.nodes().forEach((t=>{c(e.node(t))})),e.edges().forEach((t=>{const r=e.edge(t);(null==r?void 0:r.hasOwnProperty("x"))&&c(r)})),t-=a,r-=s,e.nodes().forEach((n=>{const i=e.node(n);i&&(i.x-=t,i.y-=r)})),e.edges().forEach((n=>{var i;const o=e.edge(n);null===(i=o.points)||void 0===i||i.forEach((e=>{e.x-=t,e.y-=r})),o.hasOwnProperty("x")&&(o.x-=t),o.hasOwnProperty("y")&&(o.y-=r)})),o.width=n-t+a,o.height=i-r+s},De=e=>{e.edges().forEach((t=>{const r=e.edge(t),n=e.node(t.v),i=e.node(t.w);let o,a;r.points?(o=r.points[0],a=r.points[r.points.length-1]):(r.points=[],o=i,a=n),r.points.unshift(Nn(n,o)),r.points.push(Nn(i,a))}))},Pe=e=>{e.edges().forEach((t=>{const r=e.edge(t);if(null==r?void 0:r.hasOwnProperty("x"))switch("l"!==r.labelpos&&"r"!==r.labelpos||(r.width-=r.labeloffset),r.labelpos){case"l":r.x-=r.width/2+r.labeloffset;break;case"r":r.x+=r.width/2+r.labeloffset}}))},Ge=e=>{e.edges().forEach((t=>{var r;const n=e.edge(t);n.reversed&&(null===(r=n.points)||void 0===r||r.reverse())}))},Ve=e=>{e.nodes().forEach((t=>{var r,n,i;if(null===(r=e.children(t))||void 0===r?void 0:r.length){const r=e.node(t),o=e.node(r.borderTop),a=e.node(r.borderBottom),s=e.node(r.borderLeft[(null===(n=r.borderLeft)||void 0===n?void 0:n.length)-1]),c=e.node(r.borderRight[(null===(i=r.borderRight)||void 0===i?void 0:i.length)-1]);r.width=Math.abs((null==c?void 0:c.x)-(null==s?void 0:s.x))||10,r.height=Math.abs((null==a?void 0:a.y)-(null==o?void 0:o.y))||10,r.x=((null==s?void 0:s.x)||0)+r.width/2,r.y=((null==o?void 0:o.y)||0)+r.height/2}})),e.nodes().forEach((t=>{var r;"border"===(null===(r=e.node(t))||void 0===r?void 0:r.dummy)&&e.removeNode(t)}))},Xe=e=>{e.edges().forEach((t=>{if(t.v===t.w){const r=e.node(t.v);r.selfEdges||(r.selfEdges=[]),r.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdgeObj(t)}}))},ze=e=>{const t=In(e);null==t||t.forEach((t=>{let r=0;null==t||t.forEach(((t,n)=>{var i;const o=e.node(t);o.order=n+r,null===(i=o.selfEdges)||void 0===i||i.forEach((t=>{On(e,"selfedge",{width:t.label.width,height:t.label.height,rank:o.rank,order:n+ ++r,e:t.e,label:t.label},"_se")})),delete o.selfEdges}))}))},He=e=>{e.nodes().forEach((t=>{const r=e.node(t);if("selfedge"===r.dummy){const n=e.node(r.e.v),i=n.x+n.width/2,o=n.y,a=r.x-i,s=n.height/2;e.setEdgeObj(r.e,r.label),e.removeNode(t),r.label.points=[{x:i+2*a/3,y:o-s},{x:i+5*a/6,y:o-s},{y:o,x:i+a},{x:i+5*a/6,y:o+s},{x:i+2*a/3,y:o+s}],r.label.x=r.x,r.label.y=r.y}}))},We=(e,t)=>{const r={};return null==t||t.forEach((t=>{void 0!==e[t]&&(r[t]=+e[t])})),r},$e=(e={})=>{const t={};return Object.keys(e).forEach((r=>{t[r.toLowerCase()]=e[r]})),t},Ye={layout:Ee,util:{time:Fn,notime:Bn}};class qe extends W{constructor(e){super(),this.rankdir="TB",this.nodesep=50,this.ranksep=50,this.controlPoints=!1,this.sortByCombo=!1,this.edgeLabelSpace=!0,this.radial=!1,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.layoutNode=e=>{const{nodes:t}=this,r=t.find((t=>t.id===e));return!r||!1!==r.layout},this.updateCfg(e)}getDefaultCfg(){return{rankdir:"TB",align:void 0,nodeSize:void 0,nodesepFunc:void 0,ranksepFunc:void 0,nodesep:50,ranksep:50,controlPoints:!1,radial:!1,focusNode:null}}execute(){var e,t,r;const n=this,{nodes:i,nodeSize:o,rankdir:a,combos:s,begin:c,radial:u,comboEdges:f=[],vedges:l=[]}=n;if(!i)return;const d=n.edges||[],h=new Tn({multigraph:!0,compound:!0});n.nodeMap={};const p={};let m;i.forEach((e=>{n.nodeMap[e.id]=e,e.comboId&&(p[e.comboId]=p[e.comboId]||[],p[e.comboId].push(e.id))})),m=o?Y(o)?()=>o:()=>[o,o]:e=>e.size?Y(e.size)?e.size:K(e.size)?[e.size.width||40,e.size.height||40]:[e.size,e.size]:[40,40];const v=J(n.ranksep,50,n.ranksepFunc),g=J(n.nodesep,50,n.nodesepFunc);let y=g,b=v;"LR"!==a&&"RL"!==a||(y=v,b=g),h.setDefaultEdgeLabel((()=>({}))),h.setGraph(n);const E={};let _;this.sortByCombo&&s&&s.forEach((e=>{if(E[e.id]=e,e.collapsed){const t=m(e),r=b(e),n=y(e),i=t[0]+2*n,o=t[1]+2*r;h.setNode(e.id,{width:i,height:o})}e.parentId&&(E[e.parentId]||h.setNode(e.parentId,{}),h.setParent(e.id,e.parentId))})),i.filter((e=>!1!==e.layout)).forEach((e=>{const t=m(e),r=b(e),n=y(e),i=t[0]+2*n,o=t[1]+2*r,a=e.layer;q(a)?h.setNode(e.id,{width:i,height:o,layer:a}):h.setNode(e.id,{width:i,height:o}),this.sortByCombo&&e.comboId&&(E[e.comboId]||(E[e.comboId]={id:e.comboId},h.setNode(e.comboId,{})),h.setParent(e.id,e.comboId))})),d.forEach((e=>{const t=Z(e,"source"),r=Z(e,"target");this.layoutNode(t)&&this.layoutNode(r)&&h.setEdge(t,r,{weight:e.weight||1})})),null===(e=null==f?void 0:f.concat(l||[]))||void 0===e||e.forEach((e=>{var t,r;const{source:n,target:i}=e,o=(null===(t=E[n])||void 0===t?void 0:t.collapsed)?[n]:p[n]||[n],a=(null===(r=E[i])||void 0===r?void 0:r.collapsed)?[i]:p[i]||[i];o.forEach((t=>{a.forEach((r=>{h.setEdge(t,r,{weight:e.weight||1})}))}))})),(null===(t=n.preset)||void 0===t?void 0:t.nodes)&&(_=new Tn({multigraph:!0,compound:!0}),n.preset.nodes.forEach((e=>{null==_||_.setNode(e.id,e)}))),Ye.layout(h,{prevGraph:_,edgeLabelSpace:n.edgeLabelSpace,keepNodeOrder:Boolean(!!n.nodeOrder),nodeOrder:n.nodeOrder});const A=[0,0];if(c){let e=1/0,t=1/0;h.nodes().forEach((r=>{const n=h.node(r);e>n.x&&(e=n.x),t>n.y&&(t=n.y)})),h.edges().forEach((r=>{var n;null===(n=h.edge(r).points)||void 0===n||n.forEach((r=>{e>r.x&&(e=r.x),t>r.y&&(t=r.y)}))})),A[0]=c[0]-e,A[1]=c[1]-t}const w="LR"===a||"RL"===a;if(u){const{focusNode:e,ranksep:t,getRadialPos:o}=this,a=$(e)?e:null==e?void 0:e.id,s=a?null===(r=h.node(a))||void 0===r?void 0:r._rank:0,c=[],u=w?"y":"x",f=w?"height":"width";let l=1/0,p=-1/0;h.nodes().forEach((e=>{const t=h.node(e),r=i.findIndex((t=>t.id===e));if(!i[r])return;const n=g(i[r]);if(0===s)c[t._rank]||(c[t._rank]={nodes:[],totalWidth:0,maxSize:-1/0}),c[t._rank].nodes.push(e),c[t._rank].totalWidth+=2*n+t[f],c[t._rank].maxSize<Math.max(t.width,t.height)&&(c[t._rank].maxSize=Math.max(t.width,t.height));else{const r=t._rank-s;if(0===r)c[r]||(c[r]={nodes:[],totalWidth:0,maxSize:-1/0}),c[r].nodes.push(e),c[r].totalWidth+=2*n+t[f],c[r].maxSize<Math.max(t.width,t.height)&&(c[r].maxSize=Math.max(t.width,t.height));else{const i=Math.abs(r);c[i]||(c[i]={left:[],right:[],totalWidth:0,maxSize:-1/0}),c[i].totalWidth+=2*n+t[f],c[i].maxSize<Math.max(t.width,t.height)&&(c[i].maxSize=Math.max(t.width,t.height)),r<0?c[i].left.push(e):c[i].right.push(e)}}const o=t[u]-t[f]/2-n,a=t[u]+t[f]/2+n;o<l&&(l=o),a>p&&(p=a)}));let m=t||50;const y={},b=(p-l)/.9,E=[.5*(l+p-b),.5*(l+p+b)],_=(e,t,r=-1/0,n=[0,1])=>{let a=r;return e.forEach((e=>{const r=h.node(e);y[e]=t;const{x:s,y:c}=o(r[u],E,b,t,n),f=i.findIndex((t=>t.id===e));if(!i[f])return;i[f].x=s+A[0],i[f].y=c+A[1],i[f]._order=r._order;const l=v(i[f]);a<l&&(a=l)})),a};let T=!0;c.forEach((e=>{var t,r,n,o,a,c,u;if(!(null===(t=null==e?void 0:e.nodes)||void 0===t?void 0:t.length)&&!(null===(r=null==e?void 0:e.left)||void 0===r?void 0:r.length)&&!(null===(n=null==e?void 0:e.right)||void 0===n?void 0:n.length))return;if(T&&1===e.nodes.length){const t=i.findIndex((t=>t.id===e.nodes[0]));if(t<=-1)return;return i[t].x=A[0],i[t].y=A[1],y[e.nodes[0]]=0,m=v(i[t]),void(T=!1)}m=Math.max(m,e.totalWidth/(2*Math.PI));let f=-1/0;if(0===s||(null===(o=e.nodes)||void 0===o?void 0:o.length))f=_(e.nodes,m,f,[0,1]);else{const t=(null===(a=e.left)||void 0===a?void 0:a.length)/((null===(c=e.left)||void 0===c?void 0:c.length)+(null===(u=e.right)||void 0===u?void 0:u.length));f=_(e.left,m,f,[0,t]),f=_(e.right,m,f,[t+.05,1])}m+=f,T=!1})),h.edges().forEach((e=>{var t,r,i;const a=h.edge(e),s=d.findIndex((t=>{const r=Z(t,"source"),n=Z(t,"target");return r===e.v&&n===e.w}));if(!(s<=-1)&&n.edgeLabelSpace&&n.controlPoints&&"loop"!==d[s].type){const n="x"===u?"y":"x",c=null===(t=null==a?void 0:a.points)||void 0===t?void 0:t.slice(1,a.points.length-1),f=[],l=null===(r=h.node(e.v))||void 0===r?void 0:r[n],p=l-(null===(i=h.node(e.w))||void 0===i?void 0:i[n]),m=y[e.v],v=m-y[e.w];null==c||c.forEach((e=>{const t=(e[n]-l)/p*v+m,r=o(e[u],E,b,t);f.push({x:r.x+A[0],y:r.y+A[1]})})),d[s].controlPoints=f}}))}else{const e=new Set,t="BT"===a||"RL"===a?(e,t)=>t-e:(e,t)=>e-t;h.nodes().forEach((t=>{const r=h.node(t);if(!r)return;let n=this.nodeMap[t];n||(n=null==s?void 0:s.find((e=>e.id===t))),n&&(n.x=r.x+A[0],n.y=r.y+A[1],n._order=r._order,e.add(w?n.x:n.y))}));const r=Array.from(e).sort(t),i=w?(e,t)=>e.x!==t.x:(e,t)=>e.y!==t.y,o=w?(e,t,r)=>{const n=Math.max(t.y,r.y),i=Math.min(t.y,r.y);return e.filter((e=>e.y<=n&&e.y>=i))}:(e,t,r)=>{const n=Math.max(t.x,r.x),i=Math.min(t.x,r.x);return e.filter((e=>e.x<=n&&e.x>=i))};h.edges().forEach((e=>{const t=h.edge(e),a=d.findIndex((t=>{const r=Z(t,"source"),n=Z(t,"target");return r===e.v&&n===e.w}));if(!(a<=-1)&&n.edgeLabelSpace&&n.controlPoints&&"loop"!==d[a].type){const s=n.nodeMap[e.v],c=n.nodeMap[e.w];d[a].controlPoints=Ke(null==t?void 0:t.points,s,c,r,w,i,o),d[a].controlPoints.forEach((e=>{e.x+=A[0],e.y+=A[1]}))}}))}return n.onLayoutEnd&&n.onLayoutEnd(),{nodes:i,edges:d}}getRadialPos(e,t,r,n,i=[0,1]){let o=(e-t[0])/r;o=o*(i[1]-i[0])+i[0];const a=2*o*Math.PI;return{x:Math.cos(a)*n,y:Math.sin(a)*n}}getType(){return"dagre"}}const Ke=(e,t,r,n,i,o,a)=>{let s=(null==e?void 0:e.slice(1,e.length-1))||[];if(t&&r){let{x:e,y:c}=t,{x:u,y:f}=r;if(i&&(e=t.y,c=t.x,u=r.y,f=r.x),f!==c&&e!==u){const l=n.indexOf(c),d=n[l+1];if(d){const e=s[0],t=i?{x:(c+d)/2,y:(null==e?void 0:e.y)||u}:{x:(null==e?void 0:e.x)||u,y:(c+d)/2};e&&!o(e,t)||s.unshift(t)}const h=n.indexOf(f),p=Math.abs(h-l);if(1===p)s=a(s,t,r),s.length||s.push(i?{x:(c+f)/2,y:e}:{x:e,y:(c+f)/2});else if(p>1){const t=n[h-1];if(t){const r=s[s.length-1],n=i?{x:(f+t)/2,y:(null==r?void 0:r.y)||u}:{x:(null==r?void 0:r.x)||e,y:(f+t)/2};r&&!o(r,n)||s.push(n)}}}}return s};var Qe,Ze,Je,ti;!function(e){e[e.META=0]="META",e[e.NODE=1]="NODE",e[e.BRIDGE=2]="BRIDGE"}(Qe||(Qe={})),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE",e[e.UNSPECIFIED=2]="UNSPECIFIED"}(Ze||(Ze={})),function(e){e[e.META=0]="META",e[e.CORE=1]="CORE",e[e.BRIDGE=2]="BRIDGE"}(Je||(Je={})),function(e){e[e.META=0]="META",e[e.OP=1]="OP",e[e.SERIES=2]="SERIES"}(ti||(ti={}));var ni="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ri(e,t){return e(t={exports:{}},t.exports),t.exports}var ei=function(){this.__data__=[],this.size=0},ii=function(e,t){return e===t||e!=e&&t!=t},ai=function(e,t){for(var r=e.length;r--;)if(ii(e[r][0],t))return r;return-1},oi=Array.prototype.splice,ui=function(e){var t=this.__data__,r=ai(t,e);return!(r<0||(r==t.length-1?t.pop():oi.call(t,r,1),--this.size,0))},fi=function(e){var t=this.__data__,r=ai(t,e);return r<0?void 0:t[r][1]},si=function(e){return ai(this.__data__,e)>-1},ci=function(e,t){var r=this.__data__,n=ai(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function li(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}li.prototype.clear=ei,li.prototype.delete=ui,li.prototype.get=fi,li.prototype.has=si,li.prototype.set=ci;var Ii,vi=li,di=function(){this.__data__=new vi,this.size=0},hi=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},bi=function(e){return this.__data__.get(e)},pi=function(e){return this.__data__.has(e)},mi="object"==typeof ni&&ni&&ni.Object===Object&&ni,yi="object"==typeof self&&self&&self.Object===Object&&self,wi=mi||yi||Function("return this")(),gi=wi.Symbol,Ei=Object.prototype,Ai=Ei.hasOwnProperty,_i=Ei.toString,Ti=gi?gi.toStringTag:void 0,Ri=function(e){var t=Ai.call(e,Ti),r=e[Ti];try{e[Ti]=void 0;var n=!0}catch(e){}var i=_i.call(e);return n&&(t?e[Ti]=r:delete e[Ti]),i},Oi=Object.prototype.toString,xi=function(e){return Oi.call(e)},ji=gi?gi.toStringTag:void 0,Si=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":ji&&ji in Object(e)?Ri(e):xi(e)},Ni=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},Mi=function(e){if(!Ni(e))return!1;var t=Si(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Ci=wi["__core-js_shared__"],Li=(Ii=/[^.]+$/.exec(Ci&&Ci.keys&&Ci.keys.IE_PROTO||""))?"Symbol(src)_1."+Ii:"",ki=function(e){return!!Li&&Li in e},Ui=Function.prototype.toString,Fi=function(e){if(null!=e){try{return Ui.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Bi=/^\[object .+?Constructor\]$/,Di=Function.prototype,Pi=Object.prototype,Gi=Di.toString,Vi=Pi.hasOwnProperty,Xi=RegExp("^"+Gi.call(Vi).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zi=function(e){return!(!Ni(e)||ki(e))&&(Mi(e)?Xi:Bi).test(Fi(e))},Hi=function(e,t){return null==e?void 0:e[t]},Wi=function(e,t){var r=Hi(e,t);return zi(r)?r:void 0},$i=Wi(wi,"Map"),Yi=Wi(Object,"create"),qi=function(){this.__data__=Yi?Yi(null):{},this.size=0},Ki=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Qi=Object.prototype.hasOwnProperty,Zi=function(e){var t=this.__data__;if(Yi){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Qi.call(t,e)?t[e]:void 0},Ji=Object.prototype.hasOwnProperty,ta=function(e){var t=this.__data__;return Yi?void 0!==t[e]:Ji.call(t,e)},na=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Yi&&void 0===t?"__lodash_hash_undefined__":t,this};function ra(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ra.prototype.clear=qi,ra.prototype.delete=Ki,ra.prototype.get=Zi,ra.prototype.has=ta,ra.prototype.set=na;var ea=ra,ia=function(){this.size=0,this.__data__={hash:new ea,map:new($i||vi),string:new ea}},aa=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e},oa=function(e,t){var r=e.__data__;return aa(t)?r["string"==typeof t?"string":"hash"]:r.map},ua=function(e){var t=oa(this,e).delete(e);return this.size-=t?1:0,t},fa=function(e){return oa(this,e).get(e)},sa=function(e){return oa(this,e).has(e)},ca=function(e,t){var r=oa(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function la(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}la.prototype.clear=ia,la.prototype.delete=ua,la.prototype.get=fa,la.prototype.has=sa,la.prototype.set=ca;var va=la,da=function(e,t){var r=this.__data__;if(r instanceof vi){var n=r.__data__;if(!$i||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new va(n)}return r.set(e,t),this.size=r.size,this};function ha(e){var t=this.__data__=new vi(e);this.size=t.size}ha.prototype.clear=di,ha.prototype.delete=hi,ha.prototype.get=bi,ha.prototype.has=pi,ha.prototype.set=da;var ba=ha,pa=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e},ma=function(){try{var e=Wi(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),ya=function(e,t,r){"__proto__"==t&&ma?ma(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},wa=Object.prototype.hasOwnProperty,ga=function(e,t,r){var n=e[t];wa.call(e,t)&&ii(n,r)&&(void 0!==r||t in e)||ya(e,t,r)},Ea=function(e,t,r,n){var i=!r;r||(r={});for(var o=-1,a=t.length;++o<a;){var s=t[o],c=n?n(r[s],e[s],s,r,e):void 0;void 0===c&&(c=e[s]),i?ya(r,s,c):ga(r,s,c)}return r},Aa=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n},_a=function(e){return null!=e&&"object"==typeof e},Ta=function(e){return _a(e)&&"[object Arguments]"==Si(e)},Ra=Object.prototype,Oa=Ra.hasOwnProperty,xa=Ra.propertyIsEnumerable,ja=Ta(function(){return arguments}())?Ta:function(e){return _a(e)&&Oa.call(e,"callee")&&!xa.call(e,"callee")},Sa=Array.isArray,Na=function(){return!1},Ia=ri((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,i=n&&n.exports===r?wi.Buffer:void 0,o=(i?i.isBuffer:void 0)||Na;e.exports=o})),Ma=/^(?:0|[1-9]\d*)$/,Ca=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Ma.test(e))&&e>-1&&e%1==0&&e<t},La=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},ka={};ka["[object Float32Array]"]=ka["[object Float64Array]"]=ka["[object Int8Array]"]=ka["[object Int16Array]"]=ka["[object Int32Array]"]=ka["[object Uint8Array]"]=ka["[object Uint8ClampedArray]"]=ka["[object Uint16Array]"]=ka["[object Uint32Array]"]=!0,ka["[object Arguments]"]=ka["[object Array]"]=ka["[object ArrayBuffer]"]=ka["[object Boolean]"]=ka["[object DataView]"]=ka["[object Date]"]=ka["[object Error]"]=ka["[object Function]"]=ka["[object Map]"]=ka["[object Number]"]=ka["[object Object]"]=ka["[object RegExp]"]=ka["[object Set]"]=ka["[object String]"]=ka["[object WeakMap]"]=!1;var Ua=function(e){return _a(e)&&La(e.length)&&!!ka[Si(e)]},Fa=function(e){return function(t){return e(t)}},Ba=ri((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,i=n&&n.exports===r&&mi.process,o=function(){try{return n&&n.require&&n.require("util").types||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=o})),Da=Ba&&Ba.isTypedArray,Pa=Da?Fa(Da):Ua,Ga=Object.prototype.hasOwnProperty,Va=function(e,t){var r=Sa(e),n=!r&&ja(e),i=!r&&!n&&Ia(e),o=!r&&!n&&!i&&Pa(e),a=r||n||i||o,s=a?Aa(e.length,String):[],c=s.length;for(var u in e)!t&&!Ga.call(e,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Ca(u,c))||s.push(u);return s},Xa=Object.prototype,za=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Xa)},Ha=function(e,t){return function(r){return e(t(r))}},Wa=Ha(Object.keys,Object),$a=Object.prototype.hasOwnProperty,Ya=function(e){if(!za(e))return Wa(e);var t=[];for(var r in Object(e))$a.call(e,r)&&"constructor"!=r&&t.push(r);return t},qa=function(e){return null!=e&&La(e.length)&&!Mi(e)},Ka=function(e){return qa(e)?Va(e):Ya(e)},Qa=function(e,t){return e&&Ea(t,Ka(t),e)},Za=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},Ja=Object.prototype.hasOwnProperty,to=function(e){if(!Ni(e))return Za(e);var t=za(e),r=[];for(var n in e)("constructor"!=n||!t&&Ja.call(e,n))&&r.push(n);return r},no=function(e){return qa(e)?Va(e,!0):to(e)},ro=function(e,t){return e&&Ea(t,no(t),e)},eo=ri((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,i=n&&n.exports===r?wi.Buffer:void 0,o=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=o?o(r):new e.constructor(r);return e.copy(n),n}})),io=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t},ao=function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var a=e[r];t(a,r,e)&&(o[i++]=a)}return o},oo=function(){return[]},uo=Object.prototype.propertyIsEnumerable,fo=Object.getOwnPropertySymbols,so=fo?function(e){return null==e?[]:(e=Object(e),ao(fo(e),(function(t){return uo.call(e,t)})))}:oo,co=function(e,t){return Ea(e,so(e),t)},lo=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e},vo=Ha(Object.getPrototypeOf,Object),ho=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)lo(t,so(e)),e=vo(e);return t}:oo,bo=function(e,t){return Ea(e,ho(e),t)},po=function(e,t,r){var n=t(e);return Sa(e)?n:lo(n,r(e))},mo=function(e){return po(e,Ka,so)},yo=function(e){return po(e,no,ho)},wo=Wi(wi,"DataView"),go=Wi(wi,"Promise"),Eo=Wi(wi,"Set"),Ao=Wi(wi,"WeakMap"),_o=Fi(wo),To=Fi($i),Ro=Fi(go),Oo=Fi(Eo),xo=Fi(Ao),jo=Si;(wo&&"[object DataView]"!=jo(new wo(new ArrayBuffer(1)))||$i&&"[object Map]"!=jo(new $i)||go&&"[object Promise]"!=jo(go.resolve())||Eo&&"[object Set]"!=jo(new Eo)||Ao&&"[object WeakMap]"!=jo(new Ao))&&(jo=function(e){var t=Si(e),r="[object Object]"==t?e.constructor:void 0,n=r?Fi(r):"";if(n)switch(n){case _o:return"[object DataView]";case To:return"[object Map]";case Ro:return"[object Promise]";case Oo:return"[object Set]";case xo:return"[object WeakMap]"}return t});var So=jo,No=Object.prototype.hasOwnProperty,Io=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&No.call(e,"index")&&(r.index=e.index,r.input=e.input),r},Mo=wi.Uint8Array,Co=function(e){var t=new e.constructor(e.byteLength);return new Mo(t).set(new Mo(e)),t},Lo=function(e,t){var r=t?Co(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)},ko=/\w*$/,Uo=function(e){var t=new e.constructor(e.source,ko.exec(e));return t.lastIndex=e.lastIndex,t},Fo=gi?gi.prototype:void 0,Bo=Fo?Fo.valueOf:void 0,Do=function(e){return Bo?Object(Bo.call(e)):{}},Po=function(e,t){var r=t?Co(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)},Go=function(e,t,r){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return Co(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return Lo(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Po(e,r);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return Uo(e);case"[object Symbol]":return Do(e)}},Vo=Object.create,Xo=function(){function e(){}return function(t){if(!Ni(t))return{};if(Vo)return Vo(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),zo=function(e){return"function"!=typeof e.constructor||za(e)?{}:Xo(vo(e))},Ho=function(e){return _a(e)&&"[object Map]"==So(e)},Wo=Ba&&Ba.isMap,$o=Wo?Fa(Wo):Ho,Yo=function(e){return _a(e)&&"[object Set]"==So(e)},qo=Ba&&Ba.isSet,Ko=qo?Fa(qo):Yo,Qo={};Qo["[object Arguments]"]=Qo["[object Array]"]=Qo["[object ArrayBuffer]"]=Qo["[object DataView]"]=Qo["[object Boolean]"]=Qo["[object Date]"]=Qo["[object Float32Array]"]=Qo["[object Float64Array]"]=Qo["[object Int8Array]"]=Qo["[object Int16Array]"]=Qo["[object Int32Array]"]=Qo["[object Map]"]=Qo["[object Number]"]=Qo["[object Object]"]=Qo["[object RegExp]"]=Qo["[object Set]"]=Qo["[object String]"]=Qo["[object Symbol]"]=Qo["[object Uint8Array]"]=Qo["[object Uint8ClampedArray]"]=Qo["[object Uint16Array]"]=Qo["[object Uint32Array]"]=!0,Qo["[object Error]"]=Qo["[object Function]"]=Qo["[object WeakMap]"]=!1;var Zo=function e(t,r,n,i,o,a){var s,c=1&r,u=2&r,f=4&r;if(n&&(s=o?n(t,i,o,a):n(t)),void 0!==s)return s;if(!Ni(t))return t;var l=Sa(t);if(l){if(s=Io(t),!c)return io(t,s)}else{var d=So(t),h="[object Function]"==d||"[object GeneratorFunction]"==d;if(Ia(t))return eo(t,c);if("[object Object]"==d||"[object Arguments]"==d||h&&!o){if(s=u||h?{}:zo(t),!c)return u?bo(t,ro(s,t)):co(t,Qa(s,t))}else{if(!Qo[d])return o?t:{};s=Go(t,d,c)}}a||(a=new ba);var p=a.get(t);if(p)return p;a.set(t,s),Ko(t)?t.forEach((function(i){s.add(e(i,r,n,i,t,a))})):$o(t)&&t.forEach((function(i,o){s.set(o,e(i,r,n,o,t,a))}));var m=l?void 0:(f?u?yo:mo:u?no:Ka)(t);return pa(m||t,(function(i,o){m&&(i=t[o=i]),ga(s,o,e(i,r,n,o,t,a))})),s},Jo=function(e){return Zo(e,4)},tu=function(e){return function(){return e}},nu=function(e,t,r){for(var n=-1,i=Object(e),o=r(e),a=o.length;a--;){var s=o[++n];if(!1===t(i[s],s,i))break}return e},ru=function(e,t){return e&&nu(e,t,Ka)},eu=function(e,t){return function(t,r){if(null==t)return t;if(!qa(t))return e(t,r);for(var n=t.length,i=-1,o=Object(t);++i<n&&!1!==r(o[i],i,o););return t}}(ru),iu=function(e){return e},au=function(e){return"function"==typeof e?e:iu},ou=function(e,t){return(Sa(e)?pa:eu)(e,au(t))},uu=ou,fu=function(e,t){var r=[];return eu(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r},su=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},cu=function(e){return this.__data__.has(e)};function lu(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new va;++t<r;)this.add(e[t])}lu.prototype.add=lu.prototype.push=su,lu.prototype.has=cu;var vu=lu,du=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1},hu=function(e,t){return e.has(t)},bu=function(e,t,r,n,i,o){var a=1&r,s=e.length,c=t.length;if(s!=c&&!(a&&c>s))return!1;var u=o.get(e),f=o.get(t);if(u&&f)return u==t&&f==e;var l=-1,d=!0,h=2&r?new vu:void 0;for(o.set(e,t),o.set(t,e);++l<s;){var p=e[l],m=t[l];if(n)var v=a?n(m,p,l,t,e,o):n(p,m,l,e,t,o);if(void 0!==v){if(v)continue;d=!1;break}if(h){if(!du(t,(function(e,t){if(!hu(h,t)&&(p===e||i(p,e,r,n,o)))return h.push(t)}))){d=!1;break}}else if(p!==m&&!i(p,m,r,n,o)){d=!1;break}}return o.delete(e),o.delete(t),d},pu=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r},mu=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},yu=gi?gi.prototype:void 0,wu=yu?yu.valueOf:void 0,gu=function(e,t,r,n,i,o,a){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new Mo(e),new Mo(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ii(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=pu;case"[object Set]":var c=1&n;if(s||(s=mu),e.size!=t.size&&!c)return!1;var u=a.get(e);if(u)return u==t;n|=2,a.set(e,t);var f=bu(s(e),s(t),n,i,o,a);return a.delete(e),f;case"[object Symbol]":if(wu)return wu.call(e)==wu.call(t)}return!1},Eu=Object.prototype.hasOwnProperty,Au=function(e,t,r,n,i,o){var a=1&r,s=mo(e),c=s.length;if(c!=mo(t).length&&!a)return!1;for(var u=c;u--;){var f=s[u];if(!(a?f in t:Eu.call(t,f)))return!1}var l=o.get(e),d=o.get(t);if(l&&d)return l==t&&d==e;var h=!0;o.set(e,t),o.set(t,e);for(var p=a;++u<c;){var m=e[f=s[u]],v=t[f];if(n)var g=a?n(v,m,f,t,e,o):n(m,v,f,e,t,o);if(!(void 0===g?m===v||i(m,v,r,n,o):g)){h=!1;break}p||(p="constructor"==f)}if(h&&!p){var y=e.constructor,b=t.constructor;y==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(h=!1)}return o.delete(e),o.delete(t),h},_u=Object.prototype.hasOwnProperty,Tu=function(e,t,r,n,i,o){var a=Sa(e),s=Sa(t),c=a?"[object Array]":So(e),u=s?"[object Array]":So(t),f="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),l="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),d=c==u;if(d&&Ia(e)){if(!Ia(t))return!1;a=!0,f=!1}if(d&&!f)return o||(o=new ba),a||Pa(e)?bu(e,t,r,n,i,o):gu(e,t,c,r,n,i,o);if(!(1&r)){var h=f&&_u.call(e,"__wrapped__"),p=l&&_u.call(t,"__wrapped__");if(h||p){var m=h?e.value():e,v=p?t.value():t;return o||(o=new ba),i(m,v,r,n,o)}}return!!d&&(o||(o=new ba),Au(e,t,r,n,i,o))},Ru=function e(t,r,n,i,o){return t===r||(null==t||null==r||!_a(t)&&!_a(r)?t!=t&&r!=r:Tu(t,r,n,i,e,o))},Ou=function(e,t,r,n){var i=r.length,o=i,a=!n;if(null==e)return!o;for(e=Object(e);i--;){var s=r[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var c=(s=r[i])[0],u=e[c],f=s[1];if(a&&s[2]){if(void 0===u&&!(c in e))return!1}else{var l=new ba;if(n)var d=n(u,f,c,e,t,l);if(!(void 0===d?Ru(f,u,3,n,l):d))return!1}}return!0},xu=function(e){return e==e&&!Ni(e)},ju=function(e){for(var t=Ka(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,xu(i)]}return t},Su=function(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}},Nu=function(e){var t=ju(e);return 1==t.length&&t[0][2]?Su(t[0][0],t[0][1]):function(r){return r===e||Ou(r,e,t)}},Iu=function(e){return"symbol"==typeof e||_a(e)&&"[object Symbol]"==Si(e)},Mu=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Cu=/^\w*$/,Lu=function(e,t){if(Sa(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Iu(e))||Cu.test(e)||!Mu.test(e)||null!=t&&e in Object(t)};function ku(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return r.cache=o.set(i,a)||o,a};return r.cache=new(ku.Cache||va),r}ku.Cache=va;var rs,Uu=ku,Fu=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Bu=/\\(\\)?/g,Du=function(e){var t=Uu((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Fu,(function(e,r,n,i){t.push(n?i.replace(Bu,"$1"):r||e)})),t}),(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t}(),Pu=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i},Gu=gi?gi.prototype:void 0,Vu=Gu?Gu.toString:void 0,Xu=function e(t){if("string"==typeof t)return t;if(Sa(t))return Pu(t,e)+"";if(Iu(t))return Vu?Vu.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r},zu=function(e){return null==e?"":Xu(e)},Hu=function(e,t){return Sa(e)?e:Lu(e,t)?[e]:Du(zu(e))},Wu=function(e){if("string"==typeof e||Iu(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t},$u=function(e,t){for(var r=0,n=(t=Hu(t,e)).length;null!=e&&r<n;)e=e[Wu(t[r++])];return r&&r==n?e:void 0},Yu=function(e,t,r){var n=null==e?void 0:$u(e,t);return void 0===n?r:n},qu=function(e,t){return null!=e&&t in Object(e)},Ku=function(e,t,r){for(var n=-1,i=(t=Hu(t,e)).length,o=!1;++n<i;){var a=Wu(t[n]);if(!(o=null!=e&&r(e,a)))break;e=e[a]}return o||++n!=i?o:!!(i=null==e?0:e.length)&&La(i)&&Ca(a,i)&&(Sa(e)||ja(e))},Qu=function(e,t){return null!=e&&Ku(e,t,qu)},Zu=function(e,t){return Lu(e)&&xu(t)?Su(Wu(e),t):function(r){var n=Yu(r,e);return void 0===n&&n===t?Qu(r,e):Ru(t,n,3)}},Ju=function(e){return function(t){return null==t?void 0:t[e]}},tf=function(e){return function(t){return $u(t,e)}},nf=function(e){return Lu(e)?Ju(Wu(e)):tf(e)},rf=function(e){return"function"==typeof e?e:null==e?iu:"object"==typeof e?Sa(e)?Zu(e[0],e[1]):Nu(e):nf(e)},ef=function(e,t){return(Sa(e)?ao:fu)(e,rf(t))},af=Object.prototype.hasOwnProperty,of=function(e,t){return null!=e&&af.call(e,t)},uf=function(e,t){return null!=e&&Ku(e,t,of)},ff=Object.prototype.hasOwnProperty,sf=function(e){if(null==e)return!0;if(qa(e)&&(Sa(e)||"string"==typeof e||"function"==typeof e.splice||Ia(e)||Pa(e)||ja(e)))return!e.length;var t=So(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(za(e))return!Ya(e).length;for(var r in e)if(ff.call(e,r))return!1;return!0},cf=function(e){return void 0===e},lf=function(e,t){var r=-1,n=qa(e)?Array(e.length):[];return eu(e,(function(e,i,o){n[++r]=t(e,i,o)})),n},vf=function(e,t){return(Sa(e)?Pu:lf)(e,rf(t))},df=function(e,t,r,n){var i=-1,o=null==e?0:e.length;for(n&&o&&(r=e[++i]);++i<o;)r=t(r,e[i],i,e);return r},hf=function(e,t,r,n,i){return i(e,(function(e,i,o){r=n?(n=!1,e):t(r,e,i,o)})),r},bf=function(e,t,r){var n=Sa(e)?df:hf,i=arguments.length<3;return n(e,rf(t),r,i,eu)},pf=function(e){return"string"==typeof e||!Sa(e)&&_a(e)&&"[object String]"==Si(e)},mf=Ju("length"),yf=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]"),wf=function(e){return yf.test(e)},gf="[\\ud800-\\udfff]",Ef="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Af="\\ud83c[\\udffb-\\udfff]",_f="[^\\ud800-\\udfff]",Tf="(?:\\ud83c[\\udde6-\\uddff]){2}",Rf="[\\ud800-\\udbff][\\udc00-\\udfff]",Of="(?:"+Ef+"|"+Af+")?",xf="[\\ufe0e\\ufe0f]?"+Of+"(?:\\u200d(?:"+[_f,Tf,Rf].join("|")+")[\\ufe0e\\ufe0f]?"+Of+")*",jf="(?:"+[_f+Ef+"?",Ef,Tf,Rf,gf].join("|")+")",Sf=RegExp(Af+"(?="+Af+")|"+jf+xf,"g"),Nf=function(e){for(var t=Sf.lastIndex=0;Sf.test(e);)++t;return t},If=function(e){return wf(e)?Nf(e):mf(e)},Mf=function(e){if(null==e)return 0;if(qa(e))return pf(e)?If(e):e.length;var t=So(e);return"[object Map]"==t||"[object Set]"==t?e.size:Ya(e).length},Cf=function(e,t,r){var n=Sa(e),i=n||Ia(e)||Pa(e);if(t=rf(t),null==r){var o=e&&e.constructor;r=i?n?new o:[]:Ni(e)&&Mi(o)?Xo(vo(e)):{}}return(i?pa:ru)(e,(function(e,n,i){return t(r,e,n,i)})),r},Lf=gi?gi.isConcatSpreadable:void 0,kf=function(e){return Sa(e)||ja(e)||!!(Lf&&e&&e[Lf])},Uf=function e(t,r,n,i,o){var a=-1,s=t.length;for(n||(n=kf),o||(o=[]);++a<s;){var c=t[a];r>0&&n(c)?r>1?e(c,r-1,n,i,o):lo(o,c):i||(o[o.length]=c)}return o},Ff=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)},Bf=Math.max,Df=function(e,t,r){return t=Bf(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=Bf(n.length-t,0),a=Array(o);++i<o;)a[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(a),Ff(e,this,s)}},Pf=ma?function(e,t){return ma(e,"toString",{configurable:!0,enumerable:!1,value:tu(t),writable:!0})}:iu,Gf=Date.now,Vf=function(e){var t=0,r=0;return function(){var n=Gf(),i=16-(n-r);if(r=n,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Pf),Xf=function(e,t){return Vf(Df(e,t,iu),e+"")},zf=function(e,t,r,n){for(var i=e.length,o=r+(n?1:-1);n?o--:++o<i;)if(t(e[o],o,e))return o;return-1},Hf=function(e){return e!=e},Wf=function(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1},$f=function(e,t,r){return t==t?Wf(e,t,r):zf(e,Hf,r)},Yf=function(e,t){return!(null==e||!e.length)&&$f(e,t,0)>-1},qf=function(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1},Kf=function(){},Qf=Eo&&1/mu(new Eo([,-0]))[1]==1/0?function(e){return new Eo(e)}:Kf,Zf=function(e,t,r){var n=-1,i=Yf,o=e.length,a=!0,s=[],c=s;if(r)a=!1,i=qf;else if(o>=200){var u=t?null:Qf(e);if(u)return mu(u);a=!1,i=hu,c=new vu}else c=t?[]:s;e:for(;++n<o;){var f=e[n],l=t?t(f):f;if(f=r||0!==f?f:0,a&&l==l){for(var d=c.length;d--;)if(c[d]===l)continue e;t&&c.push(l),s.push(f)}else i(c,l,r)||(c!==s&&c.push(l),s.push(f))}return s},Jf=function(e){return _a(e)&&qa(e)},ts=Xf((function(e){return Zf(Uf(e,1,Jf,!0))})),ns=function(e,t){return Pu(t,(function(t){return e[t]}))},es=function(e){return null==e?[]:ns(e,Ka(e))};try{rs={clone:Jo,constant:tu,each:uu,filter:ef,has:uf,isArray:Sa,isEmpty:sf,isFunction:Mi,isUndefined:cf,keys:Ka,map:vf,reduce:bf,size:Mf,transform:Cf,union:ts,values:es}}catch(t){}rs||(rs=window._);var is=rs;function as(e){this._isDirected=!is.has(e,"directed")||e.directed,this._isMultigraph=!!is.has(e,"multigraph")&&e.multigraph,this._isCompound=!!is.has(e,"compound")&&e.compound,this._label=void 0,this._defaultNodeLabelFn=is.constant(void 0),this._defaultEdgeLabelFn=is.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children["\0"]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function os(e,t){e[t]?e[t]++:e[t]=1}function us(e,t){--e[t]||delete e[t]}function fs(e,t,r,n){var i=""+t,o=""+r;if(!e&&i>o){var a=i;i=o,o=a}return i+""+o+""+(is.isUndefined(n)?"\0":n)}function ss(e,t,r,n){var i=""+t,o=""+r;if(!e&&i>o){var a=i;i=o,o=a}var s={v:i,w:o};return n&&(s.name=n),s}function cs(e,t){return fs(e,t.v,t.w,t.name)}as.prototype._nodeCount=0,as.prototype._edgeCount=0,as.prototype.isDirected=function(){return this._isDirected},as.prototype.isMultigraph=function(){return this._isMultigraph},as.prototype.isCompound=function(){return this._isCompound},as.prototype.setGraph=function(e){return this._label=e,this},as.prototype.graph=function(){return this._label},as.prototype.setDefaultNodeLabel=function(e){return is.isFunction(e)||(e=is.constant(e)),this._defaultNodeLabelFn=e,this},as.prototype.nodeCount=function(){return this._nodeCount},as.prototype.nodes=function(){return is.keys(this._nodes)},as.prototype.sources=function(){var e=this;return is.filter(this.nodes(),(function(t){return is.isEmpty(e._in[t])}))},as.prototype.sinks=function(){var e=this;return is.filter(this.nodes(),(function(t){return is.isEmpty(e._out[t])}))},as.prototype.setNodes=function(e,t){var r=arguments,n=this;return is.each(e,(function(e){r.length>1?n.setNode(e,t):n.setNode(e)})),this},as.prototype.setNode=function(e,t){return is.has(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=t),this):(this._nodes[e]=arguments.length>1?t:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]="\0",this._children[e]={},this._children["\0"][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)},as.prototype.node=function(e){return this._nodes[e]},as.prototype.hasNode=function(e){return is.has(this._nodes,e)},as.prototype.removeNode=function(e){var t=this;if(is.has(this._nodes,e)){var r=function(e){t.removeEdge(t._edgeObjs[e])};delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],is.each(this.children(e),(function(e){t.setParent(e)})),delete this._children[e]),is.each(is.keys(this._in[e]),r),delete this._in[e],delete this._preds[e],is.each(is.keys(this._out[e]),r),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this},as.prototype.setParent=function(e,t){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(is.isUndefined(t))t="\0";else{for(var r=t+="";!is.isUndefined(r);r=this.parent(r))if(r===e)throw new Error("Setting "+t+" as parent of "+e+" would create a cycle");this.setNode(t)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=t,this._children[t][e]=!0,this},as.prototype._removeFromParentsChildList=function(e){delete this._children[this._parent[e]][e]},as.prototype.parent=function(e){if(this._isCompound){var t=this._parent[e];if("\0"!==t)return t}},as.prototype.children=function(e){if(is.isUndefined(e)&&(e="\0"),this._isCompound){var t=this._children[e];if(t)return is.keys(t)}else{if("\0"===e)return this.nodes();if(this.hasNode(e))return[]}},as.prototype.predecessors=function(e){var t=this._preds[e];if(t)return is.keys(t)},as.prototype.successors=function(e){var t=this._sucs[e];if(t)return is.keys(t)},as.prototype.neighbors=function(e){var t=this.predecessors(e);if(t)return is.union(t,this.successors(e))},as.prototype.isLeaf=function(e){return 0===(this.isDirected()?this.successors(e):this.neighbors(e)).length},as.prototype.filterNodes=function(e){var t=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});t.setGraph(this.graph());var r=this;is.each(this._nodes,(function(r,n){e(n)&&t.setNode(n,r)})),is.each(this._edgeObjs,(function(e){t.hasNode(e.v)&&t.hasNode(e.w)&&t.setEdge(e,r.edge(e))}));var n={};function i(e){var o=r.parent(e);return void 0===o||t.hasNode(o)?(n[e]=o,o):o in n?n[o]:i(o)}return this._isCompound&&is.each(t.nodes(),(function(e){t.setParent(e,i(e))})),t},as.prototype.setDefaultEdgeLabel=function(e){return is.isFunction(e)||(e=is.constant(e)),this._defaultEdgeLabelFn=e,this},as.prototype.edgeCount=function(){return this._edgeCount},as.prototype.edges=function(){return is.values(this._edgeObjs)},as.prototype.setPath=function(e,t){var r=this,n=arguments;return is.reduce(e,(function(e,i){return n.length>1?r.setEdge(e,i,t):r.setEdge(e,i),i})),this},as.prototype.setEdge=function(){var e,t,r,n,i=!1,o=arguments[0];"object"==typeof o&&null!==o&&"v"in o?(e=o.v,t=o.w,r=o.name,2===arguments.length&&(n=arguments[1],i=!0)):(e=o,t=arguments[1],r=arguments[3],arguments.length>2&&(n=arguments[2],i=!0)),e=""+e,t=""+t,is.isUndefined(r)||(r=""+r);var a=fs(this._isDirected,e,t,r);if(is.has(this._edgeLabels,a))return i&&(this._edgeLabels[a]=n),this;if(!is.isUndefined(r)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(t),this._edgeLabels[a]=i?n:this._defaultEdgeLabelFn(e,t,r);var s=ss(this._isDirected,e,t,r);return e=s.v,t=s.w,Object.freeze(s),this._edgeObjs[a]=s,os(this._preds[t],e),os(this._sucs[e],t),this._in[t][a]=s,this._out[e][a]=s,this._edgeCount++,this},as.prototype.edge=function(e,t,r){var n=1===arguments.length?cs(this._isDirected,arguments[0]):fs(this._isDirected,e,t,r);return this._edgeLabels[n]},as.prototype.hasEdge=function(e,t,r){var n=1===arguments.length?cs(this._isDirected,arguments[0]):fs(this._isDirected,e,t,r);return is.has(this._edgeLabels,n)},as.prototype.removeEdge=function(e,t,r){var n=1===arguments.length?cs(this._isDirected,arguments[0]):fs(this._isDirected,e,t,r),i=this._edgeObjs[n];return i&&(e=i.v,t=i.w,delete this._edgeLabels[n],delete this._edgeObjs[n],us(this._preds[t],e),us(this._sucs[e],t),delete this._in[t][n],delete this._out[e][n],this._edgeCount--),this},as.prototype.inEdges=function(e,t){var r=this._in[e];if(r){var n=is.values(r);return t?is.filter(n,(function(e){return e.v===t})):n}},as.prototype.outEdges=function(e,t){var r=this._out[e];if(r){var n=is.values(r);return t?is.filter(n,(function(e){return e.w===t})):n}},as.prototype.nodeEdges=function(e,t){var r=this.inEdges(e,t);if(r)return r.concat(this.outEdges(e,t))},is.constant(1),is.constant(1);var vc,ls=function(e){return Zo(e,5)},vs=function(e,t,r){if(!Ni(r))return!1;var n=typeof t;return!!("number"==n?qa(r)&&Ca(t,r.length):"string"==n&&t in r)&&ii(r[t],e)},ds=Object.prototype,hs=ds.hasOwnProperty,bs=Xf((function(e,t){e=Object(e);var r=-1,n=t.length,i=n>2?t[2]:void 0;for(i&&vs(t[0],t[1],i)&&(n=1);++r<n;)for(var o=t[r],a=no(o),s=-1,c=a.length;++s<c;){var u=a[s],f=e[u];(void 0===f||ii(f,ds[u])&&!hs.call(e,u))&&(e[u]=o[u])}return e})),ps=function(e){return function(t,r,n){var i=Object(t);if(!qa(t)){var o=rf(r);t=Ka(t),r=function(e){return o(i[e],e,i)}}var a=e(t,r,n);return a>-1?i[o?t[a]:a]:void 0}},ms=/^\s+|\s+$/g,ys=/^[-+]0x[0-9a-f]+$/i,ws=/^0b[01]+$/i,gs=/^0o[0-7]+$/i,Es=parseInt,As=function(e){if("number"==typeof e)return e;if(Iu(e))return NaN;if(Ni(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Ni(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(ms,"");var r=ws.test(e);return r||gs.test(e)?Es(e.slice(2),r?2:8):ys.test(e)?NaN:+e},_s=function(e){return e?1/0===(e=As(e))||-1/0===e?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0},Ts=function(e){var t=_s(e),r=t%1;return t==t?r?t-r:t:0},Rs=Math.max,Os=ps((function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:Ts(r);return i<0&&(i=Rs(n+i,0)),zf(e,rf(t),i)})),xs=function(e){return null!=e&&e.length?Uf(e,1):[]},js=function(e,t){return null==e?e:nu(e,au(t),no)},Ss=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0},Ns=function(e,t){var r={};return t=rf(t),ru(e,(function(e,n,i){ya(r,n,t(e,n,i))})),r},Is=function(e,t,r){for(var n=-1,i=e.length;++n<i;){var o=e[n],a=t(o);if(null!=a&&(void 0===s?a==a&&!Iu(a):r(a,s)))var s=a,c=o}return c},Ms=function(e,t){return e>t},Cs=function(e){return e&&e.length?Is(e,iu,Ms):void 0},Ls=function(e,t,r){(void 0!==r&&!ii(e[t],r)||void 0===r&&!(t in e))&&ya(e,t,r)},ks=Function.prototype,Us=Object.prototype,Fs=ks.toString,Bs=Us.hasOwnProperty,Ds=Fs.call(Object),Ps=function(e){if(!_a(e)||"[object Object]"!=Si(e))return!1;var t=vo(e);if(null===t)return!0;var r=Bs.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Fs.call(r)==Ds},Gs=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},Vs=function(e){return Ea(e,no(e))},Xs=function(e,t,r,n,i,o,a){var s=Gs(e,r),c=Gs(t,r),u=a.get(c);if(u)Ls(e,r,u);else{var f=o?o(s,c,r+"",e,t,a):void 0,l=void 0===f;if(l){var d=Sa(c),h=!d&&Ia(c),p=!d&&!h&&Pa(c);f=c,d||h||p?Sa(s)?f=s:Jf(s)?f=io(s):h?(l=!1,f=eo(c,!0)):p?(l=!1,f=Po(c,!0)):f=[]:Ps(c)||ja(c)?(f=s,ja(s)?f=Vs(s):Ni(s)&&!Mi(s)||(f=zo(c))):l=!1}l&&(a.set(c,f),i(f,c,n,o,a),a.delete(c)),Ls(e,r,f)}},zs=function e(t,r,n,i,o){t!==r&&nu(r,(function(a,s){if(o||(o=new ba),Ni(a))Xs(t,r,s,n,e,i,o);else{var c=i?i(Gs(t,s),a,s+"",t,r,o):void 0;void 0===c&&(c=a),Ls(t,s,c)}}),no)},Hs=function(e){return Xf((function(t,r){var n=-1,i=r.length,o=i>1?r[i-1]:void 0,a=i>2?r[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&vs(r[0],r[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++n<i;){var s=r[n];s&&e(t,s,n)}return t}))}((function(e,t,r){zs(e,t,r)})),Ws=function(e,t){return e<t},$s=function(e){return e&&e.length?Is(e,iu,Ws):void 0},Ys=function(e,t){return e&&e.length?Is(e,rf(t),Ws):void 0},qs=function(){return wi.Date.now()},Ks=function(e,t,r,n){if(!Ni(e))return e;for(var i=-1,o=(t=Hu(t,e)).length,a=o-1,s=e;null!=s&&++i<o;){var c=Wu(t[i]),u=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=a){var f=s[c];void 0===(u=n?n(f,c,s):void 0)&&(u=Ni(f)?f:Ca(t[i+1])?[]:{})}ga(s,c,u),s=s[c]}return e},Qs=function(e,t,r){for(var n=-1,i=t.length,o={};++n<i;){var a=t[n],s=$u(e,a);r(s,a)&&Ks(o,Hu(a,e),s)}return o},Zs=function(e,t){return Qs(e,t,(function(t,r){return Qu(e,r)}))},Js=function(e){return Vf(Df(e,void 0,xs),e+"")}((function(e,t){return null==e?{}:Zs(e,t)})),tc=Math.ceil,nc=Math.max,rc=function(e,t,r,n){for(var i=-1,o=nc(tc((t-e)/(r||1)),0),a=Array(o);o--;)a[n?o:++i]=e,e+=r;return a},ec=function(e,t,r){return r&&"number"!=typeof r&&vs(e,t,r)&&(t=r=void 0),e=_s(e),void 0===t?(t=e,e=0):t=_s(t),r=void 0===r?e<t?1:-1:_s(r),rc(e,t,r,void 0)},ic=function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e},ac=function(e,t){if(e!==t){var r=void 0!==e,n=null===e,i=e==e,o=Iu(e),a=void 0!==t,s=null===t,c=t==t,u=Iu(t);if(!s&&!u&&!o&&e>t||o&&a&&c&&!s&&!u||n&&a&&c||!r&&c||!i)return 1;if(!n&&!o&&!u&&e<t||u&&r&&i&&!n&&!o||s&&r&&i||!a&&i||!c)return-1}return 0},oc=function(e,t,r){for(var n=-1,i=e.criteria,o=t.criteria,a=i.length,s=r.length;++n<a;){var c=ac(i[n],o[n]);if(c)return n>=s?c:c*("desc"==r[n]?-1:1)}return e.index-t.index},uc=function(e,t,r){t=t.length?Pu(t,(function(e){return Sa(e)?function(t){return $u(t,1===e.length?e[0]:e)}:e})):[iu];var n=-1;t=Pu(t,Fa(rf));var i=lf(e,(function(e,r,i){return{criteria:Pu(t,(function(t){return t(e)})),index:++n,value:e}}));return ic(i,(function(e,t){return oc(e,t,r)}))},fc=Xf((function(e,t){if(null==e)return[];var r=t.length;return r>1&&vs(e,t[0],t[1])?t=[]:r>2&&vs(t[0],t[1],t[2])&&(t=[t[0]]),uc(e,Uf(t,1),[])})),sc=0,cc=function(e){var t=++sc;return zu(e)+t},lc=function(e,t,r){for(var n=-1,i=e.length,o=t.length,a={};++n<i;){var s=n<o?t[n]:void 0;r(a,e[n],s)}return a},dc=function(e,t){return lc(e||[],t||[],ga)};try{vc={cloneDeep:ls,constant:tu,defaults:bs,each:uu,filter:ef,find:Os,flatten:xs,forEach:ou,forIn:js,has:uf,isUndefined:cf,last:Ss,map:vf,mapValues:Ns,max:Cs,merge:Hs,min:$s,minBy:Ys,now:qs,pick:Js,range:ec,reduce:bf,sortBy:fc,uniqueId:cc,values:es,zipObject:dc}}catch(t){}vc||(vc=window._);var hc=vc;hc.constant(1),N((function(e){function t(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(i,o){var a=e.apply(r,n);function s(e){t(a,i,o,s,c,"next",e)}function c(e){t(a,i,o,s,c,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports}));var bc=N((function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),pc=N((function(e){var t=bc.default;e.exports=function(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,r||"default");if("object"!==t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports})),mc=N((function(e){var t=bc.default;e.exports=function(e){var r=pc(e,"string");return"symbol"===t(r)?r:String(r)},e.exports.__esModule=!0,e.exports.default=e.exports})),yc=N((function(e){e.exports=function(e,t,r){return(t=mc(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports}));const wc=I(yc);N((function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports})),N((function(e){function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,mc(n.key),n)}}e.exports=function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports}));var Ac,_c,Tc,Rc,Oc,xc,jc,Sc,Nc,Ic,Mc,Cc,Lc,kc,Uc,Fc,Bc,Dc,Pc,gc=N((function(e){var t=bc.default;function r(){e.exports=r=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var n={},i=Object.prototype,o=i.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",f=s.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof m?t:m,o=Object.create(i.prototype),s=new N(n||[]);return a(o,"_invoke",{value:T(e,r,s)}),o}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}n.wrap=d;var p={};function m(){}function v(){}function g(){}var y={};l(y,c,(function(){return this}));var b=Object.getPrototypeOf,E=b&&b(b(O([])));E&&E!==i&&o.call(E,c)&&(y=E);var _=g.prototype=m.prototype=Object.create(y);function A(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,r){function n(i,a,s,c){var u=h(e[i],e,a);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==t(l)&&o.call(l,"__await")?r.resolve(l.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):r.resolve(l).then((function(e){f.value=e,s(f)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var i;a(this,"_invoke",{value:function(e,t){function o(){return new r((function(r,i){n(e,t,r,i)}))}return i=i?i.then(o,o):o()}})}function T(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=x(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=h(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function x(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var i=h(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,p;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function O(e){if(e){var t=e[c];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(o.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=g,a(_,"constructor",{value:g,configurable:!0}),a(g,"constructor",{value:v,configurable:!0}),v.displayName=l(g,f,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,f,"GeneratorFunction")),e.prototype=Object.create(_),e},n.awrap=function(e){return{__await:e}},A(w.prototype),l(w.prototype,u,(function(){return this})),n.AsyncIterator=w,n.async=function(e,t,r,i,o){void 0===o&&(o=Promise);var a=new w(d(e,t,r,i),o);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},A(_),l(_,f,"Generator"),l(_,c,(function(){return this})),l(_,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},n.values=O,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),c=o.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;R(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:O(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})),Ec=gc();try{regeneratorRuntime=Ec}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=Ec:Function("r","regeneratorRuntime = r")(Ec)}!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.SAMPLED=4]="SAMPLED",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"}(Ac||(Ac={})),"undefined"!=typeof navigator&&/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),function(e){e.Void="Void",e.Boolean="Boolean",e.Float="Float",e.Uint32="Uint32",e.Int32="Int32",e.Vector="Vector",e.Vector2Float="vec2<f32>",e.Vector3Float="vec3<f32>",e.Vector4Float="vec4<f32>",e.Vector2Boolean="vec2<bool>",e.Vector3Boolean="vec3<bool>",e.Vector4Boolean="vec4<bool>",e.Vector2Uint="vec2<u32>",e.Vector3Uint="vec3<u32>",e.Vector4Uint="vec4<u32>",e.Vector2Int="vec2<i32>",e.Vector3Int="vec3<i32>",e.Vector4Int="vec4<i32>",e.Matrix="Matrix",e.Matrix3x3Float="mat3x3<f32>",e.Matrix4x4Float="mat4x4<i32>",e.Struct="Struct",e.FloatArray="Float[]",e.Vector4FloatArray="vec4<f32>[]"}(_c||(_c={})),function(e){e.Program="Program",e.Identifier="Identifier",e.VariableDeclaration="VariableDeclaration",e.BlockStatement="BlockStatement",e.ReturnStatement="ReturnStatement",e.FunctionDeclaration="FunctionDeclaration",e.VariableDeclarator="VariableDeclarator",e.AssignmentExpression="AssignmentExpression",e.LogicalExpression="LogicalExpression",e.BinaryExpression="BinaryExpression",e.ArrayExpression="ArrayExpression",e.UnaryExpression="UnaryExpression",e.UpdateExpression="UpdateExpression",e.FunctionExpression="FunctionExpression",e.MemberExpression="MemberExpression",e.ConditionalExpression="ConditionalExpression",e.ExpressionStatement="ExpressionStatement",e.CallExpression="CallExpression",e.NumThreadStatement="NumThreadStatement",e.StorageStatement="StorageStatement",e.DoWhileStatement="DoWhileStatement",e.WhileStatement="WhileStatement",e.ForStatement="ForStatement",e.BreakStatement="BreakStatement",e.ContinueStatement="ContinueStatement",e.IfStatement="IfStatement",e.ImportedFunctionStatement="ImportedFunctionStatement"}(Tc||(Tc={})),function(e){e.Input="Input",e.Output="Output",e.Uniform="Uniform",e.Workgroup="Workgroup",e.UniformConstant="UniformConstant",e.Image="Image",e.StorageBuffer="StorageBuffer",e.Private="Private",e.Function="Function"}(Rc||(Rc={})),function(e){e.GLSL100="GLSL100",e.GLSL450="GLSL450",e.WGSL="WGSL"}(Oc||(Oc={})),N((function(e,t){e.exports=function(){var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;++n)e[r[n]]=t[r[n]];return e},r="\n";function n(e){return"undefined"!=typeof atob?atob(e):"base64:"+e}function i(e){var t=new Error("(regl) "+e);throw console.error(t),t}function o(e,t){e||i(t)}function a(e){return e?": "+e:""}function s(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function c(e,t,r){t.indexOf(e)<0&&i("invalid value"+a(r)+". must be one of: "+t)}var u=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function f(e,t){for(e+="";e.length<t;)e=" "+e;return e}function l(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function d(e,t){this.number=e,this.line=t,this.errors=[]}function h(e,t,r){this.file=e,this.line=t,this.message=r}function p(){var e=new Error,t=(e.stack||e).toString(),r=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return n?n[1]:"unknown"}function m(){var e=new Error,t=(e.stack||e).toString(),r=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return n?n[1]:"unknown"}function v(e,t){var r=e.split("\n"),i=1,o=0,a={unknown:new l,0:new l};a.unknown.name=a[0].name=t||p(),a.unknown.lines.push(new d(0,""));for(var s=0;s<r.length;++s){var c=r[s],u=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(c);if(u)switch(u[1]){case"line":var f=/(\d+)(\s+\d+)?/.exec(u[2]);f&&(i=0|f[1],f[2]&&((o=0|f[2])in a||(a[o]=new l)));break;case"define":var h=/SHADER_NAME(_B64)?\s+(.*)$/.exec(u[2]);h&&(a[o].name=h[1]?n(h[2]):h[2])}a[o].lines.push(new d(i++,c))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function g(e){e._commandRef=p()}function y(e,t){var r=m();i(e+" in command "+(t||p())+("unknown"===r?"":" called from "+r))}function b(e,t,r,n){s(e,t)||y("invalid parameter type"+a(r)+". expected "+t+", got "+typeof e,n||p())}var E=33071,_=32819,A=32820,w=33635,T=34042,x={};function S(e,t){return e===A||e===_||e===w?2:e===T?4:x[e]*t}function R(e){return!(e&e-1||!e)}x[5120]=x[5121]=1,x[5122]=x[5123]=x[36193]=x[w]=x[_]=x[A]=2,x[5124]=x[5125]=x[5126]=x[T]=4;var N=t(o,{optional:function(e){e()},raise:i,commandRaise:y,command:function(e,t,r){e||y(t,r||p())},parameter:function(e,t,r){e in t||i("unknown parameter ("+e+")"+a(r)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,r,n){e in t||y("unknown parameter ("+e+")"+a(r)+". possible values: "+Object.keys(t).join(),n||p())},constructor:function(e){Object.keys(e).forEach((function(e){u.indexOf(e)<0&&i('invalid regl constructor argument "'+e+'". must be one of '+u)}))},type:function(e,t,r){s(e,t)||i("invalid parameter type"+a(r)+". expected "+t+", got "+typeof e)},commandType:b,isTypedArray:function(t,r){e(t)||i("invalid parameter type"+a(r)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||i("invalid parameter type, ("+e+")"+a(t)+". must be a nonnegative integer")},oneOf:c,shaderError:function(e,t,n,i,a){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(t),c=i===e.FRAGMENT_SHADER?"fragment":"vertex";b(n,"string",c+" shader source must be a string",a);var u=v(n,a),l=function(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var r=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);r?t.push(new h(0|r[1],0|r[2],r[3].trim())):e.length>0&&t.push(new h("unknown",0,e))}})),t}(s);(function(e,t){t.forEach((function(t){var r=e[t.file];if(r){var n=r.index[t.line];if(n)return n.errors.push(t),void(r.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))})(u,l),Object.keys(u).forEach((function(e){var t=u[e];if(t.hasErrors){var n=[""],i=[""];o("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){o(f(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(e.line+r,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(n){var i=n.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];i=a[2],"assign"===s&&(s="="),t=Math.max(e.line.indexOf(s,t),0)}else t=0;o(f("| ",6)),o(f("^^^",t+3)+r,"font-weight:bold"),o(f("| ",6)),o(i+r,"font-weight:bold")})),o(f("| ",6)+r)}else o(f(e.number,4)+"|  "),o(e.line+r,"color:red")})),"undefined"==typeof document||window.chrome?console.log(n.join("")):(i[0]=n.join("%c"),console.log.apply(console,i))}function o(e,t){n.push(e),i.push(t||"")}})),o.raise("Error compiling "+c+" shader, "+u[0].name)}},linkError:function(e,t,n,i,a){if(!e.getProgramParameter(t,e.LINK_STATUS)){var s=e.getProgramInfoLog(t),c=v(n,a),u='Error linking program with vertex shader, "'+v(i,a)[0].name+'", and fragment shader "'+c[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+"\n%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+r+s),o.raise(u)}},callSite:m,saveCommandRef:g,saveDrawInfo:function(e,t,r,n){function i(e){return e?n.id(e):0}function o(e,t){Object.keys(t).forEach((function(t){e[n.id(t)]=!0}))}g(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,r.static),o(s,r.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,r){e.texture?c(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):c(e.renderbuffer._renderbuffer.format,r,"unsupported renderbuffer format for attachment")},guessCommand:p,texture2D:function(e,t,r){var n,i=t.width,a=t.height,s=t.channels;o(i>0&&i<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),e.wrapS===E&&e.wrapT===E||o(R(i)&&R(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==a&&o(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(o(R(i)&&R(a),"texture must be a square power of 2 to support mipmapping"),o(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(r.extensions.indexOf("oes_texture_float_linear")<0&&o(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),o(!e.genMipmaps,"mipmap generation not supported with float textures"));var c=t.images;for(n=0;n<16;++n)if(c[n]){var u=i>>n,f=a>>n;o(t.mipmask&1<<n,"missing mipmap data");var l=c[n];if(o(l.width===u&&l.height===f,"invalid shape for mip images"),o(l.format===t.format&&l.internalformat===t.internalformat&&l.type===t.type,"incompatible type for mip image"),l.compressed);else if(l.data){var d=Math.ceil(S(l.type,s)*u/l.unpackAlignment)*l.unpackAlignment;o(l.data.byteLength===d*f,"invalid data for image, buffer size is inconsistent with image format")}}else e.genMipmaps||o(0==(t.mipmask&1<<n),"extra mipmap data");t.compressed&&o(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,r,n){var i=e.width,a=e.height,s=e.channels;o(i>0&&i<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),o(i===a,"cube map must be square"),o(t.wrapS===E&&t.wrapT===E,"wrap mode not supported by cube map");for(var c=0;c<r.length;++c){var u=r[c];o(u.width===i&&u.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(o(!u.compressed,"can not generate mipmap for compressed textures"),o(1===u.mipmask,"can not specify mipmaps and generate mipmaps"));for(var f=u.images,l=0;l<16;++l){var d=f[l];if(d){var h=i>>l,p=a>>l;o(u.mipmask&1<<l,"missing mipmap data"),o(d.width===h&&d.height===p,"invalid shape for mip images"),o(d.format===e.format&&d.internalformat===e.internalformat&&d.type===e.type,"incompatible type for mip image"),d.compressed||d.data&&o(d.data.byteLength===h*p*Math.max(S(d.type,s),d.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}}),O=0;function I(e,t){this.id=O++,this.type=e,this.data=t}function C(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function L(e){if(0===e.length)return[];var t=e.charAt(0),r=e.charAt(e.length-1);if(e.length>1&&t===r&&('"'===t||"'"===t))return['"'+C(e.substr(1,e.length-2))+'"'];var n=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(n)return L(e.substr(0,n.index)).concat(L(n[1])).concat(L(e.substr(n.index+n[0].length)));var i=e.split(".");if(1===i.length)return['"'+C(e)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(L(i[a]));return o}function M(e){return"["+L(e).join("][")+"]"}var D={DynamicVariable:I,define:function(e,t){return new I(e,M(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof I},unbox:function e(t,r){return"function"==typeof t?new I(0,t):"number"==typeof t||"boolean"==typeof t?new I(5,t):Array.isArray(t)?new I(6,t.map(((t,n)=>e(t,r+"["+n+"]")))):t instanceof I?t:void N(!1,"invalid option type in uniform "+r)},accessor:M},k={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},P="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function F(e,r,n){var i,o=document.createElement("canvas");function a(){var r=window.innerWidth,i=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();r=a.right-a.left,i=a.bottom-a.top}o.width=n*r,o.height=n*i,t(o.style,{width:r+"px",height:i+"px"})}return t(o.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(o),e===document.body&&(o.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}}}function j(e){return"string"==typeof e?e.split():(N(Array.isArray(e),"invalid extension array"),e)}function U(e){return"string"==typeof e?(N("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function B(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=t(n);return r}function G(e){var t,r;return t=(e>65535)<<4,t|=r=((e>>>=t)>255)<<3,t|=r=((e>>>=r)>15)<<2,(t|=r=((e>>>=r)>3)<<1)|(e>>>=r)>>1}function V(){var e=B(8,(function(){return[]}));function t(t){var r=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),n=e[G(r)>>2];return n.length>0?n.pop():new ArrayBuffer(r)}function r(t){e[G(t.byteLength)>>2].push(t)}return{alloc:t,free:r,allocType:function(e,r){var n=null;switch(e){case 5120:n=new Int8Array(t(r),0,r);break;case 5121:n=new Uint8Array(t(r),0,r);break;case 5122:n=new Int16Array(t(2*r),0,r);break;case 5123:n=new Uint16Array(t(2*r),0,r);break;case 5124:n=new Int32Array(t(4*r),0,r);break;case 5125:n=new Uint32Array(t(4*r),0,r);break;case 5126:n=new Float32Array(t(4*r),0,r);break;default:return null}return n.length!==r?n.subarray(0,r):n},freeType:function(e){r(e.buffer)}}}var z=V();z.zero=V();var H=3553,X=6408,W=5126,Y=36160;function Q(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var K=function(e){return Object.keys(e).map((function(t){return e[t]}))},q={shape:function(e){for(var t=[],r=e;r.length;r=r[0])t.push(r.length);return t},flatten:function(e,t,r,n){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=n||z.allocType(r,i);switch(t.length){case 0:break;case 1:!function(e,t,r){for(var n=0;n<t;++n)r[n]=e[n]}(e,t[0],a);break;case 2:!function(e,t,r,n){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<r;++s)n[i++]=a[s]}(e,t[0],t[1],a);break;case 3:$(e,t[0],t[1],t[2],a,0);break;default:Z(e,t,0,a,0)}return a}};function $(e,t,r,n,i,o){for(var a=o,s=0;s<t;++s)for(var c=e[s],u=0;u<r;++u)for(var f=c[u],l=0;l<n;++l)i[a++]=f[l]}function Z(e,t,r,n,i){for(var o=1,a=r+1;a<t.length;++a)o*=t[a];var s=t[r];if(t.length-r==4){var c=t[r+1],u=t[r+2],f=t[r+3];for(a=0;a<s;++a)$(e[a],c,u,f,n,i),i+=o}else for(a=0;a<s;++a)Z(e[a],t,r+1,n,i),i+=o}var J={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ee={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},te={dynamic:35048,stream:35040,static:35044},re=q.flatten,ne=q.shape,ie=35044,oe=35040,ae=5121,se=5126,ce=[];function ue(e){return 0|J[Object.prototype.toString.call(e)]}function fe(e,t){for(var r=0;r<t.length;++r)e[r]=t[r]}function le(e,t,r,n,i,o,a){for(var s=0,c=0;c<r;++c)for(var u=0;u<n;++u)e[s++]=t[i*c+o*u+a]}function de(t,r,n,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=ie,this.byteLength=0,this.dimension=1,this.dtype=ae,this.persistentData=null,n.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){l(this)};var c=[];function u(e,r,n){e.byteLength=r.byteLength,t.bufferData(e.type,r,n)}function f(t,r,n,i,o,a){var s,c;if(t.usage=n,Array.isArray(r)){if(t.dtype=i||se,r.length>0)if(Array.isArray(r[0])){s=ne(r);for(var f=1,l=1;l<s.length;++l)f*=s[l];t.dimension=f,u(t,c=re(r,s,t.dtype),n),a?t.persistentData=c:z.freeType(c)}else if("number"==typeof r[0]){t.dimension=o;var d=z.allocType(t.dtype,r.length);fe(d,r),u(t,d,n),a?t.persistentData=d:z.freeType(d)}else e(r[0])?(t.dimension=r[0].length,t.dtype=i||ue(r[0])||se,u(t,c=re(r,[r.length,r[0].length],t.dtype),n),a?t.persistentData=c:z.freeType(c)):N.raise("invalid buffer data")}else if(e(r))t.dtype=i||ue(r),t.dimension=o,u(t,r,n),a&&(t.persistentData=new Uint8Array(new Uint8Array(r.buffer)));else if(Q(r)){s=r.shape;var h=r.stride,p=r.offset,m=0,v=0,g=0,y=0;1===s.length?(m=s[0],v=1,g=h[0],y=0):2===s.length?(m=s[0],v=s[1],g=h[0],y=h[1]):N.raise("invalid shape"),t.dtype=i||ue(r.data)||se,t.dimension=v;var b=z.allocType(t.dtype,m*v);le(b,r.data,m,v,g,y,p),u(t,b,n),a?t.persistentData=b:z.freeType(b)}else r instanceof ArrayBuffer?(t.dtype=ae,t.dimension=o,u(t,r,n),a&&(t.persistentData=new Uint8Array(new Uint8Array(r)))):N.raise("invalid buffer data")}function l(e){r.bufferCount--,i(e);var n=e.buffer;N(n,"buffer must not be deleted already"),t.deleteBuffer(n),e.buffer=null,delete a[e.id]}return n.profile&&(r.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:function(i,o,c,u){r.bufferCount++;var d=new s(o);function h(r){var i=ie,o=null,a=0,s=0,c=1;return Array.isArray(r)||e(r)||Q(r)||r instanceof ArrayBuffer?o=r:"number"==typeof r?a=0|r:r&&(N.type(r,"object","buffer arguments must be an object, a number or an array"),"data"in r&&(N(null===o||Array.isArray(o)||e(o)||Q(o),"invalid data for buffer"),o=r.data),"usage"in r&&(N.parameter(r.usage,te,"invalid buffer usage"),i=te[r.usage]),"type"in r&&(N.parameter(r.type,ee,"invalid buffer type"),s=ee[r.type]),"dimension"in r&&(N.type(r.dimension,"number","invalid dimension"),c=0|r.dimension),"length"in r&&(N.nni(a,"buffer length must be a nonnegative integer"),a=0|r.length)),d.bind(),o?f(d,o,i,s,c,u):(a&&t.bufferData(d.type,a,i),d.dtype=s||ae,d.usage=i,d.dimension=c,d.byteLength=a),n.profile&&(d.stats.size=d.byteLength*ce[d.dtype]),h}function p(e,r){N(r+e.byteLength<=d.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+r+" to a buffer of size "+d.byteLength),t.bufferSubData(d.type,r,e)}return a[d.id]=d,c||h(i),h._reglType="buffer",h._buffer=d,h.subdata=function(t,r){var n,i=0|(r||0);if(d.bind(),e(t)||t instanceof ArrayBuffer)p(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=z.allocType(d.dtype,t.length);fe(o,t),p(o,i),z.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){n=ne(t);var a=re(t,n,d.dtype);p(a,i),z.freeType(a)}else N.raise("invalid buffer data")}else if(Q(t)){n=t.shape;var s=t.stride,c=0,u=0,f=0,l=0;1===n.length?(c=n[0],u=1,f=s[0],l=0):2===n.length?(c=n[0],u=n[1],f=s[0],l=s[1]):N.raise("invalid shape");var m=Array.isArray(t.data)?d.dtype:ue(t.data),v=z.allocType(m,c*u);le(v,t.data,c,u,f,l,t.offset),p(v,i),z.freeType(v)}else N.raise("invalid data for buffer subdata");return h},n.profile&&(h.stats=d.stats),h.destroy=function(){l(d)},h},createStream:function(e,t){var r=c.pop();return r||(r=new s(e)),r.bind(),f(r,t,oe,0,1,!1),r},destroyStream:function(e){c.push(e)},clear:function(){K(a).forEach(l),c.forEach(l)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){K(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))},_initBuffer:f}}ce[5120]=1,ce[5122]=2,ce[5124]=4,ce[5121]=1,ce[5123]=2,ce[5125]=4,ce[5126]=4;var he={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},pe=0,me=1,ve=4,ge=5120,ye=5121,be=5122,Ee=5123,_e=5124,Ae=5125,we=34963,Te=35040,xe=35044;function Se(t,r,n,i){var o={},a=0,s={uint8:ye,uint16:Ee};function c(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=ve,this.vertCount=0,this.type=0}r.oes_element_index_uint&&(s.uint32=Ae),c.prototype.bind=function(){this.buffer.bind()};var u=[];function f(i,o,a,s,c,u,f){var l;if(i.buffer.bind(),o){var d=f;f||e(o)&&(!Q(o)||e(o.data))||(d=r.oes_element_index_uint?Ae:Ee),n._initBuffer(i.buffer,o,a,d,3)}else t.bufferData(we,u,a),i.buffer.dtype=l||ye,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=u;if(l=f,!f){switch(i.buffer.dtype){case ye:case ge:l=ye;break;case Ee:case be:l=Ee;break;case Ae:case _e:l=Ae;break;default:N.raise("unsupported type for element array")}i.buffer.dtype=l}i.type=l,N(l!==Ae||!!r.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var h=c;h<0&&(h=i.buffer.byteLength,l===Ee?h>>=1:l===Ae&&(h>>=2)),i.vertCount=h;var p=s;if(s<0){p=ve;var m=i.buffer.dimension;1===m&&(p=pe),2===m&&(p=me),3===m&&(p=ve)}i.primType=p}function l(e){i.elementsCount--,N(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,r){var o=n.create(null,we,!0),a=new c(o._buffer);function u(t){if(t)if("number"==typeof t)o(t),a.primType=ve,a.vertCount=0|t,a.type=ye;else{var r=null,n=xe,i=-1,c=-1,l=0,d=0;Array.isArray(t)||e(t)||Q(t)?r=t:(N.type(t,"object","invalid arguments for elements"),"data"in t&&(r=t.data,N(Array.isArray(r)||e(r)||Q(r),"invalid data for element buffer")),"usage"in t&&(N.parameter(t.usage,te,"invalid element buffer usage"),n=te[t.usage]),"primitive"in t&&(N.parameter(t.primitive,he,"invalid element buffer primitive"),i=he[t.primitive]),"count"in t&&(N("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),c=0|t.count),"type"in t&&(N.parameter(t.type,s,"invalid buffer type"),d=s[t.type]),"length"in t?l=0|t.length:(l=c,d===Ee||d===be?l*=2:d!==Ae&&d!==_e||(l*=4))),f(a,r,n,i,c,l,d)}else o(),a.primType=ve,a.vertCount=0,a.type=ye;return u}return i.elementsCount++,u(t),u._reglType="elements",u._elements=a,u.subdata=function(e,t){return o.subdata(e,t),u},u.destroy=function(){l(a)},u},createStream:function(e){var t=u.pop();return t||(t=new c(n.create(null,we,!0,!1)._buffer)),f(t,e,Te,-1,-1,0,0),t},destroyStream:function(e){u.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof c?e._elements:null},clear:function(){K(o).forEach(l)}}}var Re=new Float32Array(1),Ne=new Uint32Array(Re.buffer),Oe=5123;function Ie(e){for(var t=z.allocType(Oe,e.length),r=0;r<e.length;++r)if(isNaN(e[r]))t[r]=65535;else if(e[r]===1/0)t[r]=31744;else if(e[r]===-1/0)t[r]=64512;else{Re[0]=e[r];var n=Ne[0],i=n>>>31<<15,o=(n<<1>>>24)-127,a=n>>13&1023;if(o<-24)t[r]=i;else if(o<-14){var s=-14-o;t[r]=i+(a+1024>>s)}else t[r]=o>15?i+31744:i+(o+15<<10)+a}return t}function Ce(t){return Array.isArray(t)||e(t)}var Le=function(e){return!(e&e-1||!e)},Me=34467,De=3553,ke=34067,Pe=34069,Fe=6408,je=6406,Ue=6407,Be=6409,Ge=6410,Ve=32854,ze=32855,He=36194,Xe=32819,We=32820,Ye=33635,Qe=34042,Ke=6402,qe=34041,$e=35904,Ze=35906,Je=36193,et=33776,tt=33777,rt=33778,nt=33779,it=35986,ot=35987,at=34798,st=35840,ct=35841,ut=35842,ft=35843,lt=36196,dt=5121,ht=5123,pt=5125,mt=5126,vt=10242,gt=10243,yt=10497,bt=33071,Et=33648,_t=10240,At=10241,wt=9728,Tt=9729,xt=9984,St=9985,Rt=9986,Nt=9987,Ot=33170,It=4352,Ct=4353,Lt=4354,Mt=34046,Dt=3317,kt=37440,Pt=37441,Ft=37443,jt=37444,Ut=33984,Bt=[xt,Rt,St,Nt],Gt=[0,Be,Ge,Ue,Fe],Vt={};function zt(e){return"[object "+e+"]"}Vt[Be]=Vt[je]=Vt[Ke]=1,Vt[qe]=Vt[Ge]=2,Vt[Ue]=Vt[$e]=3,Vt[Fe]=Vt[Ze]=4;var Ht=zt("HTMLCanvasElement"),Xt=zt("OffscreenCanvas"),Wt=zt("CanvasRenderingContext2D"),Yt=zt("ImageBitmap"),Qt=zt("HTMLImageElement"),Kt=zt("HTMLVideoElement"),qt=Object.keys(J).concat([Ht,Xt,Wt,Yt,Qt,Kt]),$t=[];$t[dt]=1,$t[mt]=4,$t[Je]=2,$t[ht]=2,$t[pt]=4;var Zt=[];function Jt(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function er(e){return!!Array.isArray(e)&&!(0===e.length||!Ce(e[0]))}function tr(e){return Object.prototype.toString.call(e)}function rr(e){return tr(e)===Ht}function nr(e){return tr(e)===Xt}function ir(e){if(!e)return!1;var t=tr(e);return qt.indexOf(t)>=0||Jt(e)||er(e)||Q(e)}function or(e){return 0|J[Object.prototype.toString.call(e)]}function ar(e,t){return z.allocType(e.type===Je?mt:e.type,t)}function sr(e,t){e.type===Je?(e.data=Ie(t),z.freeType(t)):e.data=t}function cr(e,t,r,n,i,o){var a;if(a=void 0!==Zt[e]?Zt[e]:Vt[e]*$t[t],o&&(a*=6),i){for(var s=0,c=r;c>=1;)s+=a*c*c,c/=2;return s}return a*r*n}function ur(r,n,i,o,a,s,c){var u={"don't care":It,"dont care":It,nice:Lt,fast:Ct},f={repeat:yt,clamp:bt,mirror:Et},l={nearest:wt,linear:Tt},d=t({mipmap:Nt,"nearest mipmap nearest":xt,"linear mipmap nearest":St,"nearest mipmap linear":Rt,"linear mipmap linear":Nt},l),h={none:0,browser:jt},p={uint8:dt,rgba4:Xe,rgb565:Ye,"rgb5 a1":We},m={alpha:je,luminance:Be,"luminance alpha":Ge,rgb:Ue,rgba:Fe,rgba4:Ve,"rgb5 a1":ze,rgb565:He},v={};n.ext_srgb&&(m.srgb=$e,m.srgba=Ze),n.oes_texture_float&&(p.float32=p.float=mt),n.oes_texture_half_float&&(p.float16=p["half float"]=Je),n.webgl_depth_texture&&(t(m,{depth:Ke,"depth stencil":qe}),t(p,{uint16:ht,uint32:pt,"depth stencil":Qe})),n.webgl_compressed_texture_s3tc&&t(v,{"rgb s3tc dxt1":et,"rgba s3tc dxt1":tt,"rgba s3tc dxt3":rt,"rgba s3tc dxt5":nt}),n.webgl_compressed_texture_atc&&t(v,{"rgb atc":it,"rgba atc explicit alpha":ot,"rgba atc interpolated alpha":at}),n.webgl_compressed_texture_pvrtc&&t(v,{"rgb pvrtc 4bppv1":st,"rgb pvrtc 2bppv1":ct,"rgba pvrtc 4bppv1":ut,"rgba pvrtc 2bppv1":ft}),n.webgl_compressed_texture_etc1&&(v["rgb etc1"]=lt);var g=Array.prototype.slice.call(r.getParameter(Me));Object.keys(v).forEach((function(e){var t=v[e];g.indexOf(t)>=0&&(m[e]=t)}));var y=Object.keys(m);i.textureFormats=y;var b=[];Object.keys(m).forEach((function(e){var t=m[e];b[t]=e}));var E=[];Object.keys(p).forEach((function(e){var t=p[e];E[t]=e}));var _=[];Object.keys(l).forEach((function(e){var t=l[e];_[t]=e}));var A=[];Object.keys(d).forEach((function(e){var t=d[e];A[t]=e}));var w=[];Object.keys(f).forEach((function(e){var t=f[e];w[t]=e}));var T=y.reduce((function(e,t){var r=m[t];return r===Be||r===je||r===Be||r===Ge||r===Ke||r===qe||n.ext_srgb&&(r===$e||r===Ze)?e[r]=r:r===ze||t.indexOf("rgba")>=0?e[r]=Fe:e[r]=Ue,e}),{});function x(){this.internalformat=Fe,this.format=Fe,this.type=dt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=jt,this.width=0,this.height=0,this.channels=0}function S(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function R(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(N.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(N.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(N.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(N.parameter(t.colorSpace,h,"invalid colorSpace"),e.colorSpace=h[t.colorSpace]),"type"in t){var r=t.type;N(n.oes_texture_float||!("float"===r||"float32"===r),"you must enable the OES_texture_float extension in order to use floating point textures."),N(n.oes_texture_half_float||!("half float"===r||"float16"===r),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),N(n.webgl_depth_texture||!("uint16"===r||"uint32"===r||"depth stencil"===r),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),N.parameter(r,p,"invalid texture type"),e.type=p[r]}var o=e.width,a=e.height,s=e.channels,c=!1;"shape"in t?(N(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],a=t.shape[1],3===t.shape.length&&(s=t.shape[2],N(s>0&&s<=4,"invalid number of channels"),c=!0),N(o>=0&&o<=i.maxTextureSize,"invalid width"),N(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=a=t.radius,N(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,N(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,N(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in t&&(s=t.channels,N(s>0&&s<=4,"invalid number of channels"),c=!0)),e.width=0|o,e.height=0|a,e.channels=0|s;var u=!1;if("format"in t){var f=t.format;N(n.webgl_depth_texture||!("depth"===f||"depth stencil"===f),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),N.parameter(f,m,"invalid texture format");var l=e.internalformat=m[f];e.format=T[l],f in p&&("type"in t||(e.type=p[f])),f in v&&(e.compressed=!0),u=!0}!c&&u?e.channels=Vt[e.format]:c&&!u?e.channels!==Gt[e.format]&&(e.format=e.internalformat=Gt[e.channels]):u&&c&&N(e.channels===Vt[e.format],"number of channels inconsistent with specified format")}}function O(e){r.pixelStorei(kt,e.flipY),r.pixelStorei(Pt,e.premultiplyAlpha),r.pixelStorei(Ft,e.colorSpace),r.pixelStorei(Dt,e.unpackAlignment)}function I(){x.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function C(t,r){var n=null;if(ir(r)?n=r:r&&(N.type(r,"object","invalid pixel data type"),R(t,r),"x"in r&&(t.xOffset=0|r.x),"y"in r&&(t.yOffset=0|r.y),ir(r.data)&&(n=r.data)),N(!t.compressed||n instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),r.copy){N(!n,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,N(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=o&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(n){if(e(n))t.channels=t.channels||4,t.data=n,"type"in r||t.type!==dt||(t.type=or(n));else if(Jt(n))t.channels=t.channels||4,function(e,t){var r=t.length;switch(e.type){case dt:case ht:case pt:case mt:var n=z.allocType(e.type,r);n.set(t),e.data=n;break;case Je:e.data=Ie(t);break;default:N.raise("unsupported texture type, must specify a typed array")}}(t,n),t.alignment=1,t.needsFree=!0;else if(Q(n)){var c=n.data;Array.isArray(c)||t.type!==dt||(t.type=or(c));var u,f,l,d,h,p,m=n.shape,v=n.stride;3===m.length?(l=m[2],p=v[2]):(N(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),l=1,p=1),u=m[0],f=m[1],d=v[0],h=v[1],t.alignment=1,t.width=u,t.height=f,t.channels=l,t.format=t.internalformat=Gt[l],t.needsFree=!0,function(e,t,r,n,i,o){for(var a=e.width,s=e.height,c=e.channels,u=ar(e,a*s*c),f=0,l=0;l<s;++l)for(var d=0;d<a;++d)for(var h=0;h<c;++h)u[f++]=t[r*d+n*l+i*h+o];sr(e,u)}(t,c,d,h,p,n.offset)}else if(rr(n)||nr(n)||function(e){return tr(e)===Wt}(n))rr(n)||nr(n)?t.element=n:t.element=n.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return tr(e)===Yt}(n))t.element=n,t.width=n.width,t.height=n.height,t.channels=4;else if(function(e){return tr(e)===Qt}(n))t.element=n,t.width=n.naturalWidth,t.height=n.naturalHeight,t.channels=4;else if(function(e){return tr(e)===Kt}(n))t.element=n,t.width=n.videoWidth,t.height=n.videoHeight,t.channels=4;else if(er(n)){var g=t.width||n[0].length,y=t.height||n.length,b=t.channels;b=Ce(n[0][0])?b||n[0][0].length:b||1;for(var E=q.shape(n),_=1,A=0;A<E.length;++A)_*=E[A];var w=ar(t,_);q.flatten(n,E,"",w),sr(t,w),t.alignment=1,t.width=g,t.height=y,t.channels=b,t.format=t.internalformat=Gt[b],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===mt?N(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===Je&&N(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function L(e,t,n){var i=e.element,a=e.data,s=e.internalformat,c=e.format,u=e.type,f=e.width,l=e.height;O(e),i?r.texImage2D(t,n,c,c,u,i):e.compressed?r.compressedTexImage2D(t,n,s,f,l,0,a):e.needsCopy?(o(),r.copyTexImage2D(t,n,c,e.xOffset,e.yOffset,f,l,0)):r.texImage2D(t,n,c,f,l,0,c,u,a||null)}function M(e,t,n,i,a){var s=e.element,c=e.data,u=e.internalformat,f=e.format,l=e.type,d=e.width,h=e.height;O(e),s?r.texSubImage2D(t,a,n,i,f,l,s):e.compressed?r.compressedTexSubImage2D(t,a,n,i,u,d,h,c):e.needsCopy?(o(),r.copyTexSubImage2D(t,a,n,i,e.xOffset,e.yOffset,d,h)):r.texSubImage2D(t,a,n,i,d,h,f,l,c)}var D=[];function k(){return D.pop()||new I}function P(e){e.needsFree&&z.freeType(e.data),I.call(e),D.push(e)}function F(){x.call(this),this.genMipmaps=!1,this.mipmapHint=It,this.mipmask=0,this.images=Array(16)}function j(e,t,r){var n=e.images[0]=k();e.mipmask=1,n.width=e.width=t,n.height=e.height=r,n.channels=e.channels=4}function U(e,t){var r=null;if(ir(t))S(r=e.images[0]=k(),e),C(r,t),e.mipmask=1;else if(R(e,t),Array.isArray(t.mipmap))for(var n=t.mipmap,i=0;i<n.length;++i)S(r=e.images[i]=k(),e),r.width>>=i,r.height>>=i,C(r,n[i]),e.mipmask|=1<<i;else S(r=e.images[0]=k(),e),C(r,t),e.mipmask=1;S(e,e.images[0]),!e.compressed||e.internalformat!==et&&e.internalformat!==tt&&e.internalformat!==rt&&e.internalformat!==nt||N(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function B(e,t){for(var r=e.images,n=0;n<r.length;++n){if(!r[n])return;L(r[n],t,n)}}var G=[];function V(){var e=G.pop()||new F;x.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function H(e){for(var t=e.images,r=0;r<t.length;++r)t[r]&&P(t[r]),t[r]=null;G.push(e)}function X(){this.minFilter=wt,this.magFilter=wt,this.wrapS=bt,this.wrapT=bt,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=It}function W(e,t){if("min"in t){var r=t.min;N.parameter(r,d),e.minFilter=d[r],Bt.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var n=t.mag;N.parameter(n,l),e.magFilter=l[n]}var o=e.wrapS,a=e.wrapT;if("wrap"in t){var s=t.wrap;"string"==typeof s?(N.parameter(s,f),o=a=f[s]):Array.isArray(s)&&(N.parameter(s[0],f),N.parameter(s[1],f),o=f[s[0]],a=f[s[1]])}else{if("wrapS"in t){var c=t.wrapS;N.parameter(c,f),o=f[c]}if("wrapT"in t){var h=t.wrapT;N.parameter(h,f),a=f[h]}}if(e.wrapS=o,e.wrapT=a,"anisotropic"in t){var p=t.anisotropic;N("number"==typeof p&&p>=1&&p<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var m=!1;switch(typeof t.mipmap){case"string":N.parameter(t.mipmap,u,"invalid mipmap hint"),e.mipmapHint=u[t.mipmap],e.genMipmaps=!0,m=!0;break;case"boolean":m=e.genMipmaps=t.mipmap;break;case"object":N(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,m=!0;break;default:N.raise("invalid mipmap type")}m&&!("min"in t)&&(e.minFilter=xt)}}function Y(e,t){r.texParameteri(t,At,e.minFilter),r.texParameteri(t,_t,e.magFilter),r.texParameteri(t,vt,e.wrapS),r.texParameteri(t,gt,e.wrapT),n.ext_texture_filter_anisotropic&&r.texParameteri(t,Mt,e.anisotropic),e.genMipmaps&&(r.hint(Ot,e.mipmapHint),r.generateMipmap(t))}var $=0,Z={},J=i.maxTextureUnits,ee=Array(J).map((function(){return null}));function te(e){x.call(this),this.mipmask=0,this.internalformat=Fe,this.id=$++,this.refCount=1,this.target=e,this.texture=r.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new X,c.profile&&(this.stats={size:0})}function re(e){r.activeTexture(Ut),r.bindTexture(e.target,e.texture)}function ne(){var e=ee[0];e?r.bindTexture(e.target,e.texture):r.bindTexture(De,null)}function ie(e){var t=e.texture;N(t,"must not double destroy texture");var n=e.unit,i=e.target;n>=0&&(r.activeTexture(Ut+n),r.bindTexture(i,null),ee[n]=null),r.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete Z[e.id],s.textureCount--}return t(te.prototype,{bind:function(){var e=this;e.bindCount+=1;var t=e.unit;if(t<0){for(var n=0;n<J;++n){var i=ee[n];if(i){if(i.bindCount>0)continue;i.unit=-1}ee[n]=e,t=n;break}t>=J&&N.raise("insufficient number of texture units"),c.profile&&s.maxTextureUnits<t+1&&(s.maxTextureUnits=t+1),e.unit=t,r.activeTexture(Ut+t),r.bindTexture(e.target,e.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ie(this)}}),c.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(Z).forEach((function(t){e+=Z[t].stats.size})),e}),{create2D:function(e,t){var n=new te(De);function o(e,t){var r=n.texInfo;X.call(r);var a=V();return"number"==typeof e?j(a,0|e,"number"==typeof t?0|t:0|e):e?(N.type(e,"object","invalid arguments to regl.texture"),W(r,e),U(a,e)):j(a,1,1),r.genMipmaps&&(a.mipmask=(a.width<<1)-1),n.mipmask=a.mipmask,S(n,a),N.texture2D(r,a,i),n.internalformat=a.internalformat,o.width=a.width,o.height=a.height,re(n),B(a,De),Y(r,De),ne(),H(a),c.profile&&(n.stats.size=cr(n.internalformat,n.type,a.width,a.height,r.genMipmaps,!1)),o.format=b[n.internalformat],o.type=E[n.type],o.mag=_[r.magFilter],o.min=A[r.minFilter],o.wrapS=w[r.wrapS],o.wrapT=w[r.wrapT],o}return Z[n.id]=n,s.textureCount++,o(e,t),o.subimage=function(e,t,r,i){N(!!e,"must specify image data");var a=0|t,s=0|r,c=0|i,u=k();return S(u,n),u.width=0,u.height=0,C(u,e),u.width=u.width||(n.width>>c)-a,u.height=u.height||(n.height>>c)-s,N(n.type===u.type&&n.format===u.format&&n.internalformat===u.internalformat,"incompatible format for texture.subimage"),N(a>=0&&s>=0&&a+u.width<=n.width&&s+u.height<=n.height,"texture.subimage write out of bounds"),N(n.mipmask&1<<c,"missing mipmap data"),N(u.data||u.element||u.needsCopy,"missing image data"),re(n),M(u,De,a,s,c),ne(),P(u),o},o.resize=function(e,t){var i=0|e,a=0|t||i;if(i===n.width&&a===n.height)return o;o.width=n.width=i,o.height=n.height=a,re(n);for(var s=0;n.mipmask>>s;++s){var u=i>>s,f=a>>s;if(!u||!f)break;r.texImage2D(De,s,n.format,u,f,0,n.format,n.type,null)}return ne(),c.profile&&(n.stats.size=cr(n.internalformat,n.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=n,c.profile&&(o.stats=n.stats),o.destroy=function(){n.decRef()},o},createCube:function(e,t,n,o,a,u){var f=new te(ke);Z[f.id]=f,s.cubeCount++;var l=new Array(6);function d(e,t,r,n,o,a){var s,u=f.texInfo;for(X.call(u),s=0;s<6;++s)l[s]=V();if("number"!=typeof e&&e)if("object"==typeof e)if(t)U(l[0],e),U(l[1],t),U(l[2],r),U(l[3],n),U(l[4],o),U(l[5],a);else if(W(u,e),R(f,e),"faces"in e){var h=e.faces;for(N(Array.isArray(h)&&6===h.length,"cube faces must be a length 6 array"),s=0;s<6;++s)N("object"==typeof h[s]&&!!h[s],"invalid input for cube map face"),S(l[s],f),U(l[s],h[s])}else for(s=0;s<6;++s)U(l[s],e);else N.raise("invalid arguments to cube map");else{var p=0|e||1;for(s=0;s<6;++s)j(l[s],p,p)}for(S(f,l[0]),i.npotTextureCube||N(Le(f.width)&&Le(f.height),"your browser does not support non power or two texture dimensions"),u.genMipmaps?f.mipmask=(l[0].width<<1)-1:f.mipmask=l[0].mipmask,N.textureCube(f,u,l,i),f.internalformat=l[0].internalformat,d.width=l[0].width,d.height=l[0].height,re(f),s=0;s<6;++s)B(l[s],Pe+s);for(Y(u,ke),ne(),c.profile&&(f.stats.size=cr(f.internalformat,f.type,d.width,d.height,u.genMipmaps,!0)),d.format=b[f.internalformat],d.type=E[f.type],d.mag=_[u.magFilter],d.min=A[u.minFilter],d.wrapS=w[u.wrapS],d.wrapT=w[u.wrapT],s=0;s<6;++s)H(l[s]);return d}return d(e,t,n,o,a,u),d.subimage=function(e,t,r,n,i){N(!!t,"must specify image data"),N("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|r,a=0|n,s=0|i,c=k();return S(c,f),c.width=0,c.height=0,C(c,t),c.width=c.width||(f.width>>s)-o,c.height=c.height||(f.height>>s)-a,N(f.type===c.type&&f.format===c.format&&f.internalformat===c.internalformat,"incompatible format for texture.subimage"),N(o>=0&&a>=0&&o+c.width<=f.width&&a+c.height<=f.height,"texture.subimage write out of bounds"),N(f.mipmask&1<<s,"missing mipmap data"),N(c.data||c.element||c.needsCopy,"missing image data"),re(f),M(c,Pe+e,o,a,s),ne(),P(c),d},d.resize=function(e){var t=0|e;if(t!==f.width){d.width=f.width=t,d.height=f.height=t,re(f);for(var n=0;n<6;++n)for(var i=0;f.mipmask>>i;++i)r.texImage2D(Pe+n,i,f.format,t>>i,t>>i,0,f.format,f.type,null);return ne(),c.profile&&(f.stats.size=cr(f.internalformat,f.type,d.width,d.height,!1,!0)),d}},d._reglType="textureCube",d._texture=f,c.profile&&(d.stats=f.stats),d.destroy=function(){f.decRef()},d},clear:function(){for(var e=0;e<J;++e)r.activeTexture(Ut+e),r.bindTexture(De,null),ee[e]=null;K(Z).forEach(ie),s.cubeCount=0,s.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<J;++e){var t=ee[e];t&&(t.bindCount=0,t.unit=-1,ee[e]=null)}K(Z).forEach((function(e){e.texture=r.createTexture(),r.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===De)r.texImage2D(De,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var n=0;n<6;++n)r.texImage2D(Pe+n,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);Y(e.texInfo,e.target)}))},refresh:function(){for(var e=0;e<J;++e){var t=ee[e];t&&(t.bindCount=0,t.unit=-1,ee[e]=null),r.activeTexture(Ut+e),r.bindTexture(De,null),r.bindTexture(ke,null)}}}}Zt[Ve]=2,Zt[ze]=2,Zt[He]=2,Zt[qe]=4,Zt[et]=.5,Zt[tt]=.5,Zt[rt]=1,Zt[nt]=1,Zt[it]=.5,Zt[ot]=1,Zt[at]=1,Zt[st]=.5,Zt[ct]=.25,Zt[ut]=.5,Zt[ft]=.25,Zt[lt]=.5;var fr=36161,lr=32854,dr=[];function hr(e,t,r){return dr[e]*t*r}dr[lr]=2,dr[32855]=2,dr[36194]=2,dr[33189]=2,dr[36168]=1,dr[34041]=4,dr[35907]=4,dr[34836]=16,dr[34842]=8,dr[34843]=6;var pr=36160,mr=36161,vr=3553,gr=34069,yr=36064,br=36096,Er=36128,_r=33306,Ar=36053,wr=6402,Tr=[6407,6408],xr=[];xr[6408]=4,xr[6407]=3;var Sr=[];Sr[5121]=1,Sr[5126]=4,Sr[36193]=2;var Rr=33189,Nr=36168,Or=34041,Ir=[32854,32855,36194,35907,34842,34843,34836],Cr={};Cr[Ar]="complete",Cr[36054]="incomplete attachment",Cr[36057]="incomplete dimensions",Cr[36055]="incomplete, missing attachment",Cr[36061]="unsupported";var Lr=5126,Mr=34962;function Dr(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Lr,this.offset=0,this.stride=0,this.divisor=0}function kr(t,r,n,i,o){for(var a=n.maxAttributes,s=new Array(a),c=0;c<a;++c)s[c]=new Dr;var u=0,f={},l={Record:Dr,scope:{},state:s,currentVAO:null,targetVAO:null,restore:d()?function(){d()&&K(f).forEach((function(e){e.refresh()}))}:function(){},createVAO:function(t){var n=new p;function s(t){N(Array.isArray(t),"arguments to vertex array constructor must be an array"),N(t.length<a,"too many attributes"),N(t.length>0,"must specify at least one attribute");var i={},c=n.attributes;c.length=t.length;for(var u=0;u<t.length;++u){var f,l=t[u],d=c[u]=new Dr,h=l.data||l;Array.isArray(h)||e(h)||Q(h)?(n.buffers[u]&&(f=n.buffers[u],e(h)&&f._buffer.byteLength>=h.byteLength?f.subdata(h):(f.destroy(),n.buffers[u]=null)),n.buffers[u]||(f=n.buffers[u]=o.create(l,Mr,!1,!0)),d.buffer=o.getBuffer(f),d.size=0|d.buffer.dimension,d.normalized=!1,d.type=d.buffer.dtype,d.offset=0,d.stride=0,d.divisor=0,d.state=1,i[u]=1):o.getBuffer(l)?(d.buffer=o.getBuffer(l),d.size=0|d.buffer.dimension,d.normalized=!1,d.type=d.buffer.dtype,d.offset=0,d.stride=0,d.divisor=0,d.state=1):o.getBuffer(l.buffer)?(d.buffer=o.getBuffer(l.buffer),d.size=0|(+l.size||d.buffer.dimension),d.normalized=!!l.normalized||!1,"type"in l?(N.parameter(l.type,ee,"invalid buffer type"),d.type=ee[l.type]):d.type=d.buffer.dtype,d.offset=0|(l.offset||0),d.stride=0|(l.stride||0),d.divisor=0|(l.divisor||0),d.state=1,N(d.size>=1&&d.size<=4,"size must be between 1 and 4"),N(d.offset>=0,"invalid offset"),N(d.stride>=0&&d.stride<=255,"stride must be between 0 and 255"),N(d.divisor>=0,"divisor must be positive"),N(!d.divisor||!!r.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in l?(N(u>0,"first attribute must not be a constant"),d.x=+l.x||0,d.y=+l.y||0,d.z=+l.z||0,d.w=+l.w||0,d.state=2):N(!1,"invalid attribute spec for location "+u)}for(var p=0;p<n.buffers.length;++p)!i[p]&&n.buffers[p]&&(n.buffers[p].destroy(),n.buffers[p]=null);return n.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var e=0;e<n.buffers.length;++e)n.buffers[e]&&n.buffers[e].destroy();n.buffers.length=0,n.destroy()},s._vao=n,s._reglType="vao",s(t)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(e){for(var r=0;r<s.length;++r){var n=s[r];n.buffer===e&&(t.disableVertexAttribArray(r),n.buffer=null)}},setVAO:d()?function(e){if(e!==l.currentVAO){var t=d();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),l.currentVAO=e}}:function(e){if(e!==l.currentVAO){if(e)e.bindAttrs();else for(var r=h(),n=0;n<s.length;++n){var i=s[n];i.buffer?(t.enableVertexAttribArray(n),t.vertexAttribPointer(n,i.size,i.type,i.normalized,i.stride,i.offfset),r&&i.divisor&&r.vertexAttribDivisorANGLE(n,i.divisor)):(t.disableVertexAttribArray(n),t.vertexAttrib4f(n,i.x,i.y,i.z,i.w))}l.currentVAO=e}},clear:d()?function(){K(f).forEach((function(e){e.destroy()}))}:function(){}};function d(){return r.oes_vertex_array_object}function h(){return r.angle_instanced_arrays}function p(){this.id=++u,this.attributes=[];var e=d();this.vao=e?e.createVertexArrayOES():null,f[this.id]=this,this.buffers=[]}return p.prototype.bindAttrs=function(){for(var e=h(),r=this.attributes,n=0;n<r.length;++n){var i=r[n];i.buffer?(t.enableVertexAttribArray(n),t.bindBuffer(Mr,i.buffer.buffer),t.vertexAttribPointer(n,i.size,i.type,i.normalized,i.stride,i.offset),e&&i.divisor&&e.vertexAttribDivisorANGLE(n,i.divisor)):(t.disableVertexAttribArray(n),t.vertexAttrib4f(n,i.x,i.y,i.z,i.w))}for(var o=r.length;o<a;++o)t.disableVertexAttribArray(o)},p.prototype.refresh=function(){var e=d();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),l.currentVAO=this)},p.prototype.destroy=function(){if(this.vao){var e=d();this===l.currentVAO&&(l.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}f[this.id]&&(delete f[this.id],i.vaoCount-=1)},l}var Pr=35632,Fr=35633,jr=35718,Ur=35721;var Br=6408,Gr=5121,Vr=3333,zr=5126;function Hr(t,r,n,i,o,a,s){function c(c){var u;null===r.next?(N(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),u=Gr):(N(null!==r.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),u=r.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(N(u===Gr||u===zr,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),u===zr&&N(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):N(u===Gr,"Reading from a framebuffer is only allowed for the type 'uint8'"));var f=0,l=0,d=i.framebufferWidth,h=i.framebufferHeight,p=null;e(c)?p=c:c&&(N.type(c,"object","invalid arguments to regl.read()"),f=0|c.x,l=0|c.y,N(f>=0&&f<i.framebufferWidth,"invalid x offset for regl.read"),N(l>=0&&l<i.framebufferHeight,"invalid y offset for regl.read"),d=0|(c.width||i.framebufferWidth-f),h=0|(c.height||i.framebufferHeight-l),p=c.data||null),p&&(u===Gr?N(p instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):u===zr&&N(p instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),N(d>0&&d+f<=i.framebufferWidth,"invalid width for read pixels"),N(h>0&&h+l<=i.framebufferHeight,"invalid height for read pixels"),n();var m=d*h*4;return p||(u===Gr?p=new Uint8Array(m):u===zr&&(p=p||new Float32Array(m))),N.isTypedArray(p,"data buffer for regl.read() must be a typedarray"),N(p.byteLength>=m,"data buffer for regl.read() too small"),t.pixelStorei(Vr,4),t.readPixels(f,l,d,h,Br,u,p),p}return function(e){return e&&"framebuffer"in e?function(e){var t;return r.setFBO({framebuffer:e.framebuffer},(function(){t=c(e)})),t}(e):c(e)}}function Xr(e){return Array.prototype.slice.call(e)}function Wr(e){return Xr(e).join("")}function Yr(){var e=0,r=[],n=[];function i(){var r=[];var n=[];return t((function(){r.push.apply(r,Xr(arguments))}),{def:function(){var t="v"+e++;return n.push(t),arguments.length>0&&(r.push(t,"="),r.push.apply(r,Xr(arguments)),r.push(";")),t},toString:function(){return Wr([n.length>0?"var "+n.join(",")+";":"",Wr(r)])}})}function o(){var e=i(),r=i(),n=e.toString,o=r.toString;function a(t,n){r(t,n,"=",e.def(t,n),";")}return t((function(){e.apply(e,Xr(arguments))}),{def:e.def,entry:e,exit:r,save:a,set:function(t,r,n){a(t,r),e(t,r,"=",n,";")},toString:function(){return n()+o()}})}var a=i(),s={};return{global:a,link:function(t){for(var i=0;i<n.length;++i)if(n[i]===t)return r[i];var o="g"+e++;return r.push(o),n.push(t),o},block:i,proc:function(e,r){var n=[];function i(){var e="a"+n.length;return n.push(e),e}r=r||0;for(var a=0;a<r;++a)i();var c=o(),u=c.toString;return s[e]=t(c,{arg:i,toString:function(){return Wr(["function(",n.join(),"){",u(),"}"])}})},scope:o,cond:function(){var e=Wr(arguments),r=o(),n=o(),i=r.toString,a=n.toString;return t(r,{then:function(){return r.apply(r,Xr(arguments)),this},else:function(){return n.apply(n,Xr(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),Wr(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',a,"return {"];Object.keys(s).forEach((function(t){e.push('"',t,'":',s[t].toString(),",")})),e.push("}");var t=Wr(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,r.concat(t)).apply(null,n)}}}var Qr="xyzw".split(""),Kr=5121,qr=1,$r=2,Zr=0,Jr=1,en=2,tn=3,rn=4,nn=5,on=6,an="dither",sn="blend.enable",cn="blend.color",un="blend.equation",fn="blend.func",ln="depth.enable",dn="depth.func",hn="depth.range",pn="depth.mask",mn="colorMask",vn="cull.enable",gn="cull.face",yn="frontFace",bn="lineWidth",En="polygonOffset.enable",_n="polygonOffset.offset",An="sample.alpha",wn="sample.enable",Tn="sample.coverage",xn="stencil.enable",Sn="stencil.mask",Rn="stencil.func",Nn="stencil.opFront",On="stencil.opBack",In="scissor.enable",Cn="scissor.box",Ln="viewport",Mn="profile",Dn="framebuffer",kn="vert",Pn="frag",Fn="elements",jn="primitive",Un="count",Bn="offset",Gn="instances",Vn="vao",zn="Width",Hn="Height",Xn=Dn+zn,Wn=Dn+Hn,Yn=Ln+zn,Qn=Ln+Hn,Kn="drawingBuffer",qn=Kn+zn,$n=Kn+Hn,Zn=[fn,un,Rn,Nn,On,Tn,Ln,Cn,_n],Jn=34962,ei=34963,ti=3553,ri=34067,ni=2884,ii=3042,oi=3024,ai=2960,si=2929,ci=3089,ui=32823,fi=32926,li=32928,di=5126,hi=35664,pi=35665,mi=35666,vi=5124,gi=35667,yi=35668,bi=35669,Ei=35670,_i=35671,Ai=35672,wi=35673,Ti=35674,xi=35675,Si=35676,Ri=35678,Ni=35680,Oi=4,Ii=1028,Ci=1029,Li=2304,Mi=2305,Di=32775,ki=32776,Pi=519,Fi=7680,ji=0,Ui=1,Bi=32774,Gi=513,Vi=36160,zi=36064,Hi={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Xi=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Wi={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Yi={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Qi={frag:35632,vert:35633},Ki={cw:Li,ccw:Mi};function qi(t){return Array.isArray(t)||e(t)||Q(t)}function $i(e){return e.sort((function(e,t){return e===Ln?-1:t===Ln?1:e<t?-1:1}))}function Zi(e,t,r,n){this.thisDep=e,this.contextDep=t,this.propDep=r,this.append=n}function Ji(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function eo(e){return new Zi(!1,!1,!1,e)}function to(e,t){var r=e.type;if(r===Zr){var n=e.data.length;return new Zi(!0,n>=1,n>=2,t)}if(r===rn){var i=e.data;return new Zi(i.thisDep,i.contextDep,i.propDep,t)}if(r===nn)return new Zi(!1,!1,!1,t);if(r===on){for(var o=!1,a=!1,s=!1,c=0;c<e.data.length;++c){var u=e.data[c];if(u.type===Jr)s=!0;else if(u.type===en)a=!0;else if(u.type===tn)o=!0;else if(u.type===Zr){o=!0;var f=u.data;f>=1&&(a=!0),f>=2&&(s=!0)}else u.type===rn&&(o=o||u.data.thisDep,a=a||u.data.contextDep,s=s||u.data.propDep)}return new Zi(o,a,s,t)}return new Zi(r===tn,r===en,r===Jr,t)}var ro=new Zi(!1,!1,!1,(function(){}));function no(e,r,n,i,o,a,s,c,u,f,l,d,h,p,m){var v=f.Record,g={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(g.min=Di,g.max=ki);var y=n.angle_instanced_arrays,b=n.webgl_draw_buffers,E={dirty:!0,profile:m.profile},_={},A=[],w={},T={};function x(e){return e.replace(".","_")}function S(e,t,r){var n=x(e);A.push(e),_[n]=E[n]=!!r,w[n]=t}function R(e,t,r){var n=x(e);A.push(e),Array.isArray(r)?(E[n]=r.slice(),_[n]=r.slice()):E[n]=_[n]=r,T[n]=t}S(an,oi),S(sn,ii),R(cn,"blendColor",[0,0,0,0]),R(un,"blendEquationSeparate",[Bi,Bi]),R(fn,"blendFuncSeparate",[Ui,ji,Ui,ji]),S(ln,si,!0),R(dn,"depthFunc",Gi),R(hn,"depthRange",[0,1]),R(pn,"depthMask",!0),R(mn,mn,[!0,!0,!0,!0]),S(vn,ni),R(gn,"cullFace",Ci),R(yn,yn,Mi),R(bn,bn,1),S(En,ui),R(_n,"polygonOffset",[0,0]),S(An,fi),S(wn,li),R(Tn,"sampleCoverage",[1,!1]),S(xn,ai),R(Sn,"stencilMask",-1),R(Rn,"stencilFunc",[Pi,0,-1]),R(Nn,"stencilOpSeparate",[Ii,Fi,Fi,Fi]),R(On,"stencilOpSeparate",[Ci,Fi,Fi,Fi]),S(In,ci),R(Cn,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),R(Ln,Ln,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var O={gl:e,context:h,strings:r,next:_,current:E,draw:d,elements:a,buffer:o,shader:l,attributes:f.state,vao:f,uniforms:u,framebuffer:c,extensions:n,timer:p,isBufferArgs:qi},I={primTypes:he,compareFuncs:Wi,blendFuncs:Hi,blendEquations:g,stencilOps:Yi,glTypes:ee,orientationType:Ki};N.optional((function(){O.isArrayLike=Ce})),b&&(I.backBuffer=[Ci],I.drawBuffer=B(i.maxDrawbuffers,(function(e){return 0===e?[0]:B(e,(function(e){return zi+e}))})));var C=0;function L(){var e=Yr(),t=e.link,n=e.global;e.id=C++,e.batchId="0";var i=t(O),o=e.shared={props:"a0"};Object.keys(O).forEach((function(e){o[e]=n.def(i,".",e)})),N.optional((function(){e.CHECK=t(N),e.commandStr=N.guessCommand(),e.command=t(e.commandStr),e.assert=function(e,r,n){e("if(!(",r,"))",this.CHECK,".commandRaise(",t(n),",",this.command,");")},I.invalidBlendCombinations=Xi}));var a=e.next={},s=e.current={};Object.keys(T).forEach((function(e){Array.isArray(E[e])&&(a[e]=n.def(o.next,".",e),s[e]=n.def(o.current,".",e))}));var c=e.constants={};Object.keys(I).forEach((function(e){c[e]=n.def(JSON.stringify(I[e]))})),e.invoke=function(r,n){switch(n.type){case Zr:var i=["this",o.context,o.props,e.batchId];return r.def(t(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case Jr:return r.def(o.props,n.data);case en:return r.def(o.context,n.data);case tn:return r.def("this",n.data);case rn:return n.data.append(e,r),n.data.ref;case nn:return n.data.toString();case on:return n.data.map((function(t){return e.invoke(r,t)}))}},e.attribCache={};var u={};return e.scopeAttrib=function(e){var n=r.id(e);if(n in u)return u[n];var i=f.scope[n];return i||(i=f.scope[n]=new v),u[n]=t(i)},e}function M(e,t){var r=e.static,n=e.dynamic;if(Dn in r){var i=r[Dn];return i?(i=c.getFramebuffer(i),N.command(i,"invalid framebuffer object"),eo((function(e,t){var r=e.link(i),n=e.shared;t.set(n.framebuffer,".next",r);var o=n.context;return t.set(o,"."+Xn,r+".width"),t.set(o,"."+Wn,r+".height"),r}))):eo((function(e,t){var r=e.shared;t.set(r.framebuffer,".next","null");var n=r.context;return t.set(n,"."+Xn,n+"."+qn),t.set(n,"."+Wn,n+"."+$n),"null"}))}if(Dn in n){var o=n[Dn];return to(o,(function(e,t){var r=e.invoke(t,o),n=e.shared,i=n.framebuffer,a=t.def(i,".getFramebuffer(",r,")");N.optional((function(){e.assert(t,"!"+r+"||"+a,"invalid framebuffer object")})),t.set(i,".next",a);var s=n.context;return t.set(s,"."+Xn,a+"?"+a+".width:"+s+"."+qn),t.set(s,"."+Wn,a+"?"+a+".height:"+s+"."+$n),a}))}return null}function k(e,t,n){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=r.id(i[e]);N.optional((function(){l.shader(Qi[e],t,N.guessCommand())}));var n=eo((function(){return t}));return n.id=t,n}if(e in o){var a=o[e];return to(a,(function(t,r){var n=t.invoke(r,a),i=r.def(t.shared.strings,".id(",n,")");return N.optional((function(){r(t.shared.shader,".shader(",Qi[e],",",i,",",t.command,");")})),i}))}return null}var s,c=a(Pn),u=a(kn),f=null;return Ji(c)&&Ji(u)?(f=l.program(u.id,c.id,null,n),s=eo((function(e,t){return e.link(f)}))):s=new Zi(c&&c.thisDep||u&&u.thisDep,c&&c.contextDep||u&&u.contextDep,c&&c.propDep||u&&u.propDep,(function(e,t){var r,n=e.shared.shader;r=c?c.append(e,t):t.def(n,".",Pn);var i=n+".program("+(u?u.append(e,t):t.def(n,".",kn))+","+r;return N.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:c,vert:u,progVar:s,program:f}}function P(e,t){var r=e.static,n=e.dynamic;var i=function(){if(Fn in r){var e=r[Fn];qi(e)?e=a.getElements(a.create(e,!0)):e&&(e=a.getElements(e),N.command(e,"invalid elements",t.commandStr));var i=eo((function(t,r){if(e){var n=t.link(e);return t.ELEMENTS=n,n}return t.ELEMENTS=null,null}));return i.value=e,i}if(Fn in n){var o=n[Fn];return to(o,(function(e,t){var r=e.shared,n=r.isBufferArgs,i=r.elements,a=e.invoke(t,o),s=t.def("null"),c=t.def(n,"(",a,")"),u=e.cond(c).then(s,"=",i,".createStream(",a,");").else(s,"=",i,".getElements(",a,");");return N.optional((function(){e.assert(u.else,"!"+a+"||"+s,"invalid elements")})),t.entry(u),t.exit(e.cond(c).then(i,".destroyStream(",s,");")),e.ELEMENTS=s,s}))}return null}();function o(e,o){if(e in r){var a=0|r[e];return N.command(!o||a>=0,"invalid "+e,t.commandStr),eo((function(e,t){return o&&(e.OFFSET=a),a}))}if(e in n){var s=n[e];return to(s,(function(t,r){var n=t.invoke(r,s);return o&&(t.OFFSET=n,N.optional((function(){t.assert(r,n+">=0","invalid "+e)}))),n}))}return o&&i?eo((function(e,t){return e.OFFSET="0",0})):null}var s=o(Bn,!0);return{elements:i,primitive:function(){if(jn in r){var e=r[jn];return N.commandParameter(e,he,"invalid primitve",t.commandStr),eo((function(t,r){return he[e]}))}if(jn in n){var o=n[jn];return to(o,(function(e,t){var r=e.constants.primTypes,n=e.invoke(t,o);return N.optional((function(){e.assert(t,n+" in "+r,"invalid primitive, must be one of "+Object.keys(he))})),t.def(r,"[",n,"]")}))}return i?Ji(i)?i.value?eo((function(e,t){return t.def(e.ELEMENTS,".primType")})):eo((function(){return Oi})):new Zi(i.thisDep,i.contextDep,i.propDep,(function(e,t){var r=e.ELEMENTS;return t.def(r,"?",r,".primType:",Oi)})):null}(),count:function(){if(Un in r){var e=0|r[Un];return N.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),eo((function(){return e}))}if(Un in n){var o=n[Un];return to(o,(function(e,t){var r=e.invoke(t,o);return N.optional((function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">=0&&"+r+"===("+r+"|0)","invalid vertex count")})),r}))}if(i){if(Ji(i)){if(i)return s?new Zi(s.thisDep,s.contextDep,s.propDep,(function(e,t){var r=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return N.optional((function(){e.assert(t,r+">=0","invalid vertex offset/element buffer too small")})),r})):eo((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var a=eo((function(){return-1}));return N.optional((function(){a.MISSING=!0})),a}var c=new Zi(i.thisDep||s.thisDep,i.contextDep||s.contextDep,i.propDep||s.propDep,(function(e,t){var r=e.ELEMENTS;return e.OFFSET?t.def(r,"?",r,".vertCount-",e.OFFSET,":-1"):t.def(r,"?",r,".vertCount:-1")}));return N.optional((function(){c.DYNAMIC=!0})),c}return null}(),instances:o(Gn,!1),offset:s}}function F(e,t){var r=e.static,n=e.dynamic,o={};return A.forEach((function(e){var a=x(e);function s(t,i){if(e in r){var s=t(r[e]);o[a]=eo((function(){return s}))}else if(e in n){var c=n[e];o[a]=to(c,(function(e,t){return i(e,t,e.invoke(t,c))}))}}switch(e){case vn:case sn:case an:case xn:case ln:case In:case En:case An:case wn:case pn:return s((function(r){return N.commandType(r,"boolean",e,t.commandStr),r}),(function(t,r,n){return N.optional((function(){t.assert(r,"typeof "+n+'==="boolean"',"invalid flag "+e,t.commandStr)})),n}));case dn:return s((function(r){return N.commandParameter(r,Wi,"invalid "+e,t.commandStr),Wi[r]}),(function(t,r,n){var i=t.constants.compareFuncs;return N.optional((function(){t.assert(r,n+" in "+i,"invalid "+e+", must be one of "+Object.keys(Wi))})),r.def(i,"[",n,"]")}));case hn:return s((function(e){return N.command(Ce(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,r){return N.optional((function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===2&&typeof "+r+'[0]==="number"&&typeof '+r+'[1]==="number"&&'+r+"[0]<="+r+"[1]","depth range must be a 2d array")})),[t.def("+",r,"[0]"),t.def("+",r,"[1]")]}));case fn:return s((function(e){N.commandType(e,"object","blend.func",t.commandStr);var r="srcRGB"in e?e.srcRGB:e.src,n="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return N.commandParameter(r,Hi,a+".srcRGB",t.commandStr),N.commandParameter(n,Hi,a+".srcAlpha",t.commandStr),N.commandParameter(i,Hi,a+".dstRGB",t.commandStr),N.commandParameter(o,Hi,a+".dstAlpha",t.commandStr),N.command(-1===Xi.indexOf(r+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+r+", "+i+")",t.commandStr),[Hi[r],Hi[i],Hi[n],Hi[o]]}),(function(t,r,n){var i=t.constants.blendFuncs;function o(o,a){var s=r.def('"',o,a,'" in ',n,"?",n,".",o,a,":",n,".",o);return N.optional((function(){t.assert(r,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(Hi))})),s}N.optional((function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");N.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(r,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var c=r.def(i,"[",a,"]"),u=r.def(i,"[",o("src","Alpha"),"]");return[c,r.def(i,"[",s,"]"),u,r.def(i,"[",o("dst","Alpha"),"]")]}));case un:return s((function(r){return"string"==typeof r?(N.commandParameter(r,g,"invalid "+e,t.commandStr),[g[r],g[r]]):"object"==typeof r?(N.commandParameter(r.rgb,g,e+".rgb",t.commandStr),N.commandParameter(r.alpha,g,e+".alpha",t.commandStr),[g[r.rgb],g[r.alpha]]):void N.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,r,n){var i=t.constants.blendEquations,o=r.def(),a=r.def(),s=t.cond("typeof ",n,'==="string"');return N.optional((function(){function r(e,r,n){t.assert(e,n+" in "+i,"invalid "+r+", must be one of "+Object.keys(g))}r(s.then,e,n),t.assert(s.else,n+"&&typeof "+n+'==="object"',"invalid "+e),r(s.else,e+".rgb",n+".rgb"),r(s.else,e+".alpha",n+".alpha")})),s.then(o,"=",a,"=",i,"[",n,"];"),s.else(o,"=",i,"[",n,".rgb];",a,"=",i,"[",n,".alpha];"),r(s),[o,a]}));case cn:return s((function(e){return N.command(Ce(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),B(4,(function(t){return+e[t]}))}),(function(e,t,r){return N.optional((function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","blend.color must be a 4d array")})),B(4,(function(e){return t.def("+",r,"[",e,"]")}))}));case Sn:return s((function(e){return N.commandType(e,"number",a,t.commandStr),0|e}),(function(e,t,r){return N.optional((function(){e.assert(t,"typeof "+r+'==="number"',"invalid stencil.mask")})),t.def(r,"|0")}));case Rn:return s((function(r){N.commandType(r,"object",a,t.commandStr);var n=r.cmp||"keep",i=r.ref||0,o="mask"in r?r.mask:-1;return N.commandParameter(n,Wi,e+".cmp",t.commandStr),N.commandType(i,"number",e+".ref",t.commandStr),N.commandType(o,"number",e+".mask",t.commandStr),[Wi[n],i,o]}),(function(e,t,r){var n=e.constants.compareFuncs;return N.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(r+"&&typeof ",r,'==="object"'),i('!("cmp" in ',r,")||(",r,".cmp in ",n,")")})),[t.def('"cmp" in ',r,"?",n,"[",r,".cmp]",":",Fi),t.def(r,".ref|0"),t.def('"mask" in ',r,"?",r,".mask|0:-1")]}));case Nn:case On:return s((function(r){N.commandType(r,"object",a,t.commandStr);var n=r.fail||"keep",i=r.zfail||"keep",o=r.zpass||"keep";return N.commandParameter(n,Yi,e+".fail",t.commandStr),N.commandParameter(i,Yi,e+".zfail",t.commandStr),N.commandParameter(o,Yi,e+".zpass",t.commandStr),[e===On?Ci:Ii,Yi[n],Yi[i],Yi[o]]}),(function(t,r,n){var i=t.constants.stencilOps;function o(o){return N.optional((function(){t.assert(r,'!("'+o+'" in '+n+")||("+n+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys(Yi))})),r.def('"',o,'" in ',n,"?",i,"[",n,".",o,"]:",Fi)}return N.optional((function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)})),[e===On?Ci:Ii,o("fail"),o("zfail"),o("zpass")]}));case _n:return s((function(e){N.commandType(e,"object",a,t.commandStr);var r=0|e.factor,n=0|e.units;return N.commandType(r,"number",a+".factor",t.commandStr),N.commandType(n,"number",a+".units",t.commandStr),[r,n]}),(function(t,r,n){return N.optional((function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)})),[r.def(n,".factor|0"),r.def(n,".units|0")]}));case gn:return s((function(e){var r=0;return"front"===e?r=Ii:"back"===e&&(r=Ci),N.command(!!r,a,t.commandStr),r}),(function(e,t,r){return N.optional((function(){e.assert(t,r+'==="front"||'+r+'==="back"',"invalid cull.face")})),t.def(r,'==="front"?',Ii,":",Ci)}));case bn:return s((function(e){return N.command("number"==typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e}),(function(e,t,r){return N.optional((function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">="+i.lineWidthDims[0]+"&&"+r+"<="+i.lineWidthDims[1],"invalid line width")})),r}));case yn:return s((function(e){return N.commandParameter(e,Ki,a,t.commandStr),Ki[e]}),(function(e,t,r){return N.optional((function(){e.assert(t,r+'==="cw"||'+r+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(r+'==="cw"?'+Li+":"+Mi)}));case mn:return s((function(e){return N.command(Ce(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,r){return N.optional((function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","invalid color.mask")})),B(4,(function(e){return"!!"+r+"["+e+"]"}))}));case Tn:return s((function(e){N.command("object"==typeof e&&e,a,t.commandStr);var r="value"in e?e.value:1,n=!!e.invert;return N.command("number"==typeof r&&r>=0&&r<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[r,n]}),(function(e,t,r){return N.optional((function(){e.assert(t,r+"&&typeof "+r+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',r,"?+",r,".value:1"),t.def("!!",r,".invert")]}))}})),o}function j(e,t){var n=e.static,i=e.dynamic,a={};return Object.keys(n).forEach((function(e){var i=n[e],s=r.id(e),c=new v;if(qi(i))c.state=qr,c.buffer=o.getBuffer(o.create(i,Jn,!1,!0)),c.type=0;else{var u=o.getBuffer(i);if(u)c.state=qr,c.buffer=u,c.type=0;else if(N.command("object"==typeof i&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var f=i.constant;c.buffer="null",c.state=$r,"number"==typeof f?c.x=f:(N.command(Ce(f)&&f.length>0&&f.length<=4,"invalid constant for attribute "+e,t.commandStr),Qr.forEach((function(e,t){t<f.length&&(c[e]=f[t])})))}else{u=qi(i.buffer)?o.getBuffer(o.create(i.buffer,Jn,!1,!0)):o.getBuffer(i.buffer),N.command(!!u,'missing buffer for attribute "'+e+'"',t.commandStr);var l=0|i.offset;N.command(l>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var d=0|i.stride;N.command(d>=0&&d<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var h=0|i.size;N.command(!("size"in i)||h>0&&h<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var p=!!i.normalized,m=0;"type"in i&&(N.commandParameter(i.type,ee,"invalid type for attribute "+e,t.commandStr),m=ee[i.type]);var g=0|i.divisor;"divisor"in i&&(N.command(0===g||y,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),N.command(g>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),N.optional((function(){var r=t.commandStr,n=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){N.command(n.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+n+")",r)}))})),c.buffer=u,c.state=qr,c.size=h,c.normalized=p,c.type=m||u.dtype,c.offset=l,c.stride=d,c.divisor=g}}a[e]=eo((function(e,t){var r=e.attribCache;if(s in r)return r[s];var n={isStream:!1};return Object.keys(c).forEach((function(e){n[e]=c[e]})),c.buffer&&(n.buffer=e.link(c.buffer),n.type=n.type||n.buffer+".dtype"),r[s]=n,n}))})),Object.keys(i).forEach((function(e){var t=i[e];a[e]=to(t,(function(r,n){var i=r.invoke(n,t),o=r.shared,a=r.constants,s=o.isBufferArgs,c=o.buffer;N.optional((function(){r.assert(n,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+c+".getBuffer("+i+")||"+c+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var u={isStream:n.def(!1)},f=new v;f.state=qr,Object.keys(f).forEach((function(e){u[e]=n.def(""+f[e])}));var l=u.buffer,d=u.type;function h(e){n(u[e],"=",i,".",e,"|0;")}return n("if(",s,"(",i,")){",u.isStream,"=true;",l,"=",c,".createStream(",Jn,",",i,");",d,"=",l,".dtype;","}else{",l,"=",c,".getBuffer(",i,");","if(",l,"){",d,"=",l,".dtype;",'}else if("constant" in ',i,"){",u.state,"=",$r,";","if(typeof "+i+'.constant === "number"){',u[Qr[0]],"=",i,".constant;",Qr.slice(1).map((function(e){return u[e]})).join("="),"=0;","}else{",Qr.map((function(e,t){return u[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",l,"=",c,".createStream(",Jn,",",i,".buffer);","}else{",l,"=",c,".getBuffer(",i,".buffer);","}",d,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",l,".dtype;",u.normalized,"=!!",i,".normalized;"),h("size"),h("offset"),h("stride"),h("divisor"),n("}}"),n.exit("if(",u.isStream,"){",c,".destroyStream(",l,");","}"),u}))})),a}function U(e,t,r,i,o){var a=e.static,s=e.dynamic;N.optional((function(){var e=[Dn,kn,Pn,Fn,jn,Bn,Un,Gn,Mn,Vn].concat(A);function t(t){Object.keys(t).forEach((function(t){N.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',o.commandStr)}))}t(a),t(s)}));var c=function(e,t){var r=e.static;if("string"==typeof r[Pn]&&"string"==typeof r[kn]){if(Object.keys(t.dynamic).length>0)return null;var n=t.static,i=Object.keys(n);if(i.length>0&&"number"==typeof n[i[0]]){for(var o=[],a=0;a<i.length;++a)N("number"==typeof n[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|n[i[a]],i[a]]);return o}}return null}(e,t),u=M(e),l=function(e,t,r){var n=e.static,i=e.dynamic;function o(e){if(e in n){var o=n[e];N.commandType(o,"object","invalid "+e,r.commandStr);var a,s,c=!0,u=0|o.x,f=0|o.y;return"width"in o?(a=0|o.width,N.command(a>=0,"invalid "+e,r.commandStr)):c=!1,"height"in o?(s=0|o.height,N.command(s>=0,"invalid "+e,r.commandStr)):c=!1,new Zi(!c&&t&&t.thisDep,!c&&t&&t.contextDep,!c&&t&&t.propDep,(function(e,t){var r=e.shared.context,n=a;"width"in o||(n=t.def(r,".",Xn,"-",u));var i=s;return"height"in o||(i=t.def(r,".",Wn,"-",f)),[u,f,n,i]}))}if(e in i){var l=i[e],d=to(l,(function(t,r){var n=t.invoke(r,l);N.optional((function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)}));var i=t.shared.context,o=r.def(n,".x|0"),a=r.def(n,".y|0"),s=r.def('"width" in ',n,"?",n,".width|0:","(",i,".",Xn,"-",o,")"),c=r.def('"height" in ',n,"?",n,".height|0:","(",i,".",Wn,"-",a,")");return N.optional((function(){t.assert(r,s+">=0&&"+c+">=0","invalid "+e)})),[o,a,s,c]}));return t&&(d.thisDep=d.thisDep||t.thisDep,d.contextDep=d.contextDep||t.contextDep,d.propDep=d.propDep||t.propDep),d}return t?new Zi(t.thisDep,t.contextDep,t.propDep,(function(e,t){var r=e.shared.context;return[0,0,t.def(r,".",Xn),t.def(r,".",Wn)]})):null}var a=o(Ln);if(a){var s=a;a=new Zi(a.thisDep,a.contextDep,a.propDep,(function(e,t){var r=s.append(e,t),n=e.shared.context;return t.set(n,"."+Yn,r[2]),t.set(n,"."+Qn,r[3]),r}))}return{viewport:a,scissor_box:o(Cn)}}(e,u,o),d=P(e,o),h=F(e,o),p=k(e,0,c);function m(e){var t=l[e];t&&(h[e]=t)}m(Ln),m(x(Cn));var v=Object.keys(h).length>0,g={framebuffer:u,draw:d,shader:p,state:h,dirty:v,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(g.profile=function(e){var t,r=e.static,n=e.dynamic;if(Mn in r){var i=!!r[Mn];(t=eo((function(e,t){return i}))).enable=i}else if(Mn in n){var o=n[Mn];t=to(o,(function(e,t){return e.invoke(t,o)}))}return t}(e),g.uniforms=function(e,t){var r=e.static,n=e.dynamic,i={};return Object.keys(r).forEach((function(e){var n,o=r[e];if("number"==typeof o||"boolean"==typeof o)n=eo((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?n=eo((function(e){return e.link(o)})):"framebuffer"===a||"framebufferCube"===a?(N.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),n=eo((function(e){return e.link(o.color[0])}))):N.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else Ce(o)?n=eo((function(t){return t.global.def("[",B(o.length,(function(r){return N.command("number"==typeof o[r]||"boolean"==typeof o[r],"invalid uniform "+e,t.commandStr),o[r]})),"]")})):N.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);n.value=o,i[e]=n})),Object.keys(n).forEach((function(e){var t=n[e];i[e]=to(t,(function(e,r){return e.invoke(r,t)}))})),i}(r,o),g.drawVAO=g.scopeVAO=function(e,t){var r=e.static,n=e.dynamic;if(Vn in r){var i=r[Vn];return null!==i&&null===f.getVAO(i)&&(i=f.createVAO(i)),eo((function(e){return e.link(f.getVAO(i))}))}if(Vn in n){var o=n[Vn];return to(o,(function(e,t){var r=e.invoke(t,o);return t.def(e.shared.vao+".getVAO("+r+")")}))}return null}(e),!g.drawVAO&&p.program&&!c&&n.angle_instanced_arrays){var y=!0,b=p.program.attributes.map((function(e){var r=t.static[e];return y=y&&!!r,r}));if(y&&b.length>0){var E=f.getVAO(f.createVAO(b));g.drawVAO=new Zi(null,null,null,(function(e,t){return e.link(E)})),g.useVAO=!0}}return c?g.useVAO=!0:g.attributes=j(t,o),g.context=function(e){var t=e.static,r=e.dynamic,n={};return Object.keys(t).forEach((function(e){var r=t[e];n[e]=eo((function(e,t){return"number"==typeof r||"boolean"==typeof r?""+r:e.link(r)}))})),Object.keys(r).forEach((function(e){var t=r[e];n[e]=to(t,(function(e,r){return e.invoke(r,t)}))})),n}(i),g}function G(e,t,r){var n=e.shared.context,i=e.scope();Object.keys(r).forEach((function(o){t.save(n,"."+o);var a=r[o].append(e,t);Array.isArray(a)?i(n,".",o,"=[",a.join(),"];"):i(n,".",o,"=",a,";")})),t(i)}function V(e,t,r,n){var i,o=e.shared,a=o.gl,s=o.framebuffer;b&&(i=t.def(o.extensions,".webgl_draw_buffers"));var c,u=e.constants,f=u.drawBuffer,l=u.backBuffer;c=r?r.append(e,t):t.def(s,".next"),n||t("if(",c,"!==",s,".cur){"),t("if(",c,"){",a,".bindFramebuffer(",Vi,",",c,".framebuffer);"),b&&t(i,".drawBuffersWEBGL(",f,"[",c,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",Vi,",null);"),b&&t(i,".drawBuffersWEBGL(",l,");"),t("}",s,".cur=",c,";"),n||t("}")}function z(e,t,r){var n=e.shared,i=n.gl,o=e.current,a=e.next,s=n.current,c=n.next,u=e.cond(s,".dirty");A.forEach((function(t){var n,f,l=x(t);if(!(l in r.state))if(l in a){n=a[l],f=o[l];var d=B(E[l].length,(function(e){return u.def(n,"[",e,"]")}));u(e.cond(d.map((function(e,t){return e+"!=="+f+"["+t+"]"})).join("||")).then(i,".",T[l],"(",d,");",d.map((function(e,t){return f+"["+t+"]="+e})).join(";"),";"))}else{n=u.def(c,".",l);var h=e.cond(n,"!==",s,".",l);u(h),l in w?h(e.cond(n).then(i,".enable(",w[l],");").else(i,".disable(",w[l],");"),s,".",l,"=",n,";"):h(i,".",T[l],"(",n,");",s,".",l,"=",n,";")}})),0===Object.keys(r.state).length&&u(s,".dirty=false;"),t(u)}function H(e,t,r,n){var i=e.shared,o=e.current,a=i.current,s=i.gl;$i(Object.keys(r)).forEach((function(i){var c=r[i];if(!n||n(c)){var u=c.append(e,t);if(w[i]){var f=w[i];Ji(c)?t(s,u?".enable(":".disable(",f,");"):t(e.cond(u).then(s,".enable(",f,");").else(s,".disable(",f,");")),t(a,".",i,"=",u,";")}else if(Ce(u)){var l=o[i];t(s,".",T[i],"(",u,");",u.map((function(e,t){return l+"["+t+"]="+e})).join(";"),";")}else t(s,".",T[i],"(",u,");",a,".",i,"=",u,";")}}))}function X(e,t){y&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function W(e,t,r,n,i){var o,a,s,c=e.shared,u=e.stats,f=c.current,l=c.timer,d=r.profile;function h(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function m(e){e(o=t.def(),"=",h(),";"),"string"==typeof i?e(u,".count+=",i,";"):e(u,".count++;"),p&&(n?e(a=t.def(),"=",l,".getNumPendingQueries();"):e(l,".beginQuery(",u,");"))}function v(e){e(u,".cpuTime+=",h(),"-",o,";"),p&&(n?e(l,".pushScopeStats(",a,",",l,".getNumPendingQueries(),",u,");"):e(l,".endQuery();"))}function g(e){var r=t.def(f,".profile");t(f,".profile=",e,";"),t.exit(f,".profile=",r,";")}if(d){if(Ji(d))return void(d.enable?(m(t),v(t.exit),g("true")):g("false"));g(s=d.append(e,t))}else s=t.def(f,".profile");var y=e.block();m(y),t("if(",s,"){",y,"}");var b=e.block();v(b),t.exit("if(",s,"){",b,"}")}function Y(e,t,r,n,i){var o=e.shared;function a(r,n,i){var a=o.gl,s=t.def(r,".location"),c=t.def(o.attributes,"[",s,"]"),u=i.state,f=i.buffer,l=[i.x,i.y,i.z,i.w],d=["buffer","normalized","offset","stride"];function h(){t("if(!",c,".buffer){",a,".enableVertexAttribArray(",s,");}");var r,o=i.type;if(r=i.size?t.def(i.size,"||",n):n,t("if(",c,".type!==",o,"||",c,".size!==",r,"||",d.map((function(e){return c+"."+e+"!=="+i[e]})).join("||"),"){",a,".bindBuffer(",Jn,",",f,".buffer);",a,".vertexAttribPointer(",[s,r,o,i.normalized,i.stride,i.offset],");",c,".type=",o,";",c,".size=",r,";",d.map((function(e){return c+"."+e+"="+i[e]+";"})).join(""),"}"),y){var u=i.divisor;t("if(",c,".divisor!==",u,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,u],");",c,".divisor=",u,";}")}}function p(){t("if(",c,".buffer){",a,".disableVertexAttribArray(",s,");",c,".buffer=null;","}if(",Qr.map((function(e,t){return c+"."+e+"!=="+l[t]})).join("||"),"){",a,".vertexAttrib4f(",s,",",l,");",Qr.map((function(e,t){return c+"."+e+"="+l[t]+";"})).join(""),"}")}u===qr?h():u===$r?p():(t("if(",u,"===",qr,"){"),h(),t("}else{"),p(),t("}"))}n.forEach((function(n){var o,s=n.name,c=r.attributes[s];if(c){if(!i(c))return;o=c.append(e,t)}else{if(!i(ro))return;var u=e.scopeAttrib(s);N.optional((function(){e.assert(t,u+".state","missing attribute "+s)})),o={},Object.keys(new v).forEach((function(e){o[e]=t.def(u,".",e)}))}a(e.link(n),function(e){switch(e){case hi:case gi:case _i:return 2;case pi:case yi:case Ai:return 3;case mi:case bi:case wi:return 4;default:return 1}}(n.info.type),o)}))}function Q(e,t,n,i,o){for(var a,s=e.shared,c=s.gl,u=0;u<i.length;++u){var f,l=i[u],d=l.name,h=l.info.type,p=n.uniforms[d],m=e.link(l)+".location";if(p){if(!o(p))continue;if(Ji(p)){var v=p.value;if(N.command(null!=v,'missing uniform "'+d+'"',e.commandStr),h===Ri||h===Ni){N.command("function"==typeof v&&(h===Ri&&("texture2d"===v._reglType||"framebuffer"===v._reglType)||h===Ni&&("textureCube"===v._reglType||"framebufferCube"===v._reglType)),"invalid texture for uniform "+d,e.commandStr);var g=e.link(v._texture||v.color[0]._texture);t(c,".uniform1i(",m,",",g+".bind());"),t.exit(g,".unbind();")}else if(h===Ti||h===xi||h===Si){N.optional((function(){N.command(Ce(v),"invalid matrix for uniform "+d,e.commandStr),N.command(h===Ti&&4===v.length||h===xi&&9===v.length||h===Si&&16===v.length,"invalid length for matrix uniform "+d,e.commandStr)}));var y=e.global.def("new Float32Array(["+Array.prototype.slice.call(v)+"])"),b=2;h===xi?b=3:h===Si&&(b=4),t(c,".uniformMatrix",b,"fv(",m,",false,",y,");")}else{switch(h){case di:N.commandType(v,"number","uniform "+d,e.commandStr),a="1f";break;case hi:N.command(Ce(v)&&2===v.length,"uniform "+d,e.commandStr),a="2f";break;case pi:N.command(Ce(v)&&3===v.length,"uniform "+d,e.commandStr),a="3f";break;case mi:N.command(Ce(v)&&4===v.length,"uniform "+d,e.commandStr),a="4f";break;case Ei:N.commandType(v,"boolean","uniform "+d,e.commandStr),a="1i";break;case vi:N.commandType(v,"number","uniform "+d,e.commandStr),a="1i";break;case _i:case gi:N.command(Ce(v)&&2===v.length,"uniform "+d,e.commandStr),a="2i";break;case Ai:case yi:N.command(Ce(v)&&3===v.length,"uniform "+d,e.commandStr),a="3i";break;case wi:case bi:N.command(Ce(v)&&4===v.length,"uniform "+d,e.commandStr),a="4i"}t(c,".uniform",a,"(",m,",",Ce(v)?Array.prototype.slice.call(v):v,");")}continue}f=p.append(e,t)}else{if(!o(ro))continue;f=t.def(s.uniforms,"[",r.id(d),"]")}h===Ri?(N(!Array.isArray(f),"must specify a scalar prop for textures"),t("if(",f,"&&",f,'._reglType==="framebuffer"){',f,"=",f,".color[0];","}")):h===Ni&&(N(!Array.isArray(f),"must specify a scalar prop for cube maps"),t("if(",f,"&&",f,'._reglType==="framebufferCube"){',f,"=",f,".color[0];","}")),N.optional((function(){function r(r,n){e.assert(t,r,'bad data or missing for uniform "'+d+'".  '+n)}function n(e){N(!Array.isArray(f),"must not specify an array type for uniform"),r("typeof "+f+'==="'+e+'"',"invalid type, expected "+e)}function i(e,t){Array.isArray(f)?N(f.length===e,"must have length "+e):r(s.isArrayLike+"("+f+")&&"+f+".length==="+e,"invalid vector, should have length "+e)}function o(e){N(!Array.isArray(f),"must not specify a value type"),r("typeof "+f+'==="function"&&'+f+'._reglType==="texture'+(e===ti?"2d":"Cube")+'"',"invalid texture type")}switch(h){case vi:n("number");break;case gi:i(2);break;case yi:i(3);break;case bi:i(4);break;case di:n("number");break;case hi:i(2);break;case pi:i(3);break;case mi:i(4);break;case Ei:n("boolean");break;case _i:i(2);break;case Ai:i(3);break;case wi:case Ti:i(4);break;case xi:i(9);break;case Si:i(16);break;case Ri:o(ti);break;case Ni:o(ri)}}));var E=1;switch(h){case Ri:case Ni:var _=t.def(f,"._texture");t(c,".uniform1i(",m,",",_,".bind());"),t.exit(_,".unbind();");continue;case vi:case Ei:a="1i";break;case gi:case _i:a="2i",E=2;break;case yi:case Ai:a="3i",E=3;break;case bi:case wi:a="4i",E=4;break;case di:a="1f";break;case hi:a="2f",E=2;break;case pi:a="3f",E=3;break;case mi:a="4f",E=4;break;case Ti:a="Matrix2fv";break;case xi:a="Matrix3fv";break;case Si:a="Matrix4fv"}if(t(c,".uniform",a,"(",m,","),"M"===a.charAt(0)){var A=Math.pow(h-Ti+2,2),w=e.global.def("new Float32Array(",A,")");Array.isArray(f)?t("false,(",B(A,(function(e){return w+"["+e+"]="+f[e]})),",",w,")"):t("false,(Array.isArray(",f,")||",f," instanceof Float32Array)?",f,":(",B(A,(function(e){return w+"["+e+"]="+f+"["+e+"]"})),",",w,")")}else E>1?t(B(E,(function(e){return Array.isArray(f)?f[e]:f+"["+e+"]"}))):(N(!Array.isArray(f),"uniform value must not be an array"),t(f));t(");")}}function K(e,t,r,n){var i=e.shared,o=i.gl,a=i.draw,s=n.draw;var c=function(){var i,c=s.elements,u=t;return c?((c.contextDep&&n.contextDynamic||c.propDep)&&(u=r),i=c.append(e,u)):i=u.def(a,".",Fn),i&&u("if("+i+")"+o+".bindBuffer("+ei+","+i+".buffer.buffer);"),i}();function u(i){var o=s[i];return o?o.contextDep&&n.contextDynamic||o.propDep?o.append(e,r):o.append(e,t):t.def(a,".",i)}var f,l,d=u(jn),h=u(Bn),p=function(){var i,o=s.count,c=t;return o?((o.contextDep&&n.contextDynamic||o.propDep)&&(c=r),i=o.append(e,c),N.optional((function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(c,i+">=0","missing vertex count")}))):(i=c.def(a,".",Un),N.optional((function(){e.assert(c,i+">=0","missing vertex count")}))),i}();if("number"==typeof p){if(0===p)return}else r("if(",p,"){"),r.exit("}");y&&(f=u(Gn),l=e.instancing);var m=c+".type",v=s.elements&&Ji(s.elements);function g(){function e(){r(l,".drawElementsInstancedANGLE(",[d,p,m,h+"<<(("+m+"-"+Kr+")>>1)",f],");")}function t(){r(l,".drawArraysInstancedANGLE(",[d,h,p,f],");")}c?v?e():(r("if(",c,"){"),e(),r("}else{"),t(),r("}")):t()}function b(){function e(){r(o+".drawElements("+[d,p,m,h+"<<(("+m+"-"+Kr+")>>1)"]+");")}function t(){r(o+".drawArrays("+[d,h,p]+");")}c?v?e():(r("if(",c,"){"),e(),r("}else{"),t(),r("}")):t()}y&&("number"!=typeof f||f>=0)?"string"==typeof f?(r("if(",f,">0){"),g(),r("}else if(",f,"<0){"),b(),r("}")):g():b()}function q(e,t,r,n,i){var o=L(),a=o.proc("body",i);return N.optional((function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)})),y&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,r,n),o.compile().body}function $(e,t,r,n){X(e,t),r.useVAO?r.drawVAO?t(e.shared.vao,".setVAO(",r.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),Y(e,t,r,n.attributes,(function(){return!0}))),Q(e,t,r,n.uniforms,(function(){return!0})),K(e,t,t,r)}function Z(e,t,r,n){function i(){return!0}e.batchId="a1",X(e,t),Y(e,t,r,n.attributes,i),Q(e,t,r,n.uniforms,i),K(e,t,t,r)}function J(e,t,r,n){X(e,t);var i=r.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var s=e.scope(),c=e.scope();function u(e){return e.contextDep&&i||e.propDep}function f(e){return!u(e)}if(t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",c,"}",s.exit),r.needsContext&&G(e,c,r.context),r.needsFramebuffer&&V(e,c,r.framebuffer),H(e,c,r.state,u),r.profile&&u(r.profile)&&W(e,c,r,!1,!0),n)r.useVAO?r.drawVAO?u(r.drawVAO)?c(e.shared.vao,".setVAO(",r.drawVAO.append(e,c),");"):s(e.shared.vao,".setVAO(",r.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),Y(e,s,r,n.attributes,f),Y(e,c,r,n.attributes,u)),Q(e,s,r,n.uniforms,f),Q(e,c,r,n.uniforms,u),K(e,s,c,r);else{var l=e.global.def("{}"),d=r.shader.progVar.append(e,c),h=c.def(d,".id"),p=c.def(l,"[",h,"]");c(e.shared.gl,".useProgram(",d,".program);","if(!",p,"){",p,"=",l,"[",h,"]=",e.link((function(t){return q(Z,e,r,t,2)})),"(",d,");}",p,".call(this,a0[",o,"],",o,");")}}function te(e,t){var n=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(r){var o=t.shader[r];o&&n.set(i.shader,"."+r,o.append(e,n))}G(e,n,t.context),t.framebuffer&&t.framebuffer.append(e,n),$i(Object.keys(t.state)).forEach((function(r){var o=t.state[r].append(e,n);Ce(o)?o.forEach((function(t,i){n.set(e.next[r],"["+i+"]",t)})):n.set(i.next,"."+r,o)})),W(e,n,t,!0,!0),[Fn,Bn,Un,Gn,jn].forEach((function(r){var o=t.draw[r];o&&n.set(i.draw,"."+r,""+o.append(e,n))})),Object.keys(t.uniforms).forEach((function(o){var a=t.uniforms[o].append(e,n);Array.isArray(a)&&(a="["+a.join()+"]"),n.set(i.uniforms,"["+r.id(o)+"]",a)})),Object.keys(t.attributes).forEach((function(r){var i=t.attributes[r].append(e,n),o=e.scopeAttrib(r);Object.keys(new v).forEach((function(e){n.set(o,"."+e,i[e])}))})),t.scopeVAO&&n.set(i.vao,".targetVAO",t.scopeVAO.append(e,n)),a(kn),a(Pn),Object.keys(t.state).length>0&&(n(o,".dirty=true;"),n.exit(o,".dirty=true;")),n("a1(",e.shared.context,",a0,",e.batchId,");")}function re(e,t,r){var n=t.static[r];if(n&&function(e){if("object"==typeof e&&!Ce(e)){for(var t=Object.keys(e),r=0;r<t.length;++r)if(D.isDynamic(e[t[r]]))return!0;return!1}}(n)){var i=e.global,o=Object.keys(n),a=!1,s=!1,c=!1,u=e.global.def("{}");o.forEach((function(t){var r=n[t];if(D.isDynamic(r)){"function"==typeof r&&(r=n[t]=D.unbox(r));var o=to(r,null);a=a||o.thisDep,c=c||o.propDep,s=s||o.contextDep}else{switch(i(u,".",t,"="),typeof r){case"number":i(r);break;case"string":i('"',r,'"');break;case"object":Array.isArray(r)&&i("[",r.join(),"]");break;default:i(e.link(r))}i(";")}})),t.dynamic[r]=new D.DynamicVariable(rn,{thisDep:a,contextDep:s,propDep:c,ref:u,append:function(e,t){o.forEach((function(r){var i=n[r];if(D.isDynamic(i)){var o=e.invoke(t,i);t(u,".",r,"=",o,";")}}))}}),delete t.static[r]}}return{next:_,current:E,procs:function(){var e=L(),t=e.proc("poll"),r=e.proc("refresh"),o=e.block();t(o),r(o);var a,s=e.shared,c=s.gl,u=s.next,f=s.current;o(f,".dirty=false;"),V(e,t),V(e,r,null,!0),y&&(a=e.link(y)),n.oes_vertex_array_object&&r(e.link(n.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var l=0;l<i.maxAttributes;++l){var d=r.def(s.attributes,"[",l,"]"),h=e.cond(d,".buffer");h.then(c,".enableVertexAttribArray(",l,");",c,".bindBuffer(",Jn,",",d,".buffer.buffer);",c,".vertexAttribPointer(",l,",",d,".size,",d,".type,",d,".normalized,",d,".stride,",d,".offset);").else(c,".disableVertexAttribArray(",l,");",c,".vertexAttrib4f(",l,",",d,".x,",d,".y,",d,".z,",d,".w);",d,".buffer=null;"),r(h),y&&r(a,".vertexAttribDivisorANGLE(",l,",",d,".divisor);")}return r(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(w).forEach((function(n){var i=w[n],a=o.def(u,".",n),s=e.block();s("if(",a,"){",c,".enable(",i,")}else{",c,".disable(",i,")}",f,".",n,"=",a,";"),r(s),t("if(",a,"!==",f,".",n,"){",s,"}")})),Object.keys(T).forEach((function(n){var i,a,s=T[n],l=E[n],d=e.block();if(d(c,".",s,"("),Ce(l)){var h=l.length;i=e.global.def(u,".",n),a=e.global.def(f,".",n),d(B(h,(function(e){return i+"["+e+"]"})),");",B(h,(function(e){return a+"["+e+"]="+i+"["+e+"];"})).join("")),t("if(",B(h,(function(e){return i+"["+e+"]!=="+a+"["+e+"]"})).join("||"),"){",d,"}")}else i=o.def(u,".",n),a=o.def(f,".",n),d(i,");",f,".",n,"=",i,";"),t("if(",i,"!==",a,"){",d,"}");r(d)})),e.compile()}(),compile:function(e,r,n,i,o){var a=L();a.stats=a.link(o),Object.keys(r.static).forEach((function(e){re(a,r,e)})),Zn.forEach((function(t){re(a,e,t)}));var s=U(e,r,n,i,a);return function(e,t){var r=e.proc("draw",1);X(e,r),G(e,r,t.context),V(e,r,t.framebuffer),z(e,r,t),H(e,r,t.state),W(e,r,t,!1,!0);var n=t.shader.progVar.append(e,r);if(r(e.shared.gl,".useProgram(",n,".program);"),t.shader.program)$(e,r,t,t.shader.program);else{r(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=r.def(n,".id"),a=r.def(i,"[",o,"]");r(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(r){return q($,e,t,r,1)})),"(",n,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}(a,s),te(a,s),function(e,t){var r=e.proc("batch",2);e.batchId="0",X(e,r);var n=!1,i=!0;Object.keys(t.context).forEach((function(e){n=n||t.context[e].propDep})),n||(G(e,r,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&n||e.propDep}o?(o.propDep?n=a=!0:o.contextDep&&n&&(a=!0),a||V(e,r,o)):V(e,r,null),t.state.viewport&&t.state.viewport.propDep&&(n=!0),z(e,r,t),H(e,r,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||W(e,r,t,!1,"a1"),t.contextDep=n,t.needsContext=i,t.needsFramebuffer=a;var c=t.shader.progVar;if(c.contextDep&&n||c.propDep)J(e,r,t,null);else{var u=c.append(e,r);if(r(e.shared.gl,".useProgram(",u,".program);"),t.shader.program)J(e,r,t,t.shader.program);else{r(e.shared.vao,".setVAO(null);");var f=e.global.def("{}"),l=r.def(u,".id"),d=r.def(f,"[",l,"]");r(e.cond(d).then(d,".call(this,a0,a1);").else(d,"=",f,"[",l,"]=",e.link((function(r){return q(J,e,t,r,2)})),"(",u,");",d,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}(a,s),t(a.compile(),{destroy:function(){s.shader.program.destroy()}})}}}var io=function(e,t){if(!t.ext_disjoint_timer_query)return null;var r=[];function n(){return r.pop()||t.ext_disjoint_timer_query.createQueryEXT()}function i(e){r.push(e)}var o=[];function a(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var s=[];function c(e){s.push(e)}var u=[];function f(e,t,r){var n=s.pop()||new a;n.startQueryIndex=e,n.endQueryIndex=t,n.sum=0,n.stats=r,u.push(n)}var l=[],d=[];return{beginQuery:function(e){var r=n();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),o.push(r),f(o.length-1,o.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:f,update:function(){var e,r,n=o.length;if(0!==n){d.length=Math.max(d.length,n+1),l.length=Math.max(l.length,n+1),l[0]=0,d[0]=0;var a=0;for(e=0,r=0;r<o.length;++r){var s=o[r];t.ext_disjoint_timer_query.getQueryObjectEXT(s,34919)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(s,34918),i(s)):o[e++]=s,l[r+1]=a,d[r+1]=e}for(o.length=e,e=0,r=0;r<u.length;++r){var f=u[r],h=f.startQueryIndex,p=f.endQueryIndex;f.sum+=l[p]-l[h];var m=d[h],v=d[p];v===m?(f.stats.gpuTime+=f.sum/1e6,c(f)):(f.startQueryIndex=m,f.endQueryIndex=v,u[e++]=f)}u.length=e}},getNumPendingQueries:function(){return o.length},clear:function(){r.push.apply(r,o);for(var e=0;e<r.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(r[e]);o.length=0,r.length=0},restore:function(){o.length=0,r.length=0}}},oo="webglcontextlost",ao="webglcontextrestored";function so(e,t){for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}return function(e){var r=function(e){var t,r,n,i,o=e||{},a={},s=[],c=[],u="undefined"==typeof window?1:window.devicePixelRatio,f=!1,l=function(e){e&&N.raise(e)},d=function(){};if("string"==typeof o?(N("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),t=document.querySelector(o),N(t,"invalid query string for element")):"object"==typeof o?function(e){return"string"==typeof e.nodeName&&"function"==typeof e.appendChild&&"function"==typeof e.getBoundingClientRect}(o)?t=o:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(o)?n=(i=o).canvas:(N.constructor(o),"gl"in o?i=o.gl:"canvas"in o?n=U(o.canvas):"container"in o&&(r=U(o.container)),"attributes"in o&&(a=o.attributes,N.type(a,"object","invalid context attributes")),"extensions"in o&&(s=j(o.extensions)),"optionalExtensions"in o&&(c=j(o.optionalExtensions)),"onDone"in o&&(N.type(o.onDone,"function","invalid or missing onDone callback"),l=o.onDone),"profile"in o&&(f=!!o.profile),"pixelRatio"in o&&(u=+o.pixelRatio,N(u>0,"invalid pixel ratio"))):N.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?n=t:r=t),!i){if(!n){N("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var h=F(r||document.body,0,u);if(!h)return null;n=h.canvas,d=h.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0),i=function(e,t){function r(r){try{return e.getContext(r,t)}catch(e){return null}}return r("webgl")||r("experimental-webgl")||r("webgl-experimental")}(n,a)}return i?{gl:i,canvas:n,container:r,extensions:s,optionalExtensions:c,pixelRatio:u,profile:f,onDone:l,onDestroy:d}:(d(),l("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}(e);if(!r)return null;var n=r.gl,i=n.getContextAttributes(),o=n.isContextLost(),a=function(e,t){var r={};function n(t){N.type(t,"string","extension name must be string");var n,i=t.toLowerCase();try{n=r[i]=e.getExtension(i)}catch(e){}return!!n}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!n(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(n),{extensions:r,restore:function(){Object.keys(r).forEach((function(e){if(r[e]&&!n(e))throw new Error("(regl): error restoring extension "+e)}))}}}(n,r);if(!a)return null;var s=function(){var e={"":0},t=[""];return{id:function(r){var n=e[r];return n||(n=e[r]=t.length,t.push(r),n)},str:function(e){return t[e]}}}(),c={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},u=a.extensions,f=io(0,u),l=P(),d=n.drawingBufferWidth,h=n.drawingBufferHeight,p={tick:0,time:0,viewportWidth:d,viewportHeight:h,framebufferWidth:d,framebufferHeight:h,drawingBufferWidth:d,drawingBufferHeight:h,pixelRatio:r.pixelRatio},m=function(e,t){var r=1;t.ext_texture_filter_anisotropic&&(r=e.getParameter(34047));var n=1,i=1;t.webgl_draw_buffers&&(n=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(H,a),e.texImage2D(H,0,X,1,1,0,X,W,null);var s=e.createFramebuffer();if(e.bindFramebuffer(Y,s),e.framebufferTexture2D(Y,36064,H,a,0),e.bindTexture(H,null),36053!==e.checkFramebufferStatus(Y))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var c=z.allocType(W,4);e.readPixels(0,0,1,1,X,W,c),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===c[0]),z.freeType(c)}}var u=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var f=e.createTexture(),l=z.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,f),e.texImage2D(34069,0,X,3,3,0,X,5121,l),z.freeType(l),e.bindTexture(34067,null),e.deleteTexture(f),u=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:r,maxDrawbuffers:n,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:u}}(n,u),v=de(n,c,r,(function(e){return g.destroyBuffer(e)})),g=kr(n,u,m,c,v),y=Se(n,u,v,c),b=function(e,r,n,i){var o={},a={};function s(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function c(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id)return void(e[r].location=t.location);e.push(t)}function u(t,n,i){var s=t===Pr?o:a,c=s[n];if(!c){var u=r.str(n);c=e.createShader(t),e.shaderSource(c,u),e.compileShader(c),N.shaderError(e,c,u,t,i),s[n]=c}return c}var f={},l=[],d=0;function h(e,t){this.id=d++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(t,n,o){var a,f,l=u(Pr,t.fragId),d=u(Fr,t.vertId),h=t.program=e.createProgram();if(e.attachShader(h,l),e.attachShader(h,d),o)for(a=0;a<o.length;++a){var p=o[a];e.bindAttribLocation(h,p[0],p[1])}e.linkProgram(h),N.linkError(e,h,r.str(t.fragId),r.str(t.vertId),n);var m=e.getProgramParameter(h,jr);i.profile&&(t.stats.uniformsCount=m);var v=t.uniforms;for(a=0;a<m;++a)if(f=e.getActiveUniform(h,a))if(f.size>1)for(var g=0;g<f.size;++g){var y=f.name.replace("[0]","["+g+"]");c(v,new s(y,r.id(y),e.getUniformLocation(h,y),f))}else c(v,new s(f.name,r.id(f.name),e.getUniformLocation(h,f.name),f));var b=e.getProgramParameter(h,Ur);i.profile&&(t.stats.attributesCount=b);var E=t.attributes;for(a=0;a<b;++a)(f=e.getActiveAttrib(h,a))&&c(E,new s(f.name,r.id(f.name),e.getAttribLocation(h,f.name),f))}return i.profile&&(n.getMaxUniformsCount=function(){var e=0;return l.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},n.getMaxAttributesCount=function(){var e=0;return l.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);K(o).forEach(t),o={},K(a).forEach(t),a={},l.forEach((function(t){e.deleteProgram(t.program)})),l.length=0,f={},n.shaderCount=0},program:function(r,i,s,c){N.command(r>=0,"missing vertex shader",s),N.command(i>=0,"missing fragment shader",s);var u=f[i];u||(u=f[i]={});var d=u[r];if(d&&(d.refCount++,!c))return d;var m=new h(i,r);return n.shaderCount++,p(m,s,c),d||(u[r]=m),l.push(m),t(m,{destroy:function(){if(m.refCount--,m.refCount<=0){e.deleteProgram(m.program);var t=l.indexOf(m);l.splice(t,1),n.shaderCount--}u[m.vertId].refCount<=0&&(e.deleteShader(a[m.vertId]),delete a[m.vertId],delete f[m.fragId][m.vertId]),Object.keys(f[m.fragId]).length||(e.deleteShader(o[m.fragId]),delete o[m.fragId],delete f[m.fragId])}})},restore:function(){o={},a={};for(var e=0;e<l.length;++e)p(l[e],null,l[e].attributes.map((function(e){return[e.location,e.name]})))},shader:u,frag:-1,vert:-1}}(n,s,c,r),E=ur(n,u,m,(function(){w.procs.poll()}),p,c,r),_=function(e,t,r,n,i){var o={rgba4:lr,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach((function(e){var t=o[e];a[t]=e}));var s=0,c={};function u(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=lr,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function f(t){var r=t.renderbuffer;N(r,"must not double destroy renderbuffer"),e.bindRenderbuffer(fr,null),e.deleteRenderbuffer(r),t.renderbuffer=null,t.refCount=0,delete c[t.id],n.renderbufferCount--}return u.prototype.decRef=function(){--this.refCount<=0&&f(this)},i.profile&&(n.getTotalRenderbufferSize=function(){var e=0;return Object.keys(c).forEach((function(t){e+=c[t].stats.size})),e}),{create:function(t,s){var f=new u(e.createRenderbuffer());function l(t,n){var s=0,c=0,u=lr;if("object"==typeof t&&t){var d=t;if("shape"in d){var h=d.shape;N(Array.isArray(h)&&h.length>=2,"invalid renderbuffer shape"),s=0|h[0],c=0|h[1]}else"radius"in d&&(s=c=0|d.radius),"width"in d&&(s=0|d.width),"height"in d&&(c=0|d.height);"format"in d&&(N.parameter(d.format,o,"invalid renderbuffer format"),u=o[d.format])}else"number"==typeof t?(s=0|t,c="number"==typeof n?0|n:s):t?N.raise("invalid arguments to renderbuffer constructor"):s=c=1;if(N(s>0&&c>0&&s<=r.maxRenderbufferSize&&c<=r.maxRenderbufferSize,"invalid renderbuffer size"),s!==f.width||c!==f.height||u!==f.format)return l.width=f.width=s,l.height=f.height=c,f.format=u,e.bindRenderbuffer(fr,f.renderbuffer),e.renderbufferStorage(fr,u,s,c),N(0===e.getError(),"invalid render buffer format"),i.profile&&(f.stats.size=hr(f.format,f.width,f.height)),l.format=a[f.format],l}return c[f.id]=f,n.renderbufferCount++,l(t,s),l.resize=function(t,n){var o=0|t,a=0|n||o;return o===f.width&&a===f.height||(N(o>0&&a>0&&o<=r.maxRenderbufferSize&&a<=r.maxRenderbufferSize,"invalid renderbuffer size"),l.width=f.width=o,l.height=f.height=a,e.bindRenderbuffer(fr,f.renderbuffer),e.renderbufferStorage(fr,f.format,o,a),N(0===e.getError(),"invalid render buffer format"),i.profile&&(f.stats.size=hr(f.format,f.width,f.height))),l},l._reglType="renderbuffer",l._renderbuffer=f,i.profile&&(l.stats=f.stats),l.destroy=function(){f.decRef()},l},clear:function(){K(c).forEach(f)},restore:function(){K(c).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(fr,t.renderbuffer),e.renderbufferStorage(fr,t.format,t.width,t.height)})),e.bindRenderbuffer(fr,null)}}}(n,u,m,c,r),A=function(e,r,n,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},c=["rgba"],u=["rgba4","rgb565","rgb5 a1"];r.ext_srgb&&u.push("srgba"),r.ext_color_buffer_half_float&&u.push("rgba16f","rgb16f"),r.webgl_color_buffer_float&&u.push("rgba32f");var f=["uint8"];function l(e,t,r){this.target=e,this.texture=t,this.renderbuffer=r;var n=0,i=0;t?(n=t.width,i=t.height):r&&(n=r.width,i=r.height),this.width=n,this.height=i}function d(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function h(e,t,r){if(e)if(e.texture){var n=e.texture._texture,i=Math.max(1,n.width),o=Math.max(1,n.height);N(i===t&&o===r,"inconsistent width/height for supplied texture"),n.refCount+=1}else{var a=e.renderbuffer._renderbuffer;N(a.width===t&&a.height===r,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function p(t,r){r&&(r.texture?e.framebufferTexture2D(pr,t,r.target,r.texture._texture.texture,0):e.framebufferRenderbuffer(pr,t,mr,r.renderbuffer._renderbuffer.renderbuffer))}function m(e){var t=vr,r=null,n=null,i=e;"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),N.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(r=i,N(t===vr)):"textureCube"===o?(r=i,N(t>=gr&&t<gr+6,"invalid cube map target")):"renderbuffer"===o?(n=i,t=mr):N.raise("invalid regl object for attachment"),new l(t,r,n)}function v(e,t,r,n,a){if(r){var s=i.create2D({width:e,height:t,format:n,type:a});return s._texture.refCount=0,new l(vr,s,null)}var c=o.create({width:e,height:t,format:n});return c._renderbuffer.refCount=0,new l(mr,null,c)}function g(e){return e&&(e.texture||e.renderbuffer)}function y(e,t,r){e&&(e.texture?e.texture.resize(t,r):e.renderbuffer&&e.renderbuffer.resize(t,r),e.width=t,e.height=r)}r.oes_texture_half_float&&f.push("half float","float16"),r.oes_texture_float&&f.push("float","float32");var b=0,E={};function _(){this.id=b++,E[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function A(e){e.colorAttachments.forEach(d),d(e.depthAttachment),d(e.stencilAttachment),d(e.depthStencilAttachment)}function w(t){var r=t.framebuffer;N(r,"must not double destroy framebuffer"),e.deleteFramebuffer(r),t.framebuffer=null,a.framebufferCount--,delete E[t.id]}function T(t){var r;e.bindFramebuffer(pr,t.framebuffer);var i=t.colorAttachments;for(r=0;r<i.length;++r)p(yr+r,i[r]);for(r=i.length;r<n.maxColorAttachments;++r)e.framebufferTexture2D(pr,yr+r,vr,null,0);e.framebufferTexture2D(pr,_r,vr,null,0),e.framebufferTexture2D(pr,br,vr,null,0),e.framebufferTexture2D(pr,Er,vr,null,0),p(br,t.depthAttachment),p(Er,t.stencilAttachment),p(_r,t.depthStencilAttachment);var o=e.checkFramebufferStatus(pr);e.isContextLost()||o===Ar||N.raise("framebuffer configuration not supported, status = "+Cr[o]),e.bindFramebuffer(pr,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function x(e,i){var o=new _;function l(e,t){var i;N(s.next!==o,"can not update framebuffer which is currently in use");var a=0,d=0,p=!0,y=!0,b=null,E=!0,_="rgba",w="uint8",x=1,S=null,R=null,O=null,I=!1;if("number"==typeof e)a=0|e,d=0|t||a;else if(e){N.type(e,"object","invalid arguments for framebuffer");var C=e;if("shape"in C){var L=C.shape;N(Array.isArray(L)&&L.length>=2,"invalid shape for framebuffer"),a=L[0],d=L[1]}else"radius"in C&&(a=d=C.radius),"width"in C&&(a=C.width),"height"in C&&(d=C.height);("color"in C||"colors"in C)&&(b=C.color||C.colors,Array.isArray(b)&&N(1===b.length||r.webgl_draw_buffers,"multiple render targets not supported")),b||("colorCount"in C&&(x=0|C.colorCount,N(x>0,"invalid color buffer count")),"colorTexture"in C&&(E=!!C.colorTexture,_="rgba4"),"colorType"in C&&(w=C.colorType,E?(N(r.oes_texture_float||!("float"===w||"float32"===w),"you must enable OES_texture_float in order to use floating point framebuffer objects"),N(r.oes_texture_half_float||!("half float"===w||"float16"===w),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===w||"float16"===w?(N(r.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),_="rgba16f"):"float"!==w&&"float32"!==w||(N(r.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),_="rgba32f"),N.oneOf(w,f,"invalid color type")),"colorFormat"in C&&(_=C.colorFormat,c.indexOf(_)>=0?E=!0:u.indexOf(_)>=0?E=!1:E?N.oneOf(C.colorFormat,c,"invalid color format for texture"):N.oneOf(C.colorFormat,u,"invalid color format for renderbuffer"))),("depthTexture"in C||"depthStencilTexture"in C)&&(I=!(!C.depthTexture&&!C.depthStencilTexture),N(!I||r.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in C&&("boolean"==typeof C.depth?p=C.depth:(S=C.depth,y=!1)),"stencil"in C&&("boolean"==typeof C.stencil?y=C.stencil:(R=C.stencil,p=!1)),"depthStencil"in C&&("boolean"==typeof C.depthStencil?p=y=C.depthStencil:(O=C.depthStencil,p=!1,y=!1))}else a=d=1;var M=null,D=null,k=null,P=null;if(Array.isArray(b))M=b.map(m);else if(b)M=[m(b)];else for(M=new Array(x),i=0;i<x;++i)M[i]=v(a,d,E,_,w);N(r.webgl_draw_buffers||M.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),N(M.length<=n.maxColorAttachments,"too many color attachments, not supported"),a=a||M[0].width,d=d||M[0].height,S?D=m(S):p&&!y&&(D=v(a,d,I,"depth","uint32")),R?k=m(R):y&&!p&&(k=v(a,d,!1,"stencil","uint8")),O?P=m(O):!S&&!R&&y&&p&&(P=v(a,d,I,"depth stencil","depth stencil")),N(!!S+!!R+!!O<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var F=null;for(i=0;i<M.length;++i)if(h(M[i],a,d),N(!M[i]||M[i].texture&&Tr.indexOf(M[i].texture._texture.format)>=0||M[i].renderbuffer&&Ir.indexOf(M[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),M[i]&&M[i].texture){var j=xr[M[i].texture._texture.format]*Sr[M[i].texture._texture.type];null===F?F=j:N(F===j,"all color attachments much have the same number of bits per pixel.")}return h(D,a,d),N(!D||D.texture&&D.texture._texture.format===wr||D.renderbuffer&&D.renderbuffer._renderbuffer.format===Rr,"invalid depth attachment for framebuffer object"),h(k,a,d),N(!k||k.renderbuffer&&k.renderbuffer._renderbuffer.format===Nr,"invalid stencil attachment for framebuffer object"),h(P,a,d),N(!P||P.texture&&P.texture._texture.format===Or||P.renderbuffer&&P.renderbuffer._renderbuffer.format===Or,"invalid depth-stencil attachment for framebuffer object"),A(o),o.width=a,o.height=d,o.colorAttachments=M,o.depthAttachment=D,o.stencilAttachment=k,o.depthStencilAttachment=P,l.color=M.map(g),l.depth=g(D),l.stencil=g(k),l.depthStencil=g(P),l.width=o.width,l.height=o.height,T(o),l}return a.framebufferCount++,l(e,i),t(l,{resize:function(e,t){N(s.next!==o,"can not resize a framebuffer which is currently in use");var r=Math.max(0|e,1),n=Math.max(0|t||r,1);if(r===o.width&&n===o.height)return l;for(var i=o.colorAttachments,a=0;a<i.length;++a)y(i[a],r,n);return y(o.depthAttachment,r,n),y(o.stencilAttachment,r,n),y(o.depthStencilAttachment,r,n),o.width=l.width=r,o.height=l.height=n,T(o),l},_reglType:"framebuffer",_framebuffer:o,destroy:function(){w(o),A(o)},use:function(e){s.setFBO({framebuffer:l},e)}})}return t(s,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof _)return t}return null},create:x,createCube:function(e){var o=Array(6);function a(e){var n;N(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var u,l={color:null},d=0,h=null,p="rgba",m="uint8",v=1;if("number"==typeof e)d=0|e;else if(e){N.type(e,"object","invalid arguments for framebuffer");var g=e;if("shape"in g){var y=g.shape;N(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),N(y[0]===y[1],"cube framebuffer must be square"),d=y[0]}else"radius"in g&&(d=0|g.radius),"width"in g?(d=0|g.width,"height"in g&&N(g.height===d,"must be square")):"height"in g&&(d=0|g.height);("color"in g||"colors"in g)&&(h=g.color||g.colors,Array.isArray(h)&&N(1===h.length||r.webgl_draw_buffers,"multiple render targets not supported")),h||("colorCount"in g&&(v=0|g.colorCount,N(v>0,"invalid color buffer count")),"colorType"in g&&(N.oneOf(g.colorType,f,"invalid color type"),m=g.colorType),"colorFormat"in g&&(p=g.colorFormat,N.oneOf(g.colorFormat,c,"invalid color format for texture"))),"depth"in g&&(l.depth=g.depth),"stencil"in g&&(l.stencil=g.stencil),"depthStencil"in g&&(l.depthStencil=g.depthStencil)}else d=1;if(h)if(Array.isArray(h))for(u=[],n=0;n<h.length;++n)u[n]=h[n];else u=[h];else{u=Array(v);var b={radius:d,format:p,type:m};for(n=0;n<v;++n)u[n]=i.createCube(b)}for(l.color=Array(u.length),n=0;n<u.length;++n){var E=u[n];N("function"==typeof E&&"textureCube"===E._reglType,"invalid cube map"),d=d||E.width,N(E.width===d&&E.height===d,"invalid cube map shape"),l.color[n]={target:gr,data:u[n]}}for(n=0;n<6;++n){for(var _=0;_<u.length;++_)l.color[_].target=gr+n;n>0&&(l.depth=o[0].depth,l.stencil=o[0].stencil,l.depthStencil=o[0].depthStencil),o[n]?o[n](l):o[n]=x(l)}return t(a,{width:d,height:d,color:u})}return a(e),t(a,{faces:o,resize:function(e){var t,r=0|e;if(N(r>0&&r<=n.maxCubeMapSize,"invalid radius for cube fbo"),r===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(r);for(t=0;t<6;++t)o[t].resize(r);return a.width=a.height=r,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(e){e.destroy()}))}})},clear:function(){K(E).forEach(w)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,K(E).forEach((function(t){t.framebuffer=e.createFramebuffer(),T(t)}))}})}(n,u,m,E,_,c),w=no(n,s,u,m,v,y,0,A,{},g,b,{elements:null,primitive:4,count:-1,offset:0,instances:-1},p,f,r),T=Hr(n,A,w.procs.poll,p,i,u,m),x=w.next,S=n.canvas,R=[],O=[],I=[],C=[r.onDestroy],L=null;function M(){if(0===R.length)return f&&f.update(),void(L=null);L=k.next(M),te();for(var e=R.length-1;e>=0;--e){var t=R[e];t&&t(p,null,0)}n.flush(),f&&f.update()}function B(){!L&&R.length>0&&(L=k.next(M))}function G(){L&&(k.cancel(M),L=null)}function V(e){e.preventDefault(),o=!0,G(),O.forEach((function(e){e()}))}function Q(e){n.getError(),o=!1,a.restore(),b.restore(),v.restore(),E.restore(),_.restore(),A.restore(),g.restore(),f&&f.restore(),w.procs.refresh(),B(),I.forEach((function(e){e()}))}function q(e){function r(e,t){var r={},n={};return Object.keys(e).forEach((function(i){var o=e[i];if(D.isDynamic(o))n[i]=D.unbox(o,i);else{if(t&&Array.isArray(o))for(var a=0;a<o.length;++a)if(D.isDynamic(o[a]))return void(n[i]=D.unbox(o,i));r[i]=o}})),{dynamic:n,static:r}}N(!!e,"invalid args to regl({...})"),N.type(e,"object","invalid args to regl({...})");var n=r(e.context||{},!0),i=r(e.uniforms||{},!0),a=r(e.attributes||{},!1),s=r(function(e){var r=t({},e);function n(e){if(e in r){var t=r[e];delete r[e],Object.keys(t).forEach((function(n){r[e+"."+n]=t[n]}))}}return delete r.uniforms,delete r.attributes,delete r.context,delete r.vao,"stencil"in r&&r.stencil.op&&(r.stencil.opBack=r.stencil.opFront=r.stencil.op,delete r.stencil.op),n("blend"),n("depth"),n("cull"),n("stencil"),n("polygonOffset"),n("scissor"),n("sample"),"vao"in e&&(r.vao=e.vao),r}(e),!1),c={gpuTime:0,cpuTime:0,count:0},u=w.compile(s,a,i,n,c),f=u.draw,l=u.batch,d=u.scope,h=[];return t((function(e,t){var r;if(o&&N.raise("context lost"),"function"==typeof e)return d.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(r=0;r<e;++r)d.call(this,null,t,r);else{if(!Array.isArray(e))return d.call(this,e,t,0);for(r=0;r<e.length;++r)d.call(this,e[r],t,r)}else if("number"==typeof e){if(e>0)return l.call(this,function(e){for(;h.length<e;)h.push(null);return h}(0|e),0|e)}else{if(!Array.isArray(e))return f.call(this,e);if(e.length)return l.call(this,e,e.length)}}),{stats:c,destroy:function(){u.destroy()}})}S&&(S.addEventListener(oo,V,!1),S.addEventListener(ao,Q,!1));var $=A.setFBO=q({framebuffer:D.define.call(null,1,"framebuffer")});function Z(e,t){var r=0;w.procs.poll();var i=t.color;i&&(n.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),r|=16384),"depth"in t&&(n.clearDepth(+t.depth),r|=256),"stencil"in t&&(n.clearStencil(0|t.stencil),r|=1024),N(!!r,"called regl.clear with no buffer specified"),n.clear(r)}function J(e){return N.type(e,"function","regl.frame() callback must be a function"),R.push(e),B(),{cancel:function(){var t=so(R,e);N(t>=0,"cannot cancel a frame twice"),R[t]=function e(){var t=so(R,e);R[t]=R[R.length-1],R.length-=1,R.length<=0&&G()}}}}function ee(){var e=x.viewport,t=x.scissor_box;e[0]=e[1]=t[0]=t[1]=0,p.viewportWidth=p.framebufferWidth=p.drawingBufferWidth=e[2]=t[2]=n.drawingBufferWidth,p.viewportHeight=p.framebufferHeight=p.drawingBufferHeight=e[3]=t[3]=n.drawingBufferHeight}function te(){p.tick+=1,p.time=ne(),ee(),w.procs.poll()}function re(){E.refresh(),ee(),w.procs.refresh(),f&&f.update()}function ne(){return(P()-l)/1e3}re();var ie=t(q,{clear:function(e){if(N("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var r=0;r<6;++r)$(t({framebuffer:e.framebuffer.faces[r]},e),Z);else $(e,Z);else Z(0,e)},prop:D.define.bind(null,1),context:D.define.bind(null,2),this:D.define.bind(null,3),draw:q({}),buffer:function(e){return v.create(e,34962,!1,!1)},elements:function(e){return y.create(e,!1)},texture:E.create2D,cube:E.createCube,renderbuffer:_.create,framebuffer:A.create,framebufferCube:A.createCube,vao:g.createVAO,attributes:i,frame:J,on:function(e,t){var r;switch(N.type(t,"function","listener callback must be a function"),e){case"frame":return J(t);case"lost":r=O;break;case"restore":r=I;break;case"destroy":r=C;break;default:N.raise("invalid event, must be one of frame,lost,restore,destroy")}return r.push(t),{cancel:function(){for(var e=0;e<r.length;++e)if(r[e]===t)return r[e]=r[r.length-1],void r.pop()}}},limits:m,hasExtension:function(e){return m.extensions.indexOf(e.toLowerCase())>=0},read:T,destroy:function(){R.length=0,G(),S&&(S.removeEventListener(oo,V),S.removeEventListener(ao,Q)),b.clear(),A.clear(),_.clear(),E.clear(),y.clear(),v.clear(),g.clear(),f&&f.clear(),C.forEach((function(e){e()}))},_gl:n,_refresh:re,poll:function(){te(),f&&f.update()},now:ne,stats:c});return r.onDone(null,ie),ie}}()})),wc(xc={},Ac.POINTS,"points"),wc(xc,Ac.LINES,"lines"),wc(xc,Ac.LINE_LOOP,"line loop"),wc(xc,Ac.LINE_STRIP,"line strip"),wc(xc,Ac.TRIANGLES,"triangles"),wc(xc,Ac.TRIANGLE_FAN,"triangle fan"),wc(xc,Ac.TRIANGLE_STRIP,"triangle strip"),wc(jc={},Ac.STATIC_DRAW,"static"),wc(jc,Ac.DYNAMIC_DRAW,"dynamic"),wc(jc,Ac.STREAM_DRAW,"stream"),wc(Sc={},Ac.BYTE,"int8"),wc(Sc,Ac.UNSIGNED_INT,"int16"),wc(Sc,Ac.INT,"int32"),wc(Sc,Ac.UNSIGNED_BYTE,"uint8"),wc(Sc,Ac.UNSIGNED_SHORT,"uint16"),wc(Sc,Ac.UNSIGNED_INT,"uint32"),wc(Sc,Ac.FLOAT,"float"),wc(Nc={},Ac.ALPHA,"alpha"),wc(Nc,Ac.LUMINANCE,"luminance"),wc(Nc,Ac.LUMINANCE_ALPHA,"luminance alpha"),wc(Nc,Ac.RGB,"rgb"),wc(Nc,Ac.RGBA,"rgba"),wc(Nc,Ac.RGBA4,"rgba4"),wc(Nc,Ac.RGB5_A1,"rgb5 a1"),wc(Nc,Ac.RGB565,"rgb565"),wc(Nc,Ac.DEPTH_COMPONENT,"depth"),wc(Nc,Ac.DEPTH_STENCIL,"depth stencil"),wc(Ic={},Ac.DONT_CARE,"dont care"),wc(Ic,Ac.NICEST,"nice"),wc(Ic,Ac.FASTEST,"fast"),wc(Mc={},Ac.NEAREST,"nearest"),wc(Mc,Ac.LINEAR,"linear"),wc(Mc,Ac.LINEAR_MIPMAP_LINEAR,"mipmap"),wc(Mc,Ac.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),wc(Mc,Ac.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),wc(Mc,Ac.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),wc(Cc={},Ac.REPEAT,"repeat"),wc(Cc,Ac.CLAMP_TO_EDGE,"clamp"),wc(Cc,Ac.MIRRORED_REPEAT,"mirror"),wc(Lc={},Ac.NONE,"none"),wc(Lc,Ac.BROWSER_DEFAULT_WEBGL,"browser"),wc(kc={},Ac.NEVER,"never"),wc(kc,Ac.ALWAYS,"always"),wc(kc,Ac.LESS,"less"),wc(kc,Ac.LEQUAL,"lequal"),wc(kc,Ac.GREATER,"greater"),wc(kc,Ac.GEQUAL,"gequal"),wc(kc,Ac.EQUAL,"equal"),wc(kc,Ac.NOTEQUAL,"notequal"),wc(Uc={},Ac.FUNC_ADD,"add"),wc(Uc,Ac.MIN_EXT,"min"),wc(Uc,Ac.MAX_EXT,"max"),wc(Uc,Ac.FUNC_SUBTRACT,"subtract"),wc(Uc,Ac.FUNC_REVERSE_SUBTRACT,"reverse subtract"),wc(Fc={},Ac.ZERO,"zero"),wc(Fc,Ac.ONE,"one"),wc(Fc,Ac.SRC_COLOR,"src color"),wc(Fc,Ac.ONE_MINUS_SRC_COLOR,"one minus src color"),wc(Fc,Ac.SRC_ALPHA,"src alpha"),wc(Fc,Ac.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),wc(Fc,Ac.DST_COLOR,"dst color"),wc(Fc,Ac.ONE_MINUS_DST_COLOR,"one minus dst color"),wc(Fc,Ac.DST_ALPHA,"dst alpha"),wc(Fc,Ac.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),wc(Fc,Ac.CONSTANT_COLOR,"constant color"),wc(Fc,Ac.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),wc(Fc,Ac.CONSTANT_ALPHA,"constant alpha"),wc(Fc,Ac.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),wc(Fc,Ac.SRC_ALPHA_SATURATE,"src alpha saturate"),wc(Bc={},Ac.NEVER,"never"),wc(Bc,Ac.ALWAYS,"always"),wc(Bc,Ac.LESS,"less"),wc(Bc,Ac.LEQUAL,"lequal"),wc(Bc,Ac.GREATER,"greater"),wc(Bc,Ac.GEQUAL,"gequal"),wc(Bc,Ac.EQUAL,"equal"),wc(Bc,Ac.NOTEQUAL,"notequal"),wc(Dc={},Ac.ZERO,"zero"),wc(Dc,Ac.KEEP,"keep"),wc(Dc,Ac.REPLACE,"replace"),wc(Dc,Ac.INVERT,"invert"),wc(Dc,Ac.INCR,"increment"),wc(Dc,Ac.DECR,"decrement"),wc(Dc,Ac.INCR_WRAP,"increment wrap"),wc(Dc,Ac.DECR_WRAP,"decrement wrap"),wc(Pc={},Ac.FRONT,"front"),wc(Pc,Ac.BACK,"back");var Gc=N((function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports})),Vc=N((function(e){e.exports=function(e){if(Array.isArray(e))return Gc(e)},e.exports.__esModule=!0,e.exports.default=e.exports})),Xc=N((function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports})),zc=N((function(e){e.exports=function(e,t){if(e){if("string"==typeof e)return Gc(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Gc(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports})),Hc=N((function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports}));N((function(e){e.exports=function(e){return Vc(e)||Xc(e)||zc(e)||Hc()},e.exports.__esModule=!0,e.exports.default=e.exports}));var Wc=Function.prototype,$c=Wc.toString;$c.call(Object);const Yc=".x6-graph-scroller{width:calc(100vw - var(--workflow-editor-width) - var(--activity-picker-width)) !important}.x6-graph-scroller.x6-graph-scroller-pannable[data-panning=false]{cursor:default}.x6-widget-selection-box{box-sizing:content-box !important;margin-top:-4px;margin-left:-4px;padding-right:4px;padding-bottom:4px;border:2px dashed #34D399;box-shadow:none}.x6-widget-selection-inner{box-sizing:content-box !important;margin-top:-8px;margin-left:-8px;padding-right:12px;padding-bottom:12px;border:2px solid #34D399;box-shadow:none}",qc="Elsa.Flowchart",Kc=class{constructor(e){t(this,e),this.activitySelected=n(this,"activitySelected",7),this.activityDeleted=n(this,"activityDeleted",7),this.containerSelected=n(this,"containerSelected",7),this.childActivitySelected=n(this,"childActivitySelected",7),this.graphUpdated=n(this,"graphUpdated",7),this.getFlowchartDescriptor=()=>this.getActivityDescriptor(qc,1),this.createFlowchart=async()=>{const e=this.getFlowchartDescriptor(),t=await this.generateUniqueActivityName(e);return{type:e.typeName,version:e.version,id:t,start:null,activities:[],connections:[],metadata:{},variables:[],customProperties:{},canStartWorkflow:!1}},this.createAndInitializeGraph=async()=>{const e=this.graph=U(this.container,{nodeMovable:()=>this.interactiveMode,edgeMovable:()=>this.interactiveMode,arrowheadMovable:()=>this.interactiveMode,edgeLabelMovable:()=>this.interactiveMode,magnetConnectable:()=>this.interactiveMode,useEdgeTools:()=>this.interactiveMode,toolsAddable:()=>this.interactiveMode,stopDelegateOnDragging:()=>this.interactiveMode,vertexAddable:()=>this.interactiveMode,vertexDeletable:()=>this.interactiveMode,vertexMovable:()=>this.interactiveMode},this.getAllActivities);e.on("blank:click",this.onGraphClick),e.on("node:selected",this.onNodeSelected),e.on("node:contextmenu",this.onNodeContextMenu),e.on("edge:connected",this.onEdgeConnected),e.on("node:moved",this.onNodeMoved),e.on("node:moved",this.onGraphChanged),e.on("node:added",this.onNodeAdded),e.on("node:removed",this.onNodeRemoved),e.on("edge:added",this.onGraphChanged),e.on("edge:removed",this.onGraphChanged),e.on("edge:connected",this.onGraphChanged),await this.updateLayout()},this.getCurrentActivity=()=>{const e=this.activityLookup,t=this.path;return t.length>0?e[t[t.length-1].activityId]:this.rootActivity},this.getCurrentFlowchartActivity=async()=>{const e=this.path;let t=this.getCurrentActivity();if(e.length>0){const r=e[e.length-1];return this.resolvePort(t,r.portName)}return t},this.resolvePort=(e,t)=>{const r=this.portProviderRegistry.get(e.type),n=R.activityDescriptors.find((t=>t.typeName==e.type));return r.resolvePort(t,{activity:e,activityDescriptor:n})},this.setPort=(e,t,r)=>{const n=this.portProviderRegistry.get(e.type),i=R.activityDescriptors.find((t=>t.typeName==e.type));n.assignPort(t,r,{activity:e,activityDescriptor:i}),this.updateLookups()},this.updateModel=async()=>{const e=this.getFlowchartModel(),t=await this.getCurrentFlowchartActivity();t.activities=e.activities,t.connections=e.connections,t.start=e.start,this.updateLookups()},this.exportInternal=()=>this.rootActivity,this.getActivityDescriptor=(e,t)=>R.activityDescriptors.find((r=>r.typeName==e&&r.version==t)),this.setupGraph=async e=>{const t=e.activities,r=e.connections;this.updateGraphInternal(t,r),this.isReadonly&&(this.graph.disableSelectionMovable(),this.graph.disableKeyboard())},this.updateGraphInternal=(e,t)=>{const r=[],n=e.map((e=>{var t;const r=(null===(t=e.metadata.designer)||void 0===t?void 0:t.position)||{x:100,y:100},{x:n,y:i}=r,o=this.getActivityDescriptor(e.type,e.version);return this.nodeFactory.createNode(o,e,n,i)}));for(const e of t){const t=this.createEdge(e);r.push(t)}const i={nodes:n,edges:r};this.graph.freeze(),this.graph.fromJSON(i,{silent:!1}),this.graph.unfreeze(),w(this.graph),this.graph.scrollToContent()},this.getFlowchartModel=()=>{const e=this.graph.toJSON(),t=e.cells.filter((e=>"activity"==e.shape)).map((e=>e.data)),r=e.cells.filter((e=>"elsa-edge"==e.shape&&!!e.data)).map((e=>e.data));let n=t.filter((e=>!(null!=r.find((t=>t.target.activity==e.id)))));const i=n.find((e=>e.canStartWorkflow))||a.first(n);return{activities:t,connections:r,start:null==i?void 0:i.id}},this.createEdge=e=>({shape:"elsa-edge",zIndex:-1,data:e,source:e.source.activity,target:e.target.activity,sourcePort:e.source.port,targetPort:e.target.port}),this.syncEdgeData=(e,t)=>{const r=this.graph.model.getEdges().filter((e=>"elsa-edge"==e.shape&&!!e.data));for(const n of r){const r=n.data;r.target.activity!=e&&r.source.activity!=e||(r.target.activity==e&&(r.target.activity=t.id),r.source.activity==e&&(r.source.activity=t.id),n.data=r)}},this.updateLookups=()=>{const e=O(this.rootActivity),t=x(e);this.activities=t.map((e=>e.activity)),this.activityLookup=j(t)},this.generateUniqueActivityName=async e=>await l(this.activities,e),this.getAllActivities=()=>this.activities,this.onGraphClick=async e=>{const t={activity:await this.getCurrentFlowchartActivity()};return this.containerSelected.emit(t)},this.onNodeSelected=async e=>{const t=e.node.activity,r={activity:this.activityLookup[t.id]};this.activitySelected.emit(r)},this.onNodeContextMenu=async e=>{const t=e.node,r=[{text:"Startable",handler:()=>this.onToggleCanStartWorkflowClicked(t),isToggle:!0,checked:e.node.data.canStartWorkflow},{text:"Cut",handler:()=>this.onCutActivityClicked(t)},{text:"Copy",handler:()=>this.onCopyActivityClicked(t)},{text:"Delete",handler:()=>this.onDeleteActivityClicked(t)}];this.activityContextMenu.menuItems=this.isReadonly?[]:r;const n=this.graph.localToClient(e.x,e.y),i=this.graph.getScrollbarPosition();this.activityContextMenu.style.top=`${n.y}px`,this.activityContextMenu.style.left=e.x-i.left+"px",await this.activityContextMenu.open()},this.onNodeMoved=e=>{const t=e.node,r=t.data,n=t.position({relative:!1});r.metadata=Object.assign(Object.assign({},r.metadata),{designer:Object.assign(Object.assign({},r.metadata.designer),{position:{x:n.x,y:n.y}})})},this.onEdgeConnected=async e=>{const t=e.edge,r=t.getSourceNode(),n=t.getTargetNode(),i=t.getSourceNode().data,o=n.data,a=r.getPort(t.getSourcePortId()).id,s=n.getPort(t.getTargetPortId()).id,c={source:{activity:i.id,port:a},target:{activity:o.id,port:s}};t.data=c;const u={graph:this.graph,connection:c,sourceNode:r,targetNode:n,sourceActivity:i,targetActivity:o,edge:t};await this.eventBus.emit(H.ConnectionCreated,this,u)},this.onGraphChanged=async e=>{await this.updateModel(),this.graphUpdated.emit()},this.onNodeRemoved=async e=>{const t=e.node.data;this.activityDeleted.emit({activity:t}),await this.onGraphChanged(e)},this.onNodeAdded=async e=>{const t=e.node;if(!t.isClone){const e=Object.assign({},t.getData()),r=this.getActivityDescriptor(e.type,e.version);e.id=await this.generateUniqueActivityName(r),t.activity=Object.assign({},e)}await this.onGraphChanged(e)},this.onToggleCanStartWorkflowClicked=e=>{const t=e.data;t.canStartWorkflow=!t.canStartWorkflow,e.activity=Object.assign({},t)},this.onDeleteActivityClicked=e=>{let t=this.graph.getSelectedCells();0==t.length&&(t=[e]),this.graph.removeCells(t);for(const r of t){const t=e.data;this.activityDeleted.emit({activity:t})}},this.onCopyActivityClicked=e=>{let t=this.graph.getSelectedCells();0==t.length&&(t=[e]),this.graph.copy(t)},this.onCutActivityClicked=e=>{let t=this.graph.getSelectedCells();0==t.length&&(t=[e]),this.graph.cut(t);for(const r of t){const t=e.data;this.activityDeleted.emit({activity:t})}},this.onNavigateHierarchy=async e=>{const t=e.detail,r=this.path,n=r.indexOf(t);this.path=r.slice(0,n+1);const i=await this.getCurrentFlowchartActivity();await this.setupGraph(i),await this.scrollToStart()},this.updatePorts=(e,t)=>{const r=this.getActivityDescriptor(t.type,t.version),n=this.nodeFactory.createPorts(r,t),i=e.ports.items,o=n.filter((e=>!i.some((t=>g(t.id)==g(e.id))))),a=i.filter((e=>!n.some((t=>g(t.id)==g(e.id)))));o.length>0&&e.addPorts(o),a.length>0&&e.removePorts(a)},this.rootActivity=void 0,this.interactiveMode=!0,this.silent=!1,this.isReadonly=!1,this.activityLookup={},this.activities=[],this.path=[],this.eventBus=s.get(E),this.nodeFactory=s.get(z),this.portProviderRegistry=s.get(p)}async handleChildActivitySelected(e){this.childActivitySelected.emit(e.detail)}async newRoot(){const e=await this.createFlowchart();return await this.setupGraph(e),await this.scrollToStart(),e}async updateGraph(){const e=await this.getCurrentFlowchartActivity();await this.setupGraph(e)}async getGraph(){return this.graph}async reset(){this.graph.freeze(),this.graph.fromJSON({nodes:[],edges:[]},{silent:!1}),this.graph.unfreeze()}async updateLayout(){const e=this.el.clientWidth,t=this.el.clientHeight;this.graph.resize(e,t),this.graph.updateBackground()}async zoomToFit(){this.graph.zoomToFit()}async scrollToStart(){const e=this.getFlowchartModel();null!=e.activities.find((t=>t.id==e.start))&&this.graph.scrollToCell(this.graph.getCells()[0])}async autoLayout(e){const t=new qe({type:"dagre",rankdir:e,align:"UL",ranksep:30,nodesep:15,controlPoints:!0}),r=this.getFlowchartModel(),n=[],i=[];r.activities.forEach((e=>{const t=document.querySelectorAll('[activity-id="'+e.id+'"]')[0].getBoundingClientRect();n.push({id:e.id,size:{width:t.width,height:t.height},x:e.metadata.designer.position.x,y:e.metadata.designer.position.y})})),r.connections.forEach(((e,t)=>{i.push({id:t,source:e.source,target:e.target})}));let o={nodes:n,edges:i};t.layout(o).nodes.forEach((e=>{let t=e,n=r.activities.find((t=>t.id==e.id));n.metadata.designer.position.x=t.x,n.metadata.designer.position.y=t.y,this.updateActivity({id:n.id,originalId:n.id,activity:n})})),this.updateGraphInternal(r.activities,r.connections),this.graphUpdated.emit({})}async addActivity(e){var t;const r=this.graph,{descriptor:n,x:i,y:o}=e;let a=null!==(t=e.id)&&void 0!==t?t:await this.generateUniqueActivityName(n);const s=r.pageToLocal(i,o),c=s.x,u=s.y,f={id:a,type:n.typeName,version:n.version,customProperties:{},metadata:{designer:{position:{x:c,y:u}}}},l=this.nodeFactory.createNode(n,f,c,u);r.addNode(l,{merge:!0});const d=r.getNodes().find((e=>e.data.id==l.activity.id));return A(d),await this.updateModel(),f}async updateActivity(e){var t;const r=e.id,n=null!==(t=e.originalId)&&void 0!==t?t:r,i=e.activity,o=this.graph.getNodes().find((e=>e.data.id==n)),a=o;o&&(a.setData(i,{overwrite:!0}),a.activity=i,r!==n&&(this.syncEdgeData(n,i),await this.updateModel()),e.updatePorts&&this.updatePorts(o,i)),this.updateLookups()}async getActivity(e){return this.activityLookup[e]}async renameActivity(e){const t=e.originalId,r=e.activity,n=this.graph.getNodes().find((e=>e.data.id==t));n&&(n.setData(r,{overwrite:!0}),n.activity=r,r.id!==t&&(this.syncEdgeData(t,r),await this.updateModel()))}async export(){return this.exportInternal()}onActivityChanged(e){this.updateLookups()}async onInteractiveModeChange(e){const t=this.graph;!e||this.isReadonly?(t.disableSelectionMovable(),t.disableKeyboard()):(t.enableSelectionMovable(),t.enableKeyboard())}async editChildActivity(e){const t=e.detail.port.name,r={activityId:e.detail.parentActivityId,portName:t};this.path=[...this.path,r];const n=await this.getCurrentActivity();let i=await this.getCurrentFlowchartActivity();i||(i=await this.createFlowchart(),this.setPort(n,t,i)),await this.setupGraph(i)}async componentWillLoad(){this.updateLookups()}async componentDidLoad(){await this.createAndInitializeGraph(),await this.updateGraph()}render(){const e=this.path,t={nodeMap:this.activityLookup};return r(C.Provider,{state:t},r("div",{class:"tw-relative"},r("div",{class:"tw-absolute tw-left-0 tw-top-3 tw-z-10"},r("elsa-workflow-navigator",{items:e,rootActivity:this.rootActivity,onNavigate:this.onNavigateHierarchy})),r("div",{class:"tw-absolute tw-left-0 tw-top-0 tw-right-0 tw-bottom-0",ref:e=>this.container=e}),r("elsa-context-menu",{ref:e=>this.activityContextMenu=e,hideButton:!0,anchorPoint:S.TopLeft,class:"tw-absolute"})))}get el(){return e(this)}static get watchers(){return{rootActivity:["onActivityChanged"],interactiveMode:["onInteractiveModeChange"]}}};Kc.style=Yc;const Qc={[L.Right]:"LS/rightPanelWidth",[L.Left]:"LS/leftPanelWidth",[L.Bottom]:"LS/bottomPanelWidth"},Zc={[L.Right]:"--workflow-editor-width",[L.Left]:"--activity-picker-width",[L.Bottom]:"--activity-editor-height"},Jc={[L.Right]:580,[L.Left]:300,[L.Bottom]:200};function tl(e){return localStorage.getItem(Qc[e])||Jc[e]}function nl(e,t){return localStorage.setItem(Qc[e],t.toString())}function rl({position:e,isDefault:t,isHide:r,size:n}){const i=document.querySelector(":root");r?i.style.setProperty(Zc[e],"1px"):t?i.style.setProperty(Zc[e],`${tl(e)}px`):(i.style.setProperty(Zc[e],`${n}px`),nl(e,n))}const el=".panel-state-collapsed.panel-position-bottom{right:var(--workflow-editor-width);left:var(--activity-picker-width)}.panel-state-collapsed .panel-content-container{left:0;top:0;display:none}",il=class{constructor(e){t(this,e),this.expandedStateChanged=n(this,"expandedStateChanged",7),this.dragging=!1,this.onToggleClick=()=>{this.isExpanded?rl({position:this.position,isHide:!0}):rl({position:this.position,isDefault:!0}),this.isExpanded=!this.isExpanded,this.expandedStateChanged.emit({expanded:this.isExpanded})},this.onBodyMouseUp=()=>{this.dragging&&this.clearJSEvents()},this.resize=e=>{this.position===L.Right&&rl({position:L.Right,size:document.body.clientWidth-e.pageX}),this.position===L.Left&&rl({position:L.Left,size:e.pageX}),this.position===L.Bottom&&rl({position:L.Bottom,size:document.body.offsetHeight-e.pageY})},this.onDragBarMouseDown=e=>{e.preventDefault();const t=document.body;this.dragging=!0,t.addEventListener("mousemove",this.resize)},this.position=L.Left,this.isExpanded=!0}componentWillLoad(){document.addEventListener("mouseup",this.onBodyMouseUp),rl({position:this.position,isDefault:!0})}disconnectedCallback(){document.removeEventListener("mouseup",this.onBodyMouseUp)}clearJSEvents(){const e=document.body;this.dragging=!1,e.removeEventListener("mousemove",this.resize)}render(){const e=this.isExpanded,t=this.position,n=e?"panel-state-expanded":"panel-state-collapsed",o=[];o[L.Left]="panel-position-left tw-left-0 tw-top-0 tw-bottom-0 tw-border-r",o[L.Top]="panel-position-top tw-left-0 tw-top-0 tw-right-0 tw-border-b",o[L.Bottom]="panel-position-bottom h-0 tw-bottom-0 tw-border-t",o[L.Right]="panel-position-right tw-right-0 tw-top-0 tw-bottom-0 tw-border-l";const a=o[t],s={};s[L.Left]="elsa-panel-toggle-left",s[L.Top]="elsa-panel-toggle-top",s[L.Right]="elsa-panel-toggle-right",s[L.Bottom]="elsa-panel-toggle-bottom";const c=s[t],u=e?"tw-rotate-180":"",f={[L.Left]:"tw-right-0 tw-h-full tw-cursor-col-resize tw-w-1",[L.Right]:"tw-left-0 tw-h-full tw-cursor-col-resize tw-w-1",[L.Bottom]:"tw-top-0 tw-w-full tw-cursor-row-resize tw-h-1"}[this.position];return r(i,{class:`panel tw-absolute tw-bg-white tw-z-20 ${a} ${n}`},r("div",{class:`tw-absolute tw-opacity-0 tw-bg-blue-400 tw-transition tw-ease-in-out tw-duration-300 hover:tw-opacity-100 tw-z-10 ${f}`,onMouseDown:this.onDragBarMouseDown}),r("div",{class:"panel-content-container"},r("slot",null)),r("div",{class:`tw-text-white ${c}`,onClick:()=>this.onToggleClick()},r("svg",{class:`tw-h-6 tw-w-6 tw-text-gray-700 ${u}`,width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r("path",{stroke:"none",d:"M0 0h24v24H0z"}),r("polyline",{points:"9 6 15 12 9 18"}))))}};il.style=el;const al=class{constructor(e){t(this,e),this.navigate=n(this,"navigate",7),this.renderPathItem=(e,t,n)=>{const i=e.activityId,o=n.find((e=>e.activity.id==i)).activity,a=R.activityDescriptors.find((e=>e.typeName==o.type)),s=this.iconRegistry.getOrDefault(o.type)(),c=[],u=t==this.items.length-1,f=(e,t)=>{e.preventDefault(),this.onItemClick(t)};let l=null;if(e.portName){const t=this.portProviderRegistry.get(o.type).getOutboundPorts({activity:o,activityDescriptor:a});t.length>1&&(l=t.find((t=>t.name==e.portName)))}return u?c.push(r("li",null,r("div",{class:"tw-flex tw-items-center"},r("span",{class:"tw-block tw-flex tw-items-center tw-text-gray-500"},r("div",{class:"tw-bg-blue-500 tw-rounded"},s),r("span",{class:"tw-ml-4 tw-text-sm tw-font-medium tw-text-gray-500"},i)),l?r("svg",{class:"tw-ml-2 tw-flex-shrink-0 tw-h-5 tw-w-5 tw-text-gray-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},r("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})):void 0))):c.push(r("li",null,r("div",{class:"tw-flex tw-items-center"},r("a",{onClick:t=>f(t,e),href:"#",class:"tw-block tw-flex tw-items-center tw-text-gray-400 hover:tw-text-gray-500"},r("div",{class:"tw-bg-blue-500 tw-rounded"},s),r("span",{class:"tw-ml-4 tw-text-sm tw-font-medium tw-text-gray-500 hover:tw-text-gray-700"},i)),r("svg",{class:"tw-ml-2 tw-flex-shrink-0 tw-h-5 tw-w-5 tw-text-gray-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},r("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"}))))),l&&c.push(r("li",null,r("div",{class:"tw-flex tw-items-center"},r("span",{class:"tw-text-sm tw-font-medium tw-text-gray-500","aria-current":"page"},l.displayName)))),c},this.onItemClick=e=>this.navigate.emit(e),this.items=[],this.rootActivity=void 0,this.iconRegistry=s.get(_),this.portProviderRegistry=s.get(p)}render(){let e=this.items;if(e.length<=0)return null;if(!this.rootActivity)return;const t=x(O(this.rootActivity));return r("div",{class:"tw-ml-8"},r("nav",{class:"tw-flex","aria-label":"Breadcrumb"},r("ol",{role:"list",class:"tw-flex tw-items-center tw-space-x-3"},e.length>0&&r("li",null,r("div",{class:"tw-flex tw-items-center"},r("a",{onClick:e=>this.onItemClick(null),href:"#",class:"tw-block tw-flex tw-items-center tw-text-gray-400 hover:tw-text-gray-500"},r("div",{class:"tw-bg-blue-500 tw-rounded"},r(T,null)),r("span",{class:"tw-ml-4 tw-text-sm tw-font-medium tw-text-gray-500 hover:tw-text-gray-700"},this.rootActivity.id)),r("svg",{class:"tw-ml-2 tw-flex-shrink-0 tw-h-5 tw-w-5 tw-text-gray-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},r("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})))),e.map(((e,r)=>this.renderPathItem(e,r,t))))))}};export{Kc as elsa_flowchart,il as elsa_panel,al as elsa_workflow_navigator};